<script>
// Cache-bust: ensure page URLs carry a version param and every internal click appends a fresh version
(function() {
  function buildStaticVersion() {
    // Use current timestamp as version to ensure fresh content
    // This changes on every page load, forcing browser to check for updates
    return String(Date.now());
  }
  function withVersionRel(url, v) {
    try {
      var u = new URL(url, window.location.href);
      u.searchParams.set('v', v);
      return u.pathname + u.search + u.hash;
    } catch (e) {
      return (url.indexOf('?') === -1) ? (url + '?v=' + v) : (url + '&v=' + v);
    }
  }
  function withVersionAbs(url, v) {
    var u = new URL(url, window.location.href);
    u.searchParams.set('v', v);
    return u.toString();
  }
  function isInternal(href) {
    if (!href || href.startsWith('#')) return false;
    if (/^https?:\/\//i.test(href)) return false;
    return true;
  }
  function rewriteInternalLinks(v) {
    // Don't rewrite links in advance to keep URLs clean
    // Links will get version params on click via enableClickAppender()
    return;
  }
  function ensureUrlHasVersion(v) {
    var params = new URLSearchParams(window.location.search);
    if (!params.has('v')) {
      var target = withVersionAbs(window.location.href, v);
      window.location.replace(target);
    }
  }
  function enableClickAppender() {
    // On every internal click, append a fresh timestamp version to guarantee a fresh fetch
    document.addEventListener('click', function(e){
      var a = e.target && e.target.closest ? e.target.closest('a[href]') : null;
      if (!a) return;
      var href = a.getAttribute('href') || '';
      if (!isInternal(href)) return;
      // Mutate destination with a unique version for this click
      var fresh = String(Date.now());
      a.setAttribute('href', withVersionRel(href, fresh));
    }, true);
  }
  function observeDynamicLinks(v) {
    // Don't observe and rewrite dynamic links
    // They will get version params on click via enableClickAppender()
    return;
  }
  document.addEventListener('DOMContentLoaded', function(){
    var staticV = buildStaticVersion();
    rewriteInternalLinks(staticV);
    observeDynamicLinks(staticV);
    enableClickAppender();
    // Don't modify the main URL to keep it clean
    // ensureUrlHasVersion(staticV);
  });
})();
</script>
