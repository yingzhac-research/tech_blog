<script>
// Cache-bust internal navigations by appending a stable version query
(function() {
  function buildVersion() {
    // Derive from hashed bootstrap css name if available, else timestamp
    var el = document.querySelector('link#quarto-bootstrap');
    if (el && el.getAttribute('href')) {
      var href = el.getAttribute('href');
      var name = href.split('/').pop();
      // take last 12 chars as a pseudo version key
      return name.slice(-12).replace(/[^a-zA-Z0-9]/g,'');
    }
    return String(Math.floor(Date.now()/1000));
  }
  function withVersion(url, v) {
    try {
      var u = new URL(url, window.location.origin);
      u.searchParams.set('v', v);
      return u.pathname + u.search + u.hash;
    } catch (e) {
      // fallback for relative paths
      if (url.indexOf('?') === -1) return url + '?v=' + v; else return url + '&v=' + v;
    }
  }
  function applyToNavbar(v) {
    var links = document.querySelectorAll('header .navbar a.nav-link, header .navbar a.navbar-brand');
    links.forEach(function(a){
      var href = a.getAttribute('href') || '';
      if (!href) return;
      // internal .html or root links only
      if (/^https?:\/\//i.test(href)) return;
      if (href.indexOf('#') === 0) return;
      a.setAttribute('href', withVersion(href, v));
    });
  }
  function maybeReloadRoot(v) {
    // If opening root without ?v=, force a reload with version to avoid stale cache
    var hasV = new URLSearchParams(window.location.search).has('v');
    var path = window.location.pathname;
    var isRoot = /\/$/.test(path) || /\/index\.html$/.test(path);
    if (isRoot && !hasV) {
      var target = withVersion(window.location.pathname, v);
      window.location.replace(target);
    }
  }
  document.addEventListener('DOMContentLoaded', function(){
    var v = buildVersion();
    applyToNavbar(v);
    maybeReloadRoot(v);
  });
})();
</script>

