<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans" xml:lang="zh-Hans"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ying">
<meta name="description" content="理解期权为何不能用简单的现金流折现来估值，以及如何通过复制组合和无套利原理推导出期权定价公式。">

<title>【第5章】期权定价理论与模型：从直觉到 Black-Scholes – Tech Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-597958c53c93a607afca12fd375c57ed.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-1b3db88def35042d172274863c1cdcf0.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-597958c53c93a607afca12fd375c57ed.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-ea2c01f27a86cd888be845a75ab84aaf.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-6ee47bd5d569ce80d002539aadcc850f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-ea2c01f27a86cd888be845a75ab84aaf.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script>
<!-- Force refresh if cache is stale -->

<script>

(function() {

  var SITE_VERSION = '2025-11-14-v2'; // Update this to force all users to refresh

  var stored = localStorage.getItem('site_version');

  if (stored !== SITE_VERSION) {

    localStorage.setItem('site_version', SITE_VERSION);

    if (stored !== null) {

      // Not first visit, force reload from server

      window.location.reload(true);

    }

  }

})();

</script>

<script>

// Default to dark scheme on first visit (no prior preference stored)

try {

  var key = 'quarto-color-scheme';

  if (window && window.localStorage && window.localStorage.getItem(key) === null) {

    window.localStorage.setItem(key, 'alternate');

  }

} catch (e) {

  // ignore storage errors (privacy mode, etc.)

}

</script>

<!-- Aggressive cache prevention for HTML pages -->

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">

<meta http-equiv="Pragma" content="no-cache">

<meta http-equiv="Expires" content="0">

<meta name="revisit-after" content="1 days">

<meta name="robots" content="noarchive">




  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Tech Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="搜索"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="展开或折叠导航栏" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../home.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts_en.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tags.html"> 
<span class="menu-text">Tags</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="切换深色模式"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">该页面内容</h2>
   
  <ul>
  <li><a href="#从一个问题开始" id="toc-从一个问题开始" class="nav-link active" data-scroll-target="#从一个问题开始"><span class="header-section-number">1</span> 从一个问题开始</a></li>
  <li><a href="#期权的基本构造权利而非义务" id="toc-期权的基本构造权利而非义务" class="nav-link" data-scroll-target="#期权的基本构造权利而非义务"><span class="header-section-number">2</span> 期权的基本构造：权利而非义务</a>
  <ul class="collapse">
  <li><a href="#看涨期权与看跌期权" id="toc-看涨期权与看跌期权" class="nav-link" data-scroll-target="#看涨期权与看跌期权"><span class="header-section-number">2.1</span> 看涨期权与看跌期权</a></li>
  <li><a href="#美式期权与欧式期权" id="toc-美式期权与欧式期权" class="nav-link" data-scroll-target="#美式期权与欧式期权"><span class="header-section-number">2.2</span> 美式期权与欧式期权</a></li>
  </ul></li>
  <li><a href="#决定期权价值的六个因素" id="toc-决定期权价值的六个因素" class="nav-link" data-scroll-target="#决定期权价值的六个因素"><span class="header-section-number">3</span> 决定期权价值的六个因素</a>
  <ul class="collapse">
  <li><a href="#六大因素及其影响" id="toc-六大因素及其影响" class="nav-link" data-scroll-target="#六大因素及其影响"><span class="header-section-number">3.1</span> 六大因素及其影响</a></li>
  <li><a href="#为什么波动性越大期权越值钱" id="toc-为什么波动性越大期权越值钱" class="nav-link" data-scroll-target="#为什么波动性越大期权越值钱"><span class="header-section-number">3.2</span> 为什么波动性越大，期权越值钱？</a></li>
  </ul></li>
  <li><a href="#二叉树模型从离散世界理解期权定价" id="toc-二叉树模型从离散世界理解期权定价" class="nav-link" data-scroll-target="#二叉树模型从离散世界理解期权定价"><span class="header-section-number">4</span> 二叉树模型：从离散世界理解期权定价</a>
  <ul class="collapse">
  <li><a href="#核心思想复制组合" id="toc-核心思想复制组合" class="nav-link" data-scroll-target="#核心思想复制组合"><span class="header-section-number">4.1</span> 核心思想：复制组合</a></li>
  <li><a href="#单期二叉树模型" id="toc-单期二叉树模型" class="nav-link" data-scroll-target="#单期二叉树模型"><span class="header-section-number">4.2</span> 单期二叉树模型</a></li>
  <li><a href="#具体数值例子" id="toc-具体数值例子" class="nav-link" data-scroll-target="#具体数值例子"><span class="header-section-number">4.3</span> 具体数值例子</a></li>
  <li><a href="#从-black-scholes-到二叉树参数转换" id="toc-从-black-scholes-到二叉树参数转换" class="nav-link" data-scroll-target="#从-black-scholes-到二叉树参数转换"><span class="header-section-number">4.4</span> 从 Black-Scholes 到二叉树：参数转换</a></li>
  </ul></li>
  <li><a href="#black-scholes-模型连续世界的期权定价" id="toc-black-scholes-模型连续世界的期权定价" class="nav-link" data-scroll-target="#black-scholes-模型连续世界的期权定价"><span class="header-section-number">5</span> Black-Scholes 模型：连续世界的期权定价</a>
  <ul class="collapse">
  <li><a href="#从二叉树到连续" id="toc-从二叉树到连续" class="nav-link" data-scroll-target="#从二叉树到连续"><span class="header-section-number">5.1</span> 从二叉树到连续</a></li>
  <li><a href="#black-scholes-公式" id="toc-black-scholes-公式" class="nav-link" data-scroll-target="#black-scholes-公式"><span class="header-section-number">5.2</span> Black-Scholes 公式</a></li>
  <li><a href="#估计输入参数的注意事项" id="toc-估计输入参数的注意事项" class="nav-link" data-scroll-target="#估计输入参数的注意事项"><span class="header-section-number">5.3</span> 估计输入参数的注意事项</a></li>
  <li><a href="#公式的直觉解读" id="toc-公式的直觉解读" class="nav-link" data-scroll-target="#公式的直觉解读"><span class="header-section-number">5.4</span> 公式的直觉解读</a></li>
  <li><a href="#计算实例cisco-期权估值" id="toc-计算实例cisco-期权估值" class="nav-link" data-scroll-target="#计算实例cisco-期权估值"><span class="header-section-number">5.5</span> 计算实例：Cisco 期权估值</a></li>
  <li><a href="#隐含波动率" id="toc-隐含波动率" class="nav-link" data-scroll-target="#隐含波动率"><span class="header-section-number">5.6</span> 隐含波动率</a></li>
  </ul></li>
  <li><a href="#模型的局限性与修正" id="toc-模型的局限性与修正" class="nav-link" data-scroll-target="#模型的局限性与修正"><span class="header-section-number">6</span> 模型的局限性与修正</a>
  <ul class="collapse">
  <li><a href="#股息调整" id="toc-股息调整" class="nav-link" data-scroll-target="#股息调整"><span class="header-section-number">6.1</span> 股息调整</a></li>
  <li><a href="#提前行权美式期权" id="toc-提前行权美式期权" class="nav-link" data-scroll-target="#提前行权美式期权"><span class="header-section-number">6.2</span> 提前行权：美式期权</a></li>
  <li><a href="#行权对标的资产的影响权证估值" id="toc-行权对标的资产的影响权证估值" class="nav-link" data-scroll-target="#行权对标的资产的影响权证估值"><span class="header-section-number">6.3</span> 行权对标的资产的影响：权证估值</a></li>
  </ul></li>
  <li><a href="#跳跃过程期权定价模型" id="toc-跳跃过程期权定价模型" class="nav-link" data-scroll-target="#跳跃过程期权定价模型"><span class="header-section-number">7</span> 跳跃过程期权定价模型</a>
  <ul class="collapse">
  <li><a href="#当价格不连续变化时" id="toc-当价格不连续变化时" class="nav-link" data-scroll-target="#当价格不连续变化时"><span class="header-section-number">7.1</span> 当价格不连续变化时</a></li>
  <li><a href="#cox-ross-纯跳跃模型1976" id="toc-cox-ross-纯跳跃模型1976" class="nav-link" data-scroll-target="#cox-ross-纯跳跃模型1976"><span class="header-section-number">7.2</span> Cox-Ross 纯跳跃模型（1976）</a></li>
  <li><a href="#merton-跳跃扩散模型1976" id="toc-merton-跳跃扩散模型1976" class="nav-link" data-scroll-target="#merton-跳跃扩散模型1976"><span class="header-section-number">7.3</span> Merton 跳跃扩散模型（1976）</a></li>
  </ul></li>
  <li><a href="#期权定价的扩展更复杂的期权类型" id="toc-期权定价的扩展更复杂的期权类型" class="nav-link" data-scroll-target="#期权定价的扩展更复杂的期权类型"><span class="header-section-number">8</span> 期权定价的扩展：更复杂的期权类型</a>
  <ul class="collapse">
  <li><a href="#上限期权与障碍期权" id="toc-上限期权与障碍期权" class="nav-link" data-scroll-target="#上限期权与障碍期权"><span class="header-section-number">8.1</span> 上限期权与障碍期权</a></li>
  <li><a href="#复合期权" id="toc-复合期权" class="nav-link" data-scroll-target="#复合期权"><span class="header-section-number">8.2</span> 复合期权</a></li>
  <li><a href="#彩虹期权" id="toc-彩虹期权" class="nav-link" data-scroll-target="#彩虹期权"><span class="header-section-number">8.3</span> 彩虹期权</a></li>
  </ul></li>
  <li><a href="#看跌期权与看涨-看跌平价" id="toc-看跌期权与看涨-看跌平价" class="nav-link" data-scroll-target="#看跌期权与看涨-看跌平价"><span class="header-section-number">9</span> 看跌期权与看涨-看跌平价</a>
  <ul class="collapse">
  <li><a href="#put-call-parity" id="toc-put-call-parity" class="nav-link" data-scroll-target="#put-call-parity"><span class="header-section-number">9.1</span> Put-Call Parity</a></li>
  <li><a href="#black-scholes-看跌期权公式" id="toc-black-scholes-看跌期权公式" class="nav-link" data-scroll-target="#black-scholes-看跌期权公式"><span class="header-section-number">9.2</span> Black-Scholes 看跌期权公式</a></li>
  <li><a href="#案例用-put-call-parity-估值看跌期权" id="toc-案例用-put-call-parity-估值看跌期权" class="nav-link" data-scroll-target="#案例用-put-call-parity-估值看跌期权"><span class="header-section-number">9.3</span> 案例：用 Put-Call Parity 估值看跌期权</a></li>
  </ul></li>
  <li><a href="#总结" id="toc-总结" class="nav-link" data-scroll-target="#总结"><span class="header-section-number">10</span> 总结</a></li>
  <li><a href="#思考题" id="toc-思考题" class="nav-link" data-scroll-target="#思考题"><span class="header-section-number">11</span> 思考题</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">【第5章】期权定价理论与模型：从直觉到 Black-Scholes</h1>
  <div class="quarto-categories">
    <div class="quarto-category">金融</div>
    <div class="quarto-category">投资</div>
    <div class="quarto-category">估值</div>
  </div>
  </div>

<div>
  <div class="description">
    理解期权为何不能用简单的现金流折现来估值，以及如何通过复制组合和无套利原理推导出期权定价公式。
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">作者</div>
    <div class="quarto-title-meta-contents">
             <p>Ying </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">发布于</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2025年12月5日</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="从一个问题开始" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="从一个问题开始"><span class="header-section-number">1</span> 从一个问题开始</h2>
<p>在估值的世界里，我们通常遵循一条基本原则：<strong>任何资产的价值等于其预期现金流的现值</strong>。但有一类特殊的资产打破了这条规则。</p>
<p>想象一下：你花 5 美元买了一张”权利”，这张权利允许你在三个月后以 100 美元的价格买入某只股票。如果三个月后股票涨到 120 美元，你赚了 15 美元（120 - 100 - 5）；如果股票跌到 90 美元，你会选择不行使这个权利，最多亏损 5 美元。</p>
<p>这就是<strong>期权（Option）</strong>——一种收益不对称的金融工具。它的价值不能简单地用”预期现金流折现”来计算，因为期权持有者可以选择是否行使权利。</p>
<p>你可能会问：</p>
<ul>
<li>为什么波动性越大，期权越值钱？（这似乎与我们对”风险”的直觉相悖！）</li>
<li>如何在没有套利机会的前提下，给期权定一个”公平”的价格？</li>
<li>著名的 Black-Scholes 公式是如何推导出来的？它背后的核心逻辑是什么？</li>
</ul>
<p>本章将深入探讨这些问题，并为后续章节中<strong>实物期权（Real Options）</strong>的应用打下基础。</p>
<hr>
</section>
<section id="期权的基本构造权利而非义务" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="期权的基本构造权利而非义务"><span class="header-section-number">2</span> 期权的基本构造：权利而非义务</h2>
<section id="看涨期权与看跌期权" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="看涨期权与看跌期权"><span class="header-section-number">2.1</span> 看涨期权与看跌期权</h3>
<p>期权赋予持有者以固定价格（称为<strong>执行价格</strong>或<strong>行权价</strong>，Strike Price）在到期日或到期日前买入或卖出标的资产的<strong>权利</strong>——注意，是权利，不是义务。</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">重要</span>期权的两种基本类型
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>看涨期权（Call Option）</strong>：持有者有权在到期日或之前以执行价格<strong>买入</strong>标的资产</li>
<li><strong>看跌期权（Put Option）</strong>：持有者有权在到期日或之前以执行价格<strong>卖出</strong>标的资产</li>
</ul>
</div>
</div>
<p>让我们用一个具体的例子来理解。</p>
<p><strong>看涨期权的收益结构</strong>：</p>
<p>假设你买了一份执行价格为 100 美元的看涨期权，支付了 5 美元的期权费。到期时：</p>
<ul>
<li>如果股价 = 120 美元：行权，买入股票，<strong>净收益 = 120 - 100 - 5 = 15 美元</strong></li>
<li>如果股价 = 100 美元：不行权，<strong>净收益 = -5 美元</strong>（仅损失期权费）</li>
<li>如果股价 = 80 美元：不行权，<strong>净收益 = -5 美元</strong></li>
</ul>
<p>关键观察：<strong>下行风险有限（最多损失期权费），上行潜力无限</strong>。</p>
<p><strong>看跌期权的收益结构</strong>：</p>
<p>假设你买了一份执行价格为 100 美元的看跌期权，支付了 5 美元的期权费。到期时：</p>
<ul>
<li>如果股价 = 80 美元：行权，以 100 美元卖出，<strong>净收益 = 100 - 80 - 5 = 15 美元</strong></li>
<li>如果股价 = 100 美元：不行权，<strong>净收益 = -5 美元</strong></li>
<li>如果股价 = 120 美元：不行权，<strong>净收益 = -5 美元</strong></li>
</ul>
</section>
<section id="美式期权与欧式期权" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="美式期权与欧式期权"><span class="header-section-number">2.2</span> 美式期权与欧式期权</h3>
<ul>
<li><strong>欧式期权（European Option）</strong>：只能在到期日行权</li>
<li><strong>美式期权（American Option）</strong>：可以在到期日或之前任何时间行权</li>
</ul>
<p>美式期权的灵活性使其价值至少等于同等条件的欧式期权。但在大多数情况下，由于期权存在<strong>时间价值</strong>，提前行权并不划算——持有者通常能通过卖出期权获得比提前行权更高的收益。</p>
<hr>
</section>
</section>
<section id="决定期权价值的六个因素" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="决定期权价值的六个因素"><span class="header-section-number">3</span> 决定期权价值的六个因素</h2>
<p>期权的价值由六个变量决定。理解这些变量如何影响期权价值，是掌握期权定价的第一步。</p>
<section id="六大因素及其影响" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="六大因素及其影响"><span class="header-section-number">3.1</span> 六大因素及其影响</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 36%">
<col style="width: 36%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>因素</th>
<th>对看涨期权价值的影响</th>
<th>对看跌期权价值的影响</th>
<th>直觉解释</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>标的资产现价 <span class="math inline">\(S\)</span> ↑</td>
<td>↑ 增加</td>
<td>↓ 减少</td>
<td>看涨期权是买入的权利，资产越贵，买入权利越值钱</td>
</tr>
<tr class="even">
<td>执行价格 <span class="math inline">\(K\)</span> ↑</td>
<td>↓ 减少</td>
<td>↑ 增加</td>
<td>执行价格越高，看涨期权越难盈利</td>
</tr>
<tr class="odd">
<td>标的资产波动率 <span class="math inline">\(\sigma\)</span> ↑</td>
<td>↑ 增加</td>
<td>↑ 增加</td>
<td><strong>关键洞察</strong>：波动性对期权是好事！</td>
</tr>
<tr class="even">
<td>到期时间 <span class="math inline">\(t\)</span> ↑</td>
<td>↑ 增加</td>
<td>↑ 增加</td>
<td>时间越长，资产价格大幅变动的可能性越大</td>
</tr>
<tr class="odd">
<td>无风险利率 <span class="math inline">\(r\)</span> ↑</td>
<td>↑ 增加</td>
<td>↓ 减少</td>
<td>利率越高，执行价格的现值越低</td>
</tr>
<tr class="even">
<td>标的资产股息 <span class="math inline">\(D\)</span> ↑</td>
<td>↓ 减少</td>
<td>↑ 增加</td>
<td>股息支付会降低股价</td>
</tr>
</tbody>
</table>
</section>
<section id="为什么波动性越大期权越值钱" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="为什么波动性越大期权越值钱"><span class="header-section-number">3.2</span> 为什么波动性越大，期权越值钱？</h3>
<p>这是期权定价中最反直觉的一点。在其他资产估值中，波动性（风险）通常是负面的——我们会要求更高的折现率来补偿风险。但对于期权，情况完全不同。</p>
<p><strong>直觉解释</strong>：</p>
<p>期权持有者的损失是有限的（最多损失期权费），但收益潜力是无限的。高波动性意味着：</p>
<ul>
<li>资产价格大幅上涨的概率增加 → 看涨期权可能获得巨大收益</li>
<li>资产价格大幅下跌的概率也增加 → 但看涨期权的损失仍然有限</li>
</ul>
<p>这种<strong>收益不对称性</strong>使得波动性成为期权持有者的朋友。</p>
<p><strong>数学解释</strong>：</p>
<p>考虑一个简单的二元世界：股票当前价格 100 美元，可能涨到 110 或跌到 90。看涨期权（执行价格 100）的期望收益是：</p>
<p><span class="math display">\[
E[\text{收益}] = 0.5 \times (110 - 100) + 0.5 \times 0 = 5
\]</span></p>
<p>现在假设波动性增加：股票可能涨到 130 或跌到 70。期望收益变成：</p>
<p><span class="math display">\[
E[\text{收益}] = 0.5 \times (130 - 100) + 0.5 \times 0 = 15
\]</span></p>
<p>虽然下行风险也增加了，但期权持有者不在乎——因为亏损被锁定在期权费。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">注记</span>关于波动性的微妙之处
</div>
</div>
<div class="callout-body-container callout-body">
<p>对于深度实值（Deep In-the-Money）的看涨期权，其行为越来越像标的资产本身。在这种极端情况下，高波动性可能降低标的资产的价值，从而间接降低期权价值。但对于大多数期权，波动性仍然是正面因素。</p>
</div>
</div>
<hr>
</section>
</section>
<section id="二叉树模型从离散世界理解期权定价" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="二叉树模型从离散世界理解期权定价"><span class="header-section-number">4</span> 二叉树模型：从离散世界理解期权定价</h2>
<section id="核心思想复制组合" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="核心思想复制组合"><span class="header-section-number">4.1</span> 核心思想：复制组合</h3>
<p>期权定价的核心逻辑是<strong>无套利原则</strong>：如果我们能用标的资产和无风险借贷构建一个组合，使其在任何情况下的收益都与期权完全相同，那么这个组合的成本就是期权的价值。</p>
<p>这个组合被称为<strong>复制组合（Replicating Portfolio）</strong>。</p>
</section>
<section id="单期二叉树模型" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="单期二叉树模型"><span class="header-section-number">4.2</span> 单期二叉树模型</h3>
<p>假设股票当前价格为 <span class="math inline">\(S\)</span>，在一个时期后可能上涨到 <span class="math inline">\(Su\)</span> 或下跌到 <span class="math inline">\(Sd\)</span>：</p>
<pre><code>         Su (上涨)
        /
       S
        \
         Sd (下跌)</code></pre>
<p>对于执行价格为 <span class="math inline">\(K\)</span> 的看涨期权：</p>
<ul>
<li>如果股价上涨到 <span class="math inline">\(Su\)</span>：期权价值 <span class="math inline">\(C_u = \max(Su - K, 0)\)</span></li>
<li>如果股价下跌到 <span class="math inline">\(Sd\)</span>：期权价值 <span class="math inline">\(C_d = \max(Sd - K, 0)\)</span></li>
</ul>
<p><strong>构建复制组合</strong>：</p>
<p>我们要找到 <span class="math inline">\(\Delta\)</span> 股股票和 <span class="math inline">\(B\)</span> 美元借款的组合，使得：</p>
<ul>
<li>上涨时：<span class="math inline">\(\Delta \times Su - B(1+r) = C_u\)</span></li>
<li>下跌时：<span class="math inline">\(\Delta \times Sd - B(1+r) = C_d\)</span></li>
</ul>
<p>解这个方程组：</p>
<p><span class="math display">\[
\Delta = \frac{C_u - C_d}{Su - Sd}
\]</span></p>
<p>这个 <span class="math inline">\(\Delta\)</span> 被称为<strong>期权的 Delta</strong>，表示复制一份期权需要持有多少股票。</p>
</section>
<section id="具体数值例子" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="具体数值例子"><span class="header-section-number">4.3</span> 具体数值例子</h3>
<p>让我们用一个完整的例子来演示二叉树定价。</p>
<p><strong>设定</strong>：</p>
<ul>
<li>当前股价 <span class="math inline">\(S = 50\)</span> 美元</li>
<li>上涨因子 <span class="math inline">\(u = 1.4\)</span>（股价可能涨到 70）</li>
<li>下跌因子 <span class="math inline">\(d = 0.7\)</span>（股价可能跌到 35）</li>
<li>执行价格 <span class="math inline">\(K = 40\)</span> 美元</li>
<li>无风险利率 <span class="math inline">\(r = 11\%\)</span></li>
<li>期权期限：2 期</li>
</ul>
<p><strong>两期二叉树</strong>：</p>
<pre><code>t=0          t=1          t=2
                         100 (=70×1.4)
              70
             /  \
            /    50 (=70×0.7 或 35×1.4)
           /
         50
           \
            \
             35
              \
               25 (=35×0.7)</code></pre>
<p><strong>Step 1：计算终点的期权价值</strong></p>
<ul>
<li>股价 = 100：<span class="math inline">\(C = \max(100-40, 0) = 60\)</span></li>
<li>股价 = 50：<span class="math inline">\(C = \max(50-40, 0) = 10\)</span></li>
<li>股价 = 25：<span class="math inline">\(C = \max(25-40, 0) = 0\)</span></li>
</ul>
<p><strong>Step 2：从 t=1 节点反向计算</strong></p>
<p>在 <span class="math inline">\(S = 70\)</span> 节点：</p>
<p><span class="math display">\[
\Delta = \frac{60 - 10}{100 - 50} = 1
\]</span></p>
<p>复制组合需要买入 1 股股票。借款金额 <span class="math inline">\(B\)</span> 满足上涨时的复制条件：</p>
<p><span class="math display">\[
\Delta \times Su - B(1+r) = C_u \implies 1 \times 100 - B \times 1.11 = 60
\]</span></p>
<p>解得：</p>
<p><span class="math display">\[
B = \frac{100 - 60}{1.11} = \frac{40}{1.11} = 36.04
\]</span></p>
<p>因此，期权价值 = 复制组合成本 = <span class="math inline">\(\Delta \times S - B = 1 \times 70 - 36.04 = 33.96\)</span> 美元</p>
<p>在 <span class="math inline">\(S = 35\)</span> 节点：</p>
<p><span class="math display">\[
\Delta = \frac{10 - 0}{50 - 25} = 0.4
\]</span></p>
<p>期权价值 = <span class="math inline">\(35 \times 0.4 - 9.01 = 4.99\)</span> 美元</p>
<p><strong>Step 3：计算 t=0 的期权价值</strong></p>
<p><span class="math display">\[
\Delta = \frac{33.96 - 4.99}{70 - 35} = 0.8278
\]</span></p>
<p>期权价值 = <span class="math inline">\(50 \times 0.8278 - 21.61 = \$19.42\)</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">提示</span>二叉树模型的关键洞察
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><strong>期权价值不依赖于上涨/下跌的概率</strong>——只要无套利，复制组合的成本就是期权价值</li>
<li><strong>Delta 是动态变化的</strong>——在不同节点，复制组合需要不断调整</li>
<li><strong>期权价值由当前价格决定</strong>，而非预期未来价格（当前价格已经反映了市场预期）</li>
</ol>
</div>
</div>
</section>
<section id="从-black-scholes-到二叉树参数转换" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="从-black-scholes-到二叉树参数转换"><span class="header-section-number">4.4</span> 从 Black-Scholes 到二叉树：参数转换</h3>
<p>在实践中，我们经常需要在 Black-Scholes 和二叉树模型之间切换。如果你已经估计了 Black-Scholes 所需的波动率 <span class="math inline">\(\sigma\)</span>，如何转换为二叉树模型的上涨/下跌因子？</p>
<p><strong>转换公式</strong>：</p>
<p><span class="math display">\[
u = e^{\sigma\sqrt{\Delta t} + (r - \frac{\sigma^2}{2})\Delta t}
\]</span></p>
<p><span class="math display">\[
d = e^{-\sigma\sqrt{\Delta t} + (r - \frac{\sigma^2}{2})\Delta t}
\]</span></p>
<p>其中 <span class="math inline">\(\Delta t = T/m\)</span> 是每个时间步长（<span class="math inline">\(T\)</span> 是期权期限，<span class="math inline">\(m\)</span> 是总步数）。</p>
<p><strong>为什么公式中有 <span class="math inline">\((r - \sigma^2/2)\)</span> 项？</strong> 这是一个常被忽略的细节。在连续时间中，资产价格服从几何布朗运动：</p>
<p><span class="math display">\[
\frac{dS}{S} = \mu \, dt + \sigma \, dW
\]</span></p>
<p>由于伊藤引理（Itô’s Lemma），<span class="math inline">\(\ln S\)</span> 的漂移项不是 <span class="math inline">\(\mu\)</span>，而是 <span class="math inline">\(\mu - \sigma^2/2\)</span>。在风险中性世界中，<span class="math inline">\(\mu\)</span> 被无风险利率 <span class="math inline">\(r\)</span> 替代，因此漂移变成 <span class="math inline">\(r - \sigma^2/2\)</span>。</p>
<p><strong>数值示例</strong>：</p>
<p>假设： - 当前股价 <span class="math inline">\(S = \$30\)</span> - 年化波动率 <span class="math inline">\(\sigma = 40\%\)</span> - 无风险利率 <span class="math inline">\(r = 5\%\)</span> - 期权期限 4 年，每年为一个时间步（<span class="math inline">\(\Delta t = 1\)</span>）</p>
<p>计算上涨/下跌因子：</p>
<p><span class="math display">\[
u = e^{0.40\sqrt{1} + (0.05 - 0.40^2/2) \times 1} = e^{0.40 - 0.03} = e^{0.37} = 1.4477
\]</span></p>
<p><span class="math display">\[
d = e^{-0.40\sqrt{1} + (0.05 - 0.40^2/2) \times 1} = e^{-0.40 - 0.03} = e^{-0.43} = 0.6505
\]</span></p>
<p>用这些参数构建四年期二叉树：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>时点</th>
<th>价格节点</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(t=0\)</span></td>
<td><span class="math inline">\(30.00\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(t=1\)</span></td>
<td><span class="math inline">\(43.43\)</span> 或 <span class="math inline">\(19.52\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(t=2\)</span></td>
<td><span class="math inline">\(62.88\)</span>、<span class="math inline">\(28.25\)</span> 或 <span class="math inline">\(12.70\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(t=3\)</span></td>
<td><span class="math inline">\(91.03\)</span>、<span class="math inline">\(40.90\)</span>、<span class="math inline">\(18.38\)</span> 或 <span class="math inline">\(8.26\)</span></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">注记</span>二叉树与 Black-Scholes 的收敛
</div>
</div>
<div class="callout-body-container callout-body">
<p>当时间步数 <span class="math inline">\(m \to \infty\)</span> 时，二叉树模型收敛到 Black-Scholes 模型。实践中，50-100 步通常足够准确。步数越多，计算量越大，但对美式期权的早期行权处理越精确。</p>
</div>
</div>
<hr>
</section>
</section>
<section id="black-scholes-模型连续世界的期权定价" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="black-scholes-模型连续世界的期权定价"><span class="header-section-number">5</span> Black-Scholes 模型：连续世界的期权定价</h2>
<section id="从二叉树到连续" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="从二叉树到连续"><span class="header-section-number">5.1</span> 从二叉树到连续</h3>
<p>当我们把二叉树模型的时间间隔无限细分，价格变化变得连续时，二叉树模型就收敛到著名的 <strong>Black-Scholes 模型</strong>。</p>
<p>1973 年，Fischer Black 和 Myron Scholes 发表了开创性论文，为欧式期权提供了一个封闭解。这个模型为 Scholes 赢得了 1997 年诺贝尔经济学奖（Black 已于 1995 年去世）。</p>
</section>
<section id="black-scholes-公式" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="black-scholes-公式"><span class="header-section-number">5.2</span> Black-Scholes 公式</h3>
<p><strong>看涨期权价值</strong>：</p>
<p><span class="math display">\[
C = S \cdot N(d_1) - K e^{-rt} \cdot N(d_2)
\]</span></p>
<p>其中：</p>
<p><span class="math display">\[
d_1 = \frac{\ln(S/K) + (r + \sigma^2/2)t}{\sigma\sqrt{t}}
\]</span></p>
<p><span class="math display">\[
d_2 = d_1 - \sigma\sqrt{t}
\]</span></p>
<p><strong>变量含义</strong>：</p>
<ul>
<li><span class="math inline">\(S\)</span>：标的资产当前价格</li>
<li><span class="math inline">\(K\)</span>：执行价格</li>
<li><span class="math inline">\(t\)</span>：到期时间（年）</li>
<li><span class="math inline">\(r\)</span>：无风险利率（连续复利）</li>
<li><span class="math inline">\(\sigma\)</span>：标的资产价格对数的年化标准差</li>
<li><span class="math inline">\(N(\cdot)\)</span>：标准正态分布的累积分布函数</li>
</ul>
</section>
<section id="估计输入参数的注意事项" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="估计输入参数的注意事项"><span class="header-section-number">5.3</span> 估计输入参数的注意事项</h3>
<p>Black-Scholes 模型在<strong>连续时间</strong>（continuous time）框架下运作，这对输入参数有两个重要影响：</p>
<p><strong>1. 无风险利率的转换</strong></p>
<p>模型使用连续复利形式的无风险利率。如果你只有年化的离散利率（如国债收益率），需要转换：</p>
<p><span class="math display">\[
r_{\text{连续}} = \ln(1 + r_{\text{离散}})
\]</span></p>
<p>例如，如果一年期国债利率为 6.2%，则：</p>
<p><span class="math display">\[
r_{\text{连续}} = \ln(1.062) = 0.0602 = 6.02\%
\]</span></p>
<p><strong>为什么要这样转换？</strong> 因为 Black-Scholes 公式中的 <span class="math inline">\(e^{-rt}\)</span> 假设的是连续复利。如果直接使用离散利率，会导致折现因子的轻微偏差。</p>
<p><strong>2. 波动率的年化</strong></p>
<p>模型需要<strong>年化的对数收益率标准差</strong>。如果你使用周收益率或月收益率估计波动率，需要年化：</p>
<p><span class="math display">\[
\sigma_{\text{年化}} = \sigma_{\text{周}} \times \sqrt{52} = \sigma_{\text{月}} \times \sqrt{12}
\]</span></p>
<p><strong>为什么用 <span class="math inline">\(\sqrt{52}\)</span> 而不是 52？</strong> 这源于一个关键的统计性质：如果收益率没有序列相关性，方差在时间上是<strong>线性叠加</strong>的。因此：</p>
<p><span class="math display">\[
\sigma^2_{\text{年}} = 52 \times \sigma^2_{\text{周}} \implies \sigma_{\text{年}} = \sqrt{52} \times \sigma_{\text{周}}
\]</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">提示</span>实践建议
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>使用至少 2-3 年的历史价格数据估计波动率</li>
<li>周收益率比日收益率更稳定（减少噪音）</li>
<li>如果公司近期有重大事件（如并购），考虑是否使用更短的估计窗口</li>
</ul>
</div>
</div>
</section>
<section id="公式的直觉解读" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="公式的直觉解读"><span class="header-section-number">5.4</span> 公式的直觉解读</h3>
<p>Black-Scholes 公式看起来很复杂，但我们可以将其拆解为两部分：</p>
<p><span class="math display">\[
C = \underbrace{S \cdot N(d_1)}_{\text{买入股票}} - \underbrace{K e^{-rt} \cdot N(d_2)}_{\text{借款}}
\]</span></p>
<ul>
<li><strong><span class="math inline">\(S \cdot N(d_1)\)</span></strong>：复制组合中股票部分的价值。<span class="math inline">\(N(d_1)\)</span> 是期权的 Delta，表示需要持有多少股股票</li>
<li><strong><span class="math inline">\(K e^{-rt} \cdot N(d_2)\)</span></strong>：复制组合中借款部分的价值。<span class="math inline">\(K e^{-rt}\)</span> 是执行价格的现值，<span class="math inline">\(N(d_2)\)</span> 近似等于期权到期时实值的概率</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">注记</span><span class="math inline">\(N(d_2)\)</span> 的概率解释
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math inline">\(N(d_2)\)</span> 可以近似理解为：在风险中性世界中，期权到期时处于实值状态（<span class="math inline">\(S &gt; K\)</span>）的概率。这不是真实世界的概率，而是定价所需的”风险中性概率”。</p>
</div>
</div>
</section>
<section id="计算实例cisco-期权估值" class="level3" data-number="5.5">
<h3 data-number="5.5" class="anchored" data-anchor-id="计算实例cisco-期权估值"><span class="header-section-number">5.5</span> 计算实例：Cisco 期权估值</h3>
<p><strong>设定</strong>（2001 年 3 月 6 日）：</p>
<ul>
<li>Cisco 股价 <span class="math inline">\(S = 13.62\)</span> 美元</li>
<li>执行价格 <span class="math inline">\(K = 15\)</span> 美元</li>
<li>到期时间 <span class="math inline">\(t = 103/365 = 0.2822\)</span> 年</li>
<li>无风险利率 <span class="math inline">\(r = 4.63\%\)</span></li>
<li>年化波动率 <span class="math inline">\(\sigma = 81\%\)</span>（根据历史周收益率估计：<span class="math inline">\(11.23\% \times \sqrt{52} = 81\%\)</span>）</li>
</ul>
<p><strong>计算</strong>：</p>
<p><span class="math display">\[
d_1 = \frac{\ln(13.62/15) + (0.0463 + 0.81^2/2) \times 0.2822}{0.81 \times \sqrt{0.2822}} = 0.0212
\]</span></p>
<p><span class="math display">\[
d_2 = 0.0212 - 0.81 \times \sqrt{0.2822} = -0.4091
\]</span></p>
<p>查标准正态分布表：</p>
<ul>
<li><span class="math inline">\(N(d_1) = N(0.0212) = 0.5085\)</span></li>
<li><span class="math inline">\(N(d_2) = N(-0.4091) = 0.3412\)</span></li>
</ul>
<p><strong>期权价值</strong>：</p>
<p><span class="math display">\[
C = 13.62 \times 0.5085 - 15 \times e^{-0.0463 \times 0.2822} \times 0.3412 = \$1.87
\]</span></p>
<p>当时市场价格为 2 美元，略高于模型估值。这可能意味着市场认为的波动率比 81% 更高。</p>
</section>
<section id="隐含波动率" class="level3" data-number="5.6">
<h3 data-number="5.6" class="anchored" data-anchor-id="隐含波动率"><span class="header-section-number">5.6</span> 隐含波动率</h3>
<p>如果我们把市场价格代入 Black-Scholes 公式，反推出来的波动率称为<strong>隐含波动率（Implied Volatility）</strong>。</p>
<p>在上面的例子中，如果期权市价是 2 美元，反推的隐含波动率约为 85.4%。</p>
<p>隐含波动率是市场对未来波动性的预期，通常被认为比历史波动率更具前瞻性。</p>
<hr>
</section>
</section>
<section id="模型的局限性与修正" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="模型的局限性与修正"><span class="header-section-number">6</span> 模型的局限性与修正</h2>
<p>Black-Scholes 模型是为最简单的情况设计的：欧式期权、无股息、期权行权不影响标的资产价值。现实世界更复杂，需要对模型进行修正。</p>
<section id="股息调整" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="股息调整"><span class="header-section-number">6.1</span> 股息调整</h3>
<p>股息支付会降低股价，从而影响期权价值。有两种处理方法：</p>
<p><strong>方法一：短期期权——扣除股息现值</strong></p>
<p><span class="math display">\[
\text{调整后股价} = S - \text{PV}(\text{期权期限内的股息})
\]</span></p>
<p><strong>方法二：长期期权——使用股息收益率</strong></p>
<p>如果股息收益率 <span class="math inline">\(y\)</span> 在期权期限内保持稳定，修正后的 Black-Scholes 公式为：</p>
<p><span class="math display">\[
C = S e^{-yt} N(d_1) - K e^{-rt} N(d_2)
\]</span></p>
<p><span class="math display">\[
d_1 = \frac{\ln(S/K) + (r - y + \sigma^2/2)t}{\sigma\sqrt{t}}
\]</span></p>
<p><strong>直觉解释</strong>：</p>
<ol type="1">
<li>资产价值以股息收益率折现，反映了持有期权而非股票所错过的股息</li>
<li>利率被股息收益率抵消，反映了复制组合中持有股票的”隐性收益”</li>
</ol>
<section id="案例att-短期期权的股息调整" class="level4" data-number="6.1.1">
<h4 data-number="6.1.1" class="anchored" data-anchor-id="案例att-短期期权的股息调整"><span class="header-section-number">6.1.1</span> 案例：AT&amp;T 短期期权的股息调整</h4>
<p>2001 年 3 月 6 日，AT&amp;T 股价为 $20.50。考虑一份执行价格为 $20、7 月 20 日到期的看涨期权。基于历史价格，AT&amp;T 股价对数的年化标准差为 60%。在期权期限内，有一笔 $0.15 的股息将在 23 天后支付。无风险利率为 4.63%。</p>
<p><strong>Step 1：扣除股息现值</strong></p>
<p><span class="math display">\[
\text{股息现值} = \frac{\$0.15}{1.0463^{23/365}} = \$0.15
\]</span></p>
<p><span class="math display">\[
\text{调整后股价} = \$20.50 - \$0.15 = \$20.35
\]</span></p>
<p><strong>Step 2：计算 Black-Scholes 输入</strong></p>
<ul>
<li><span class="math inline">\(S = \$20.35\)</span>（调整后）</li>
<li><span class="math inline">\(K = \$20\)</span></li>
<li><span class="math inline">\(t = 103/365 = 0.2822\)</span> 年</li>
<li><span class="math inline">\(\sigma^2 = 0.36\)</span>（即 <span class="math inline">\(\sigma = 60\%\)</span>）</li>
<li><span class="math inline">\(r = 4.63\%\)</span></li>
</ul>
<p><strong>Step 3：计算 <span class="math inline">\(d_1\)</span> 和 <span class="math inline">\(d_2\)</span></strong></p>
<p><span class="math display">\[
d_1 = \frac{\ln(20.35/20) + (0.0463 + 0.36/2) \times 0.2822}{0.6 \times \sqrt{0.2822}} = 0.2551
\]</span></p>
<p><span class="math display">\[
d_2 = 0.2551 - 0.6 \times \sqrt{0.2822} = -0.0636
\]</span></p>
<p><strong>Step 4：查标准正态分布表</strong></p>
<ul>
<li><span class="math inline">\(N(d_1) = N(0.2551) = 0.6007\)</span></li>
<li><span class="math inline">\(N(d_2) = N(-0.0636) = 0.4746\)</span></li>
</ul>
<p><strong>Step 5：计算期权价值</strong></p>
<p><span class="math display">\[
C = 20.35 \times 0.6007 - 20 \times e^{-0.0463 \times 0.2822} \times 0.4746 = \$2.86
\]</span></p>
<p>当时市场价格为 $2.60，模型略微高估。这可能意味着市场预期的波动率低于 60%。</p>
</section>
<section id="案例att-长期期权的股息收益率调整" class="level4" data-number="6.1.2">
<h4 data-number="6.1.2" class="anchored" data-anchor-id="案例att-长期期权的股息收益率调整"><span class="header-section-number">6.1.2</span> 案例：AT&amp;T 长期期权的股息收益率调整</h4>
<p>同样是 2001 年 3 月 6 日，CBOE 交易一份 2003 年 1 月 17 日到期的 AT&amp;T 看涨期权，执行价格为 $20。对于这种接近两年期限的期权，逐笔扣除股息不太实际，我们改用<strong>股息收益率法</strong>。</p>
<p>假设 AT&amp;T 的股息收益率在期权期限内保持 2.51%，两年期国债利率为 4.85%。</p>
<p><strong>输入参数</strong>：</p>
<ul>
<li><span class="math inline">\(S = \$20.50\)</span></li>
<li><span class="math inline">\(K = \$20\)</span></li>
<li><span class="math inline">\(t = 1.8333\)</span> 年</li>
<li><span class="math inline">\(\sigma = 60\%\)</span></li>
<li><span class="math inline">\(r = 4.85\%\)</span></li>
<li><span class="math inline">\(y = 2.51\%\)</span>（股息收益率）</li>
</ul>
<p><strong>计算</strong>：</p>
<p><span class="math display">\[
d_1 = \frac{\ln(20.50/20) + (0.0485 - 0.0251 + 0.36/2) \times 1.8333}{0.6 \times \sqrt{1.8333}} = 0.4894
\]</span></p>
<p><span class="math display">\[
d_2 = 0.4894 - 0.6 \times \sqrt{1.8333} = -0.3230
\]</span></p>
<ul>
<li><span class="math inline">\(N(d_1) = 0.6877\)</span></li>
<li><span class="math inline">\(N(d_2) = 0.3733\)</span></li>
</ul>
<p><span class="math display">\[
C = 20.50 \times e^{-0.0251 \times 1.8333} \times 0.6877 - 20 \times e^{-0.0485 \times 1.8333} \times 0.3733 = \$6.63
\]</span></p>
<p>当时市场价格为 $5.80。模型高估了约 14%，可能原因： 1. 市场预期的波动率低于 60% 2. 市场担心早期行权的可能性（美式期权）</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">注记</span>短期 vs 长期股息调整的选择
</div>
</div>
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead>
<tr class="header">
<th>期权期限</th>
<th>推荐方法</th>
<th>原因</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>&lt; 6 个月</td>
<td>扣除股息现值</td>
<td>股息金额和时间较确定</td>
</tr>
<tr class="even">
<td>&gt; 1 年</td>
<td>股息收益率法</td>
<td>难以预测具体股息</td>
</tr>
<tr class="odd">
<td>6 个月 - 1 年</td>
<td>视情况而定</td>
<td>如果股息稳定，用收益率法</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="提前行权美式期权" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="提前行权美式期权"><span class="header-section-number">6.2</span> 提前行权：美式期权</h3>
<p>Black-Scholes 模型假设期权只能在到期日行权（欧式期权）。但美式期权可以提前行权。</p>
<p><strong>何时可能提前行权？</strong></p>
<ol type="1">
<li><strong>看涨期权 + 高股息</strong>：如果股息大于期权的剩余时间价值，可能在除息日前提前行权</li>
<li><strong>深度实值看跌期权 + 高利率</strong>：提前行权获得现金，赚取利息</li>
</ol>
<p><strong>处理方法</strong>：</p>
<ol type="1">
<li><strong>保守估计</strong>：用 Black-Scholes 计算的欧式期权价值作为下限</li>
<li><strong>伪美式估值</strong>：分别计算到每个除息日的期权价值，取最大值</li>
<li><strong>二叉树模型</strong>：在每个节点检查是否应该提前行权</li>
</ol>
<section id="案例伪美式估值多除息日的处理" class="level4" data-number="6.2.1">
<h4 data-number="6.2.1" class="anchored" data-anchor-id="案例伪美式估值多除息日的处理"><span class="header-section-number">6.2.1</span> 案例：伪美式估值——多除息日的处理</h4>
<p>考虑一份执行价格为 $35 的看涨期权，标的股票当前价格为 $40。股价对数的方差为 0.05，无风险利率为 4%。期权还有 8 个月到期，在此期间预计有三次股息：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>预期股息</th>
<th>除息日</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>$0.80</td>
<td>1 个月后</td>
</tr>
<tr class="even">
<td>$0.80</td>
<td>4 个月后</td>
</tr>
<tr class="odd">
<td>$0.80</td>
<td>7 个月后</td>
</tr>
</tbody>
</table>
<p><strong>方法：分别估值到每个除息日</strong></p>
<p><strong>估值 1：到第一个除息日前（1 个月）</strong></p>
<p>直接使用当前股价（此时还没有股息扣除）：</p>
<ul>
<li><span class="math inline">\(S = \$40\)</span>, <span class="math inline">\(K = \$35\)</span>, <span class="math inline">\(t = 1/12\)</span></li>
<li><span class="math inline">\(\sigma^2 = 0.05\)</span>, <span class="math inline">\(r = 4\%\)</span></li>
</ul>
<p><span class="math display">\[
\text{期权价值} = \$5.131
\]</span></p>
<p><strong>估值 2：到第二个除息日前（4 个月）</strong></p>
<p>扣除第一笔股息的现值：</p>
<p><span class="math display">\[
\text{调整后股价} = \$40 - \frac{\$0.80}{1.04^{1/12}} = \$39.20
\]</span></p>
<ul>
<li><span class="math inline">\(S = \$39.20\)</span>, <span class="math inline">\(K = \$35\)</span>, <span class="math inline">\(t = 4/12\)</span></li>
<li><span class="math inline">\(\sigma^2 = 0.05\)</span>, <span class="math inline">\(r = 4\%\)</span></li>
</ul>
<p><span class="math display">\[
\text{期权价值} = \$5.073
\]</span></p>
<p><strong>估值 3：到第三个除息日前（7 个月）</strong></p>
<p>扣除前两笔股息的现值：</p>
<p><span class="math display">\[
\text{调整后股价} = \$40 - \frac{\$0.80}{1.04^{1/12}} - \frac{\$0.80}{1.04^{4/12}} = \$38.41
\]</span></p>
<ul>
<li><span class="math inline">\(S = \$38.41\)</span>, <span class="math inline">\(K = \$35\)</span>, <span class="math inline">\(t = 7/12\)</span></li>
</ul>
<p><span class="math display">\[
\text{期权价值} = \$5.128
\]</span></p>
<p><strong>估值 4：到期权到期日（8 个月）</strong></p>
<p>扣除所有三笔股息的现值：</p>
<p><span class="math display">\[
\text{调整后股价} = \$40 - \frac{\$0.80}{1.04^{1/12}} - \frac{\$0.80}{1.04^{4/12}} - \frac{\$0.80}{1.04^{7/12}} = \$37.63
\]</span></p>
<ul>
<li><span class="math inline">\(S = \$37.63\)</span>, <span class="math inline">\(K = \$35\)</span>, <span class="math inline">\(t = 8/12\)</span></li>
</ul>
<p><span class="math display">\[
\text{期权价值} = \$4.757
\]</span></p>
<p><strong>结论：选择最大值</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>估值时点</th>
<th>期权价值</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>第一个除息日前</td>
<td><strong>$5.131</strong> ← 最大</td>
</tr>
<tr class="even">
<td>第二个除息日前</td>
<td>$5.073</td>
</tr>
<tr class="odd">
<td>第三个除息日前</td>
<td>$5.128</td>
</tr>
<tr class="even">
<td>到期日</td>
<td>$4.757</td>
</tr>
</tbody>
</table>
<p>伪美式估值 = <strong>$5.131</strong></p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">重要</span>伪美式估值的洞察
</div>
</div>
<div class="callout-body-container callout-body">
<p>这个案例揭示了一个重要现象：<strong>期权价值并非总是随着期限增长而增加</strong>。</p>
<p>为什么到第一个除息日的价值最高？因为： 1. 此时股价尚未被股息”侵蚀” 2. 虽然时间短（只有 1 个月），但深度实值期权的时间价值本就有限</p>
<p>这解释了为什么高股息股票的看涨期权更可能被提前行权——持有者不愿错过股息。</p>
</div>
</div>
</section>
<section id="方法-2使用二叉树模型处理早期行权" class="level4" data-number="6.2.2">
<h4 data-number="6.2.2" class="anchored" data-anchor-id="方法-2使用二叉树模型处理早期行权"><span class="header-section-number">6.2.2</span> 方法 2：使用二叉树模型处理早期行权</h4>
<p>二叉树模型更灵活，因为它可以在<strong>每个节点</strong>检查是否应该提前行权。步骤如下：</p>
<p><strong>Step 1</strong>：用 Black-Scholes 的波动率估计转换为二叉树参数（见前文的转换公式）</p>
<p><strong>Step 2</strong>：在每个除息日节点，股价下降股息金额</p>
<p><strong>Step 3</strong>：在每个节点，比较： - 立即行权的价值：<span class="math inline">\(\max(S - K, 0)\)</span> - 继续持有的价值（折现后期望值）</p>
<p><strong>Step 4</strong>：选择两者中的较大值</p>
</section>
</section>
<section id="行权对标的资产的影响权证估值" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="行权对标的资产的影响权证估值"><span class="header-section-number">6.3</span> 行权对标的资产的影响：权证估值</h3>
<p>对于普通期权，行权不会影响标的资产价值。但对于公司发行的<strong>权证（Warrant）</strong>，行权会增加流通股数量，稀释每股价值。</p>
<p><strong>稀释调整</strong>：</p>
<p><span class="math display">\[
\text{调整后股价} = \frac{S \times n_S + W \times n_W}{n_S + n_W}
\]</span></p>
<p>其中：</p>
<ul>
<li><span class="math inline">\(S\)</span>：当前股价</li>
<li><span class="math inline">\(n_S\)</span>：流通股数量</li>
<li><span class="math inline">\(W\)</span>：权证价值</li>
<li><span class="math inline">\(n_W\)</span>：权证数量</li>
</ul>
<p>这个公式有循环问题（需要权证价值来计算调整后股价，需要调整后股价来计算权证价值），需要迭代求解。</p>
<section id="案例avatek-corporation-权证估值" class="level4" data-number="6.3.1">
<h4 data-number="6.3.1" class="anchored" data-anchor-id="案例avatek-corporation-权证估值"><span class="header-section-number">6.3.1</span> 案例：Avatek Corporation 权证估值</h4>
<p>Avatek Corporation 是一家房地产公司，2001 年 3 月的情况如下：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>项目</th>
<th>数值</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>流通股数</td>
<td>1963.7 万股</td>
</tr>
<tr class="even">
<td>股价</td>
<td>$0.38</td>
</tr>
<tr class="odd">
<td>权证数量</td>
<td>180 万份</td>
</tr>
<tr class="even">
<td>权证执行价格</td>
<td>$2.25</td>
</tr>
<tr class="odd">
<td>权证期限</td>
<td>4 年</td>
</tr>
<tr class="even">
<td>股价对数标准差</td>
<td>93%</td>
</tr>
<tr class="odd">
<td>股息收益率</td>
<td>0%</td>
</tr>
<tr class="even">
<td>四年期国债利率</td>
<td>4.9%</td>
</tr>
<tr class="odd">
<td>权证市场价格</td>
<td>$0.12</td>
</tr>
</tbody>
</table>
<p><strong>Step 1：估算初始权证价值（用于调整股价）</strong></p>
<p>我们先用市场价格 $0.12 作为初始估计。</p>
<p><strong>Step 2：计算稀释调整后股价</strong></p>
<p><span class="math display">\[
\text{调整后股价} = \frac{S \times n_S + W \times n_W}{n_S + n_W} = \frac{0.38 \times 19.637 + 0.12 \times 1.8}{19.637 + 1.8} = \$0.3544
\]</span></p>
<p><strong>Step 3：用调整后股价计算权证价值</strong></p>
<p>输入参数： - <span class="math inline">\(S = \$0.3544\)</span>（调整后） - <span class="math inline">\(K = \$2.25\)</span> - <span class="math inline">\(t = 4\)</span> 年 - <span class="math inline">\(\sigma = 93\%\)</span> - <span class="math inline">\(r = 4.9\%\)</span> - <span class="math inline">\(y = 0\%\)</span></p>
<p>计算 <span class="math inline">\(d_1\)</span> 和 <span class="math inline">\(d_2\)</span>：</p>
<p><span class="math display">\[
d_1 = \frac{\ln(0.3544/2.25) + (0.049 + 0.93^2/2) \times 4}{0.93 \times \sqrt{4}} = 0.0418
\]</span></p>
<p><span class="math display">\[
d_2 = 0.0418 - 0.93 \times 2 = -1.8182
\]</span></p>
<p>查表： - <span class="math inline">\(N(d_1) = 0.5167\)</span> - <span class="math inline">\(N(d_2) = 0.0345\)</span></p>
<p><strong>Step 4：计算权证价值</strong></p>
<p><span class="math display">\[
W = 0.3544 \times 0.5167 - 2.25 \times e^{-0.049 \times 4} \times 0.0345 = \$0.12
\]</span></p>
<p><strong>结果</strong>：模型估值恰好等于市场价格 $0.12，无需进一步迭代。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">注记</span>迭代过程说明
</div>
</div>
<div class="callout-body-container callout-body">
<p>如果模型估值与初始假设不同，需要迭代：</p>
<ol type="1">
<li>用新的权证估值重新计算调整后股价</li>
<li>用新的调整后股价重新计算权证价值</li>
<li>重复直到收敛（通常 3-5 次迭代即可）</li>
</ol>
<p>对于非交易的管理层期权（没有市场价格），迭代过程必不可少。</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">警告</span>为什么稀释会降低权证价值？
</div>
</div>
<div class="callout-body-container callout-body">
<p>直觉上，稀释调整有两个效应：</p>
<ol type="1">
<li><strong>股价下调</strong>：将权证市值加入分子，但股数增加更多在分母，导致每股价值下降</li>
<li><strong>现金流入</strong>：权证行权会给公司带来现金（执行价格 × 权证数量）</li>
</ol>
<p>第二个效应是正面的，但通常<strong>无法完全抵消</strong>第一个效应，因为： - 只有在 <span class="math inline">\(S &gt; K\)</span> 时权证才会被行权 - 行权时公司收到的是执行价格，而稀释的是当前较高的股价</p>
</div>
</div>
<hr>
</section>
</section>
</section>
<section id="跳跃过程期权定价模型" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="跳跃过程期权定价模型"><span class="header-section-number">7</span> 跳跃过程期权定价模型</h2>
<section id="当价格不连续变化时" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="当价格不连续变化时"><span class="header-section-number">7.1</span> 当价格不连续变化时</h3>
<p>Black-Scholes 模型假设资产价格<strong>连续变化</strong>——价格在相邻时刻之间不会出现跳跃。但在现实中，某些事件（如盈利公告、FDA 审批结果、并购消息）会导致价格<strong>瞬间大幅跳跃</strong>。</p>
<p>如果在二叉树模型中，即使时间步长变得很短，价格变化仍然保持很大，那么连续价格过程的假设就不再适用。</p>
</section>
<section id="cox-ross-纯跳跃模型1976" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="cox-ross-纯跳跃模型1976"><span class="header-section-number">7.2</span> Cox-Ross 纯跳跃模型（1976）</h3>
<p>Cox 和 Ross 提出了一个纯跳跃过程模型，假设： - 股价要么保持不变（小概率向下漂移） - 要么出现大幅正向跳跃</p>
<p>这种模型适用于高度不确定的事件驱动型资产，如等待重大监管审批的生物科技公司。</p>
</section>
<section id="merton-跳跃扩散模型1976" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="merton-跳跃扩散模型1976"><span class="header-section-number">7.3</span> Merton 跳跃扩散模型（1976）</h3>
<p>Merton 提出了更一般化的模型，将<strong>跳跃叠加在连续价格过程上</strong>。模型需要两个额外参数：</p>
<ul>
<li><span class="math inline">\(\lambda\)</span>：跳跃发生的频率（每年预期跳跃次数）</li>
<li><span class="math inline">\(k\)</span>：平均跳跃幅度（以股价百分比衡量）</li>
</ul>
<p>跳跃扩散模型的期权价值由 Black-Scholes 的五个变量加上跳跃参数 <span class="math inline">\((\lambda, k)\)</span> 共同决定。</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">警告</span>跳跃模型的实践局限
</div>
</div>
<div class="callout-body-container callout-body">
<p>虽然跳跃扩散模型更贴近现实，但存在严重的<strong>参数估计问题</strong>：</p>
<ol type="1">
<li><strong>跳跃频率难以估计</strong>：历史上的跳跃样本很少</li>
<li><strong>跳跃幅度不稳定</strong>：不同事件导致的跳跃差异巨大</li>
<li><strong>估计误差可能超过模型改进带来的收益</strong></li>
</ol>
<p>因此，跳跃模型在实践中应用有限。对于大多数期权，使用 Black-Scholes 配合适当的隐含波动率是更务实的选择。</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">提示</span>何时考虑跳跃模型？
</div>
</div>
<div class="callout-body-container callout-body">
<table class="caption-top table">
<thead>
<tr class="header">
<th>场景</th>
<th>建议</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>等待 FDA 审批的生物科技公司</td>
<td>考虑跳跃模型或情景分析</td>
</tr>
<tr class="even">
<td>面临重大诉讼的公司</td>
<td>考虑跳跃模型</td>
</tr>
<tr class="odd">
<td>正常运营的成熟公司</td>
<td>Black-Scholes 足够</td>
</tr>
<tr class="even">
<td>短期交易期权</td>
<td>Black-Scholes + 隐含波动率</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
</section>
</section>
<section id="期权定价的扩展更复杂的期权类型" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="期权定价的扩展更复杂的期权类型"><span class="header-section-number">8</span> 期权定价的扩展：更复杂的期权类型</h2>
<p>标准期权之外，还有许多变体。理解这些变体对于<strong>实物期权</strong>的应用至关重要。</p>
<section id="上限期权与障碍期权" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="上限期权与障碍期权"><span class="header-section-number">8.1</span> 上限期权与障碍期权</h3>
<p><strong>上限期权（Capped Option）</strong>：收益有上限。例如，执行价格为 <span class="math inline">\(K_1\)</span> 的看涨期权，当资产价格超过 <span class="math inline">\(K_2\)</span> 时，收益被封顶在 <span class="math inline">\((K_2 - K_1)\)</span>。</p>
<p><strong>近似估值</strong>：</p>
<p><span class="math display">\[
\text{上限看涨期权价值} \approx C(K = K_1) - C(K = K_2)
\]</span></p>
<p><strong>障碍期权（Barrier Option）</strong>：期权的存续或收益取决于标的资产是否触及某个价格水平。</p>
<section id="障碍期权的四种基本类型" class="level4" data-number="8.1.1">
<h4 data-number="8.1.1" class="anchored" data-anchor-id="障碍期权的四种基本类型"><span class="header-section-number">8.1.1</span> 障碍期权的四种基本类型</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>类型</th>
<th>障碍位置</th>
<th>触及障碍后</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>向下敲出（Down-and-Out）</strong></td>
<td>执行价格以下</td>
<td>期权失效</td>
<td>看涨期权</td>
</tr>
<tr class="even">
<td><strong>向上敲出（Up-and-Out）</strong></td>
<td>执行价格以上</td>
<td>期权失效</td>
<td>看跌期权</td>
</tr>
<tr class="odd">
<td><strong>向下敲入（Down-and-In）</strong></td>
<td>执行价格以下</td>
<td>期权生效</td>
<td>看涨期权</td>
</tr>
<tr class="even">
<td><strong>向上敲入（Up-and-In）</strong></td>
<td>执行价格以上</td>
<td>期权生效</td>
<td>看跌期权</td>
</tr>
</tbody>
</table>
<p><strong>定价关系</strong>：</p>
<p>对于相同参数的障碍期权，有一个优雅的关系：</p>
<p><span class="math display">\[
\text{敲入期权} + \text{敲出期权} = \text{普通期权}
\]</span></p>
<p>这意味着如果你能定价敲出期权，就能通过差值得到敲入期权。</p>
<p><strong>为什么障碍期权更便宜？</strong></p>
<p>因为它们的收益被”截断”了。敲出期权可能在到期前就失效；敲入期权可能永远不生效。这种限制降低了期权价值。</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">警告</span>实物期权的启示
</div>
</div>
<div class="callout-body-container callout-body">
<p>许多实物期权都有类似的”上限”或”障碍”特征：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>实物期权场景</th>
<th>对应的障碍特征</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>专利保护的技术开发权</td>
<td>专利到期 = 敲出障碍</td>
</tr>
<tr class="even">
<td>政府特许经营权</td>
<td>特许期限 = 时间障碍</td>
</tr>
<tr class="odd">
<td>自然资源开采权</td>
<td>储量耗尽 = 向下敲出</td>
</tr>
<tr class="even">
<td>竞争对手抢先进入市场</td>
<td>市场份额降至阈值 = 敲出</td>
</tr>
</tbody>
</table>
<p>忽略这些限制会导致<strong>高估</strong>实物期权的价值。</p>
</div>
</div>
</section>
</section>
<section id="复合期权" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="复合期权"><span class="header-section-number">8.2</span> 复合期权</h3>
<p><strong>复合期权（Compound Option）</strong>的标的资产本身是另一个期权。例如：</p>
<ul>
<li>看涨期权的看涨期权（Call on a Call）</li>
<li>看跌期权的看跌期权（Put on a Put）</li>
</ul>
<p><strong>实物期权中的应用</strong>：</p>
<p>分阶段投资的项目可以被视为复合期权。第一阶段的投资给予公司进行第二阶段投资的”权利”，第二阶段又给予第三阶段的权利，以此类推。</p>
</section>
<section id="彩虹期权" class="level3" data-number="8.3">
<h3 data-number="8.3" class="anchored" data-anchor-id="彩虹期权"><span class="header-section-number">8.3</span> 彩虹期权</h3>
<p><strong>彩虹期权（Rainbow Option）</strong>的价值取决于多个不确定性来源。</p>
<p><strong>例子</strong>：未开发油田</p>
<p>这是一个典型的实物期权。但它的价值不仅取决于油价（不确定性来源 1），还取决于油田的储量（不确定性来源 2）。用单一标的资产的期权模型来估值会产生偏差。</p>
<hr>
</section>
</section>
<section id="看跌期权与看涨-看跌平价" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="看跌期权与看涨-看跌平价"><span class="header-section-number">9</span> 看跌期权与看涨-看跌平价</h2>
<section id="put-call-parity" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="put-call-parity"><span class="header-section-number">9.1</span> Put-Call Parity</h3>
<p>如果我们知道看涨期权的价值，可以通过<strong>看涨-看跌平价关系（Put-Call Parity）</strong>推导出同等条件看跌期权的价值：</p>
<p><span class="math display">\[
C - P = S - K e^{-rt}
\]</span></p>
<p>或等价地：</p>
<p><span class="math display">\[
P = C - S + K e^{-rt}
\]</span></p>
<p><strong>直觉解释</strong>：</p>
<p>考虑以下组合：</p>
<ol type="1">
<li>卖出一份看涨期权（收入 <span class="math inline">\(C\)</span>）</li>
<li>买入一份看跌期权（支出 <span class="math inline">\(P\)</span>）</li>
<li>买入一股股票（支出 <span class="math inline">\(S\)</span>）</li>
</ol>
<p>这个组合在到期时的收益恒等于 <span class="math inline">\(K\)</span>，无论股价如何变化。因此，组合的成本必须等于 <span class="math inline">\(K\)</span> 的现值：</p>
<p><span class="math display">\[
S + P - C = K e^{-rt}
\]</span></p>
</section>
<section id="black-scholes-看跌期权公式" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="black-scholes-看跌期权公式"><span class="header-section-number">9.2</span> Black-Scholes 看跌期权公式</h3>
<p>将 Black-Scholes 看涨期权公式代入 Put-Call Parity：</p>
<p><span class="math display">\[
P = K e^{-rt} [1 - N(d_2)] - S e^{-yt} [1 - N(d_1)]
\]</span></p>
<p>对于无股息资产（<span class="math inline">\(y = 0\)</span>）：</p>
<p><span class="math display">\[
P = K e^{-rt} N(-d_2) - S N(-d_1)
\]</span></p>
</section>
<section id="案例用-put-call-parity-估值看跌期权" class="level3" data-number="9.3">
<h3 data-number="9.3" class="anchored" data-anchor-id="案例用-put-call-parity-估值看跌期权"><span class="header-section-number">9.3</span> 案例：用 Put-Call Parity 估值看跌期权</h3>
<p>让我们用前面的 Cisco 和 AT&amp;T 案例来演示看跌期权的估值。</p>
<section id="cisco-看跌期权" class="level4" data-number="9.3.1">
<h4 data-number="9.3.1" class="anchored" data-anchor-id="cisco-看跌期权"><span class="header-section-number">9.3.1</span> Cisco 看跌期权</h4>
<p>回顾 Cisco 看涨期权的估值： - 股价 <span class="math inline">\(S = \$13.62\)</span> - 执行价格 <span class="math inline">\(K = \$15\)</span> - 到期时间 <span class="math inline">\(t = 103/365 = 0.2822\)</span> 年 - 无风险利率 <span class="math inline">\(r = 4.63\%\)</span> - 看涨期权价值 <span class="math inline">\(C = \$1.87\)</span></p>
<p>用 Put-Call Parity：</p>
<p><span class="math display">\[
P = C - S + K e^{-rt} = 1.87 - 13.62 + 15 \times e^{-0.0463 \times 0.2822} = \$3.06
\]</span></p>
<p>当时市场价格为 $3.38，模型略微低估。</p>
</section>
<section id="att-长期看跌期权" class="level4" data-number="9.3.2">
<h4 data-number="9.3.2" class="anchored" data-anchor-id="att-长期看跌期权"><span class="header-section-number">9.3.2</span> AT&amp;T 长期看跌期权</h4>
<p>回顾 AT&amp;T 长期看涨期权的估值： - 股价 <span class="math inline">\(S = \$20.50\)</span> - 执行价格 <span class="math inline">\(K = \$20\)</span> - 到期时间 <span class="math inline">\(t = 1.8333\)</span> 年 - 无风险利率 <span class="math inline">\(r = 4.85\%\)</span> - 股息收益率 <span class="math inline">\(y = 2.51\%\)</span> - 看涨期权价值 <span class="math inline">\(C = \$6.63\)</span></p>
<p>对于有股息的资产，Put-Call Parity 需要调整：</p>
<p><span class="math display">\[
P = C - S e^{-yt} + K e^{-rt}
\]</span></p>
<p><span class="math display">\[
P = 6.63 - 20.50 \times e^{-0.0251 \times 1.8333} + 20 \times e^{-0.0485 \times 1.8333} = \$5.35
\]</span></p>
<p>当时市场价格为 $3.80。模型高估了 41%！</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">重要</span>模型 vs 市场价格差异的含义
</div>
</div>
<div class="callout-body-container callout-body">
<p>Cisco 和 AT&amp;T 的看涨/看跌期权<strong>同时</strong>与模型估值不同，这说明：</p>
<ol type="1">
<li><strong>波动率估计可能有误</strong>：我们使用历史波动率，但市场可能预期更低（或更高）的未来波动率</li>
<li><strong>美式期权溢价</strong>：市场价格反映了提前行权的价值，而 Black-Scholes 假设欧式期权</li>
<li><strong>Put-Call Parity 始终成立</strong>：如果 Call 高估，Put 也会高估（反之亦然），因为它们通过套利关系相连</li>
</ol>
<p><strong>实践启示</strong>：如果模型价格与市场价格不同，反推<strong>隐含波动率</strong>通常比质疑市场更有意义。</p>
</div>
</div>
<hr>
</section>
</section>
</section>
<section id="总结" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="总结"><span class="header-section-number">10</span> 总结</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">重要</span>核心要点
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>期权是收益不对称的资产</strong>：下行风险有限，上行潜力巨大，不能用简单的现金流折现估值</li>
<li><strong>波动性是期权的朋友</strong>：与其他资产不同，期权价值随波动性增加而增加</li>
<li><strong>无套利定价</strong>：期权价值等于复制组合的成本——用标的资产和无风险借贷复制期权收益</li>
<li><strong>六大定价因素</strong>：标的资产价格、执行价格、波动率、到期时间、无风险利率、股息</li>
<li><strong>Black-Scholes 模型</strong>是二叉树模型在连续时间下的极限，五个输入变量可以定价欧式期权</li>
<li><strong>模型需要修正</strong>：考虑股息、提前行权可能性、稀释效应等现实因素</li>
</ul>
</div>
</div>
<p>本章回答了开头提出的问题：期权之所以不能用简单的现金流折现估值，是因为期权持有者有选择权——可以选择行权或放弃。这种选择权本身就有价值，而这个价值可以通过构建复制组合、利用无套利原则来精确计算。</p>
<p>关键的 takeaway 是：<strong>期权定价的核心不是预测未来价格，而是找到一个让套利者无利可图的”公平”价格</strong>。这个思想将在后续章节中延伸到实物期权的估值——企业拥有的延迟投资、扩张或放弃项目的选择权，本质上都是期权。</p>
<hr>
</section>
<section id="思考题" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="思考题"><span class="header-section-number">11</span> 思考题</h2>
<ol type="1">
<li><p>假设一只股票的波动率为 0（价格完全确定），此时一份平值（ATM）看涨期权的价值是多少？提示：考虑执行价格的现值。</p></li>
<li><p>为什么深度实值（Deep ITM）的美式看涨期权可能在高股息股票的除息日前被提前行权？在什么条件下，持有者会选择提前行权而非继续持有？</p></li>
<li><p>考虑一家生物科技公司，正在等待 FDA 对新药的审批结果。如果获批，公司价值翻倍；如果被拒，公司价值减半。这种情况适合用 Black-Scholes 模型估值吗？为什么？提示：考虑价格的连续性假设。</p></li>
<li><p>权证的稀释效应会降低权证价值。但如果权证被行权，公司会收到现金。这笔现金能否完全抵消稀释效应？为什么？</p></li>
<li><p>在实物期权的背景下，“执行价格”和”标的资产价值”分别对应什么？例如，对于一个尚未开发的油田，执行价格是什么？标的资产价值又是什么？</p></li>
</ol>
<hr>


</section>

</main> <!-- /main -->
﻿<script>

// Simple EN / 中文 language toggle for posts; robust via meta[quarto:offset]

(function() {

  const KEY = 'siteLang'; // 'en' | 'zh'

  const defaultLang = 'en';

  const POSTS_EN = 'posts_en.html';

  const POSTS_ZH = 'posts_zh.html';

  const TAGS = 'tags.html';



  function currentLang() { try { return localStorage.getItem(KEY) || defaultLang; } catch(e) { return defaultLang; } }

  function setLang(v) { try { localStorage.setItem(KEY, v); } catch(e) {} }

  function offset() {

    const meta = document.querySelector('meta[name="quarto:offset"]');

    const off = meta && meta.getAttribute('content') ? meta.getAttribute('content') : './';

    return off;

  }

  function targetFor(lang) { return lang === 'zh' ? POSTS_ZH : POSTS_EN; }

  function goToLang(lang) {

    const off = offset();

    const path = window.location.pathname;

    setLang(lang);

    if (path.endsWith('/' + TAGS) || path.endsWith(TAGS)) {

      window.location.href = off + TAGS;

    } else {

      window.location.href = off + targetFor(lang);

    }

  }

  function updateNavbarPostsLink() {

    const off = offset();

    const href = off + targetFor(currentLang());

    const links = document.querySelectorAll('header .navbar a.nav-link');

    links.forEach((a) => {

      const h = a.getAttribute('href') || '';

      if (h.endsWith(POSTS_EN) || h.endsWith(POSTS_ZH)) a.setAttribute('href', href);

    });

  }

  function mountToggle() {

    const tools = document.querySelector('.quarto-navbar-tools');

    if (!tools) return;

    const wrapper = document.createElement('div');

    wrapper.style.display = 'inline-flex';

    wrapper.style.alignItems = 'center';

    wrapper.style.gap = '0.35rem';

    wrapper.style.marginLeft = '0.35rem';



    const en = document.createElement('a');

    en.href = '';

    en.textContent = 'EN';

    en.className = 'quarto-navigation-tool px-1';

    en.onclick = function(){ goToLang('en'); return false; };



    const sep = document.createElement('span');

    sep.textContent = '|';

    sep.style.opacity = '0.6';



    const zh = document.createElement('a');

    zh.href = '';

    zh.textContent = '中文';

    zh.className = 'quarto-navigation-tool px-1';

    zh.onclick = function(){ goToLang('zh'); return false; };



    const lang = currentLang();

    (lang === 'en' ? en : zh).style.fontWeight = '700';



    wrapper.appendChild(en);

    wrapper.appendChild(sep);

    wrapper.appendChild(zh);

    tools.appendChild(wrapper);

    updateNavbarPostsLink();

  }

  document.addEventListener('DOMContentLoaded', mountToggle);

})();

</script>

<script>

(function(){

  function offset(){

    var meta = document.querySelector('meta[name="quarto:offset"]');

    return meta && meta.getAttribute('content') ? meta.getAttribute('content') : './';

  }

  document.addEventListener('DOMContentLoaded', function(){

    var brand = document.querySelector('header .navbar a.navbar-brand');

    if (brand) {

      brand.setAttribute('href', offset() + 'home.html');

    }

  });

})();

</script>



<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "已复制");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "已复制");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>