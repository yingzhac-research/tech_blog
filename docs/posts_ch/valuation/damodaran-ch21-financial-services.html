<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans" xml:lang="zh-Hans"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ying">
<meta name="description" content="银行、保险公司等金融服务公司为何难以用传统 DCF 估值？从股息折现到超额回报模型，从监管资本到硅谷银行危机，系统解析金融公司估值的独特挑战与解决方案。">

<title>【第21章】金融服务公司估值：当债务变成原材料 – Tech Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-597958c53c93a607afca12fd375c57ed.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-1b3db88def35042d172274863c1cdcf0.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-597958c53c93a607afca12fd375c57ed.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-ea2c01f27a86cd888be845a75ab84aaf.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-6ee47bd5d569ce80d002539aadcc850f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-ea2c01f27a86cd888be845a75ab84aaf.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script>
<!-- Force refresh if cache is stale -->

<script>

(function() {

  var SITE_VERSION = '2025-11-14-v2'; // Update this to force all users to refresh

  var stored = localStorage.getItem('site_version');

  if (stored !== SITE_VERSION) {

    localStorage.setItem('site_version', SITE_VERSION);

    if (stored !== null) {

      // Not first visit, force reload from server

      window.location.reload(true);

    }

  }

})();

</script>

<script>

// Default to dark scheme on first visit (no prior preference stored)

try {

  var key = 'quarto-color-scheme';

  if (window && window.localStorage && window.localStorage.getItem(key) === null) {

    window.localStorage.setItem(key, 'alternate');

  }

} catch (e) {

  // ignore storage errors (privacy mode, etc.)

}

</script>

<!-- Aggressive cache prevention for HTML pages -->

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">

<meta http-equiv="Pragma" content="no-cache">

<meta http-equiv="Expires" content="0">

<meta name="revisit-after" content="1 days">

<meta name="robots" content="noarchive">




  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Tech Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="搜索"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="展开或折叠导航栏" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../home.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts_en.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tags.html"> 
<span class="menu-text">Tags</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="切换深色模式"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">该页面内容</h2>
   
  <ul>
  <li><a href="#从一个问题开始" id="toc-从一个问题开始" class="nav-link active" data-scroll-target="#从一个问题开始"><span class="header-section-number">1</span> 从一个问题开始</a></li>
  <li><a href="#金融服务公司的分类" id="toc-金融服务公司的分类" class="nav-link" data-scroll-target="#金融服务公司的分类"><span class="header-section-number">2</span> 金融服务公司的分类</a></li>
  <li><a href="#金融服务公司的独特之处" id="toc-金融服务公司的独特之处" class="nav-link" data-scroll-target="#金融服务公司的独特之处"><span class="header-section-number">3</span> 金融服务公司的独特之处</a>
  <ul class="collapse">
  <li><a href="#债务原材料还是资本来源" id="toc-债务原材料还是资本来源" class="nav-link" data-scroll-target="#债务原材料还是资本来源"><span class="header-section-number">3.1</span> 债务：原材料还是资本来源？</a></li>
  <li><a href="#监管的叠加效应" id="toc-监管的叠加效应" class="nav-link" data-scroll-target="#监管的叠加效应"><span class="header-section-number">3.2</span> 监管的叠加效应</a></li>
  <li><a href="#再投资的困境" id="toc-再投资的困境" class="nav-link" data-scroll-target="#再投资的困境"><span class="header-section-number">3.3</span> 再投资的困境</a></li>
  </ul></li>
  <li><a href="#估值的一般框架" id="toc-估值的一般框架" class="nav-link" data-scroll-target="#估值的一般框架"><span class="header-section-number">4</span> 估值的一般框架</a>
  <ul class="collapse">
  <li><a href="#股权估值-vs-公司估值" id="toc-股权估值-vs-公司估值" class="nav-link" data-scroll-target="#股权估值-vs-公司估值"><span class="header-section-number">4.1</span> 股权估值 vs 公司估值</a></li>
  <li><a href="#现金流的选择" id="toc-现金流的选择" class="nav-link" data-scroll-target="#现金流的选择"><span class="header-section-number">4.2</span> 现金流的选择</a></li>
  </ul></li>
  <li><a href="#股息折现模型ddm" id="toc-股息折现模型ddm" class="nav-link" data-scroll-target="#股息折现模型ddm"><span class="header-section-number">5</span> 股息折现模型（DDM）</a>
  <ul class="collapse">
  <li><a href="#基本模型回顾" id="toc-基本模型回顾" class="nav-link" data-scroll-target="#基本模型回顾"><span class="header-section-number">5.1</span> 基本模型回顾</a></li>
  <li><a href="#ddm-输入参数的特殊考虑" id="toc-ddm-输入参数的特殊考虑" class="nav-link" data-scroll-target="#ddm-输入参数的特殊考虑"><span class="header-section-number">5.2</span> DDM 输入参数的特殊考虑</a></li>
  <li><a href="#案例汇丰银行hsbc的稳定增长估值" id="toc-案例汇丰银行hsbc的稳定增长估值" class="nav-link" data-scroll-target="#案例汇丰银行hsbc的稳定增长估值"><span class="header-section-number">5.3</span> 案例：汇丰银行（HSBC）的稳定增长估值</a></li>
  <li><a href="#案例印度国家银行state-bank-of-india的高增长估值" id="toc-案例印度国家银行state-bank-of-india的高增长估值" class="nav-link" data-scroll-target="#案例印度国家银行state-bank-of-india的高增长估值"><span class="header-section-number">5.4</span> 案例：印度国家银行（State Bank of India）的高增长估值</a></li>
  <li><a href="#不派息金融公司的估值" id="toc-不派息金融公司的估值" class="nav-link" data-scroll-target="#不派息金融公司的估值"><span class="header-section-number">5.5</span> 不派息金融公司的估值</a></li>
  </ul></li>
  <li><a href="#fcfe-模型" id="toc-fcfe-模型" class="nav-link" data-scroll-target="#fcfe-模型"><span class="header-section-number">6</span> FCFE 模型</a>
  <ul class="collapse">
  <li><a href="#为金融公司重新定义-fcfe" id="toc-为金融公司重新定义-fcfe" class="nav-link" data-scroll-target="#为金融公司重新定义-fcfe"><span class="header-section-number">6.1</span> 为金融公司重新定义 FCFE</a></li>
  <li><a href="#案例德意志银行deutsche-bank的-fcfe-估值" id="toc-案例德意志银行deutsche-bank的-fcfe-估值" class="nav-link" data-scroll-target="#案例德意志银行deutsche-bank的-fcfe-估值"><span class="header-section-number">6.2</span> 案例：德意志银行（Deutsche Bank）的 FCFE 估值</a></li>
  </ul></li>
  <li><a href="#超额回报模型" id="toc-超额回报模型" class="nav-link" data-scroll-target="#超额回报模型"><span class="header-section-number">7</span> 超额回报模型</a>
  <ul class="collapse">
  <li><a href="#基本原理" id="toc-基本原理" class="nav-link" data-scroll-target="#基本原理"><span class="header-section-number">7.1</span> 基本原理</a></li>
  <li><a href="#案例高盛goldman-sachs的超额回报估值" id="toc-案例高盛goldman-sachs的超额回报估值" class="nav-link" data-scroll-target="#案例高盛goldman-sachs的超额回报估值"><span class="header-section-number">7.2</span> 案例：高盛（Goldman Sachs）的超额回报估值</a></li>
  </ul></li>
  <li><a href="#资产基础估值" id="toc-资产基础估值" class="nav-link" data-scroll-target="#资产基础估值"><span class="header-section-number">8</span> 资产基础估值</a></li>
  <li><a href="#相对估值" id="toc-相对估值" class="nav-link" data-scroll-target="#相对估值"><span class="header-section-number">9</span> 相对估值</a>
  <ul class="collapse">
  <li><a href="#倍数的选择" id="toc-倍数的选择" class="nav-link" data-scroll-target="#倍数的选择"><span class="header-section-number">9.1</span> 倍数的选择</a></li>
  <li><a href="#pe-倍数的应用" id="toc-pe-倍数的应用" class="nav-link" data-scroll-target="#pe-倍数的应用"><span class="header-section-number">9.2</span> PE 倍数的应用</a></li>
  <li><a href="#案例美国保险公司-pe-比较2011年" id="toc-案例美国保险公司-pe-比较2011年" class="nav-link" data-scroll-target="#案例美国保险公司-pe-比较2011年"><span class="header-section-number">9.3</span> 案例：美国保险公司 PE 比较（2011年）</a></li>
  <li><a href="#案例摩根大通jpmorgan-chase的分部估值" id="toc-案例摩根大通jpmorgan-chase的分部估值" class="nav-link" data-scroll-target="#案例摩根大通jpmorgan-chase的分部估值"><span class="header-section-number">9.4</span> 案例：摩根大通（JPMorgan Chase）的分部估值</a></li>
  <li><a href="#pbv-倍数的应用" id="toc-pbv-倍数的应用" class="nav-link" data-scroll-target="#pbv-倍数的应用"><span class="header-section-number">9.5</span> PBV 倍数的应用</a></li>
  <li><a href="#案例欧洲银行的-pbv-与-roe2024年" id="toc-案例欧洲银行的-pbv-与-roe2024年" class="nav-link" data-scroll-target="#案例欧洲银行的-pbv-与-roe2024年"><span class="header-section-number">9.6</span> 案例：欧洲银行的 PBV 与 ROE（2024年）</a></li>
  </ul></li>
  <li><a href="#银行危机与估值" id="toc-银行危机与估值" class="nav-link" data-scroll-target="#银行危机与估值"><span class="header-section-number">10</span> 银行危机与估值</a>
  <ul class="collapse">
  <li><a href="#银行的商业模式" id="toc-银行的商业模式" class="nav-link" data-scroll-target="#银行的商业模式"><span class="header-section-number">10.1</span> 银行的商业模式</a></li>
  <li><a href="#好银行-vs-坏银行" id="toc-好银行-vs-坏银行" class="nav-link" data-scroll-target="#好银行-vs-坏银行"><span class="header-section-number">10.2</span> 好银行 vs 坏银行</a></li>
  <li><a href="#宏观压力测试" id="toc-宏观压力测试" class="nav-link" data-scroll-target="#宏观压力测试"><span class="header-section-number">10.3</span> 宏观压力测试</a></li>
  <li><a href="#案例硅谷银行svb的崩塌2023年" id="toc-案例硅谷银行svb的崩塌2023年" class="nav-link" data-scroll-target="#案例硅谷银行svb的崩塌2023年"><span class="header-section-number">10.4</span> 案例：硅谷银行（SVB）的崩塌（2023年）</a></li>
  <li><a href="#银行估值的危机指标" id="toc-银行估值的危机指标" class="nav-link" data-scroll-target="#银行估值的危机指标"><span class="header-section-number">10.5</span> 银行估值的危机指标</a></li>
  </ul></li>
  <li><a href="#存款保险与银行价值" id="toc-存款保险与银行价值" class="nav-link" data-scroll-target="#存款保险与银行价值"><span class="header-section-number">11</span> 存款保险与银行价值</a></li>
  <li><a href="#非银行金融服务公司" id="toc-非银行金融服务公司" class="nav-link" data-scroll-target="#非银行金融服务公司"><span class="header-section-number">12</span> 非银行金融服务公司</a>
  <ul class="collapse">
  <li><a href="#资产管理公司" id="toc-资产管理公司" class="nav-link" data-scroll-target="#资产管理公司"><span class="header-section-number">12.1</span> 资产管理公司</a></li>
  <li><a href="#支付处理公司" id="toc-支付处理公司" class="nav-link" data-scroll-target="#支付处理公司"><span class="header-section-number">12.2</span> 支付处理公司</a></li>
  <li><a href="#经纪公司" id="toc-经纪公司" class="nav-link" data-scroll-target="#经纪公司"><span class="header-section-number">12.3</span> 经纪公司</a></li>
  </ul></li>
  <li><a href="#总结" id="toc-总结" class="nav-link" data-scroll-target="#总结"><span class="header-section-number">13</span> 总结</a></li>
  <li><a href="#思考题" id="toc-思考题" class="nav-link" data-scroll-target="#思考题"><span class="header-section-number">14</span> 思考题</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">【第21章】金融服务公司估值：当债务变成原材料</h1>
  <div class="quarto-categories">
    <div class="quarto-category">金融</div>
    <div class="quarto-category">投资</div>
    <div class="quarto-category">估值</div>
  </div>
  </div>

<div>
  <div class="description">
    银行、保险公司等金融服务公司为何难以用传统 DCF 估值？从股息折现到超额回报模型，从监管资本到硅谷银行危机，系统解析金融公司估值的独特挑战与解决方案。
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">作者</div>
    <div class="quarto-title-meta-contents">
             <p>Ying </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">发布于</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2025年12月21日</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="从一个问题开始" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="从一个问题开始"><span class="header-section-number">1</span> 从一个问题开始</h2>
<p>假设你要估值一家银行。你打开财务报表，准备用熟悉的 DCF 模型开始工作。但很快你发现一系列棘手的问题：</p>
<ul>
<li><strong>什么是”债务”？</strong> 客户存款算债务吗？如果算，那银行的”营业利润”应该在扣除存款利息之前还是之后计算？</li>
<li><strong>什么是”再投资”？</strong> 银行几乎没有厂房设备，资本支出接近零。但如果再投资为零，增长从何而来？</li>
<li><strong>什么是”营运资本”？</strong> 银行资产负债表上几乎都是流动资产和流动负债，变化可能很大，但这和传统意义上的营运资本完全不同。</li>
</ul>
<p>这就是为什么金融服务公司（银行、保险公司、投资银行、资产管理公司）需要一套完全不同的估值方法。</p>
<p>本章将深入探讨：</p>
<ul>
<li>金融服务公司<strong>为什么难以估值</strong>？债务和再投资的定义问题</li>
<li><strong>三种 DCF 方法</strong>：股息折现模型、FCFE 模型、超额回报模型</li>
<li><strong>相对估值</strong>：为什么 PE 和 PBV 比 EV/EBITDA 更适合金融公司？</li>
<li><strong>银行危机的估值含义</strong>：从 2008 年金融危机到 2023 年硅谷银行崩盘</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">提示</span>本章的核心信息
</div>
</div>
<div class="callout-body-container callout-body">
<p>对于金融服务公司，<strong>直接估值股权</strong>比估值整个公司更可行。这意味着：</p>
<ul>
<li>使用<strong>股权成本</strong>而非 WACC</li>
<li>使用<strong>股息或股权自由现金流</strong>而非 FCFF</li>
<li>使用<strong>股权倍数</strong>（PE、PBV）而非企业价值倍数（EV/EBITDA）</li>
</ul>
<p>理解这一点，是估值金融公司的第一步。</p>
</div>
</div>
</section>
<section id="金融服务公司的分类" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="金融服务公司的分类"><span class="header-section-number">2</span> 金融服务公司的分类</h2>
<p>在深入估值方法之前，让我们先了解金融服务公司的四大类别：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>类型</th>
<th>盈利模式</th>
<th>代表公司</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>商业银行</strong></td>
<td>存贷利差 + 服务费</td>
<td>JPMorgan Chase, 工商银行</td>
</tr>
<tr class="even">
<td><strong>保险公司</strong></td>
<td>保费收入 + 投资收益</td>
<td>AIG, 中国平安</td>
</tr>
<tr class="odd">
<td><strong>投资银行</strong></td>
<td>咨询费 + 承销费 + 交易收入</td>
<td>Goldman Sachs, 中金公司</td>
</tr>
<tr class="even">
<td><strong>资产管理</strong></td>
<td>管理费 + 业绩提成</td>
<td>BlackRock, 易方达</td>
</tr>
</tbody>
</table>
<p>随着金融行业的整合，许多大型金融机构同时经营多种业务。例如，JPMorgan Chase 同时涉足商业银行、投资银行和资产管理。这使得估值变得更加复杂，因为不同业务需要不同的估值方法。</p>
</section>
<section id="金融服务公司的独特之处" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="金融服务公司的独特之处"><span class="header-section-number">3</span> 金融服务公司的独特之处</h2>
<section id="债务原材料还是资本来源" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="债务原材料还是资本来源"><span class="header-section-number">3.1</span> 债务：原材料还是资本来源？</h3>
<p>对于制造业公司，债务是<strong>资本来源</strong>——公司从股东和债权人那里筹集资金，然后投资于工厂、设备和其他资产。我们可以清晰地区分营业利润（EBIT）和利息支出。</p>
<p>但对于银行而言，债务是<strong>原材料</strong>。</p>
<blockquote class="blockquote">
<p>“Debt to a bank is akin to steel for an automobile company—something to be molded into other financial products that can then be sold at a higher price and yield a profit.”</p>
</blockquote>
<p>想象一下：银行以 2% 的利率吸收存款，然后以 6% 的利率发放贷款。这个 4% 的利差就是银行的”毛利润”。在这个过程中，存款不是传统意义上的”债务融资”，而是银行用来”生产”贷款产品的原材料。</p>
<p><strong>这带来了什么问题？</strong></p>
<ol type="1">
<li><strong>无法计算企业价值</strong>：如果存款算债务，企业价值 = 股权价值 + 债务 - 现金，但银行的”债务”可能是股权价值的 10 倍以上</li>
<li><strong>无法计算 WACC</strong>：债务定义模糊，资本结构难以确定</li>
<li><strong>无法计算营业利润</strong>：利息支出是银行最大的成本项目，如果在 EBIT 之前扣除，EBIT 几乎没有意义</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">重要</span>核心结论：直接估值股权
</div>
</div>
<div class="callout-body-container callout-body">
<p>由于债务定义的模糊性，对于金融服务公司：</p>
<ul>
<li><strong>直接估值股权</strong>，而不是估值整个公司</li>
<li>使用<strong>股权成本</strong>（Cost of Equity），而不是 WACC</li>
<li>使用<strong>股权倍数</strong>（PE、PBV），而不是企业价值倍数（EV/EBITDA）</li>
</ul>
</div>
</div>
</section>
<section id="监管的叠加效应" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="监管的叠加效应"><span class="header-section-number">3.2</span> 监管的叠加效应</h3>
<p>金融服务公司受到严格监管，这体现在三个方面：</p>
<ol type="1">
<li><strong>资本充足率要求</strong>：银行和保险公司必须维持最低资本比率（如巴塞尔协议要求的 Tier 1 资本比率）</li>
<li><strong>投资限制</strong>：监管可能限制金融机构投资于某些资产类别（如《格拉斯-斯蒂格尔法案》曾禁止商业银行从事投行业务）</li>
<li><strong>准入限制</strong>：新进入者和并购活动受到监管审批</li>
</ol>
<p><strong>监管对估值的影响</strong>：</p>
<ul>
<li>增长假设必须考虑监管约束——银行不能无限制地扩张贷款</li>
<li>监管变化会影响风险——放松管制可能增加不确定性</li>
<li>监管资本要求影响再投资需求</li>
</ul>
</section>
<section id="再投资的困境" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="再投资的困境"><span class="header-section-number">3.3</span> 再投资的困境</h3>
<p>在前面的章节中，我们定义再投资 = 净资本支出 + 营运资本变化。但对于金融服务公司：</p>
<p><strong>资本支出问题</strong>：银行的投资主要是无形资产——品牌、人力资本、技术系统。这些投资通常被归类为营业费用，而不是资本支出。因此，银行的现金流量表上几乎看不到资本支出。</p>
<p><strong>营运资本问题</strong>：银行资产负债表上的大部分项目都是流动资产或流动负债。如果按传统定义计算营运资本变化，数字可能巨大且波动剧烈，但这与”为增长而进行的再投资”毫无关系。</p>
<p><strong>这意味着什么？</strong></p>
<ul>
<li>传统的 FCFE 公式（净利润 - 净资本支出 - 营运资本变化 + 净借款）不适用</li>
<li>我们需要重新定义”再投资”——对于银行，最好的定义是<strong>投资于监管资本</strong></li>
</ul>
</section>
</section>
<section id="估值的一般框架" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="估值的一般框架"><span class="header-section-number">4</span> 估值的一般框架</h2>
<section id="股权估值-vs-公司估值" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="股权估值-vs-公司估值"><span class="header-section-number">4.1</span> 股权估值 vs 公司估值</h3>
<p>基于前面的讨论，我们的估值框架如下：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>方法</th>
<th>非金融公司</th>
<th>金融服务公司</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>估值对象</strong></td>
<td>公司或股权</td>
<td>仅股权</td>
</tr>
<tr class="even">
<td><strong>现金流</strong></td>
<td>FCFF 或 FCFE</td>
<td>股息或调整后 FCFE</td>
</tr>
<tr class="odd">
<td><strong>折现率</strong></td>
<td>WACC 或股权成本</td>
<td>仅股权成本</td>
</tr>
<tr class="even">
<td><strong>倍数</strong></td>
<td>PE、EV/EBITDA、EV/Sales</td>
<td>PE、PBV</td>
</tr>
</tbody>
</table>
</section>
<section id="现金流的选择" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="现金流的选择"><span class="header-section-number">4.2</span> 现金流的选择</h3>
<p>对于金融服务公司，我们有两种选择：</p>
<p><strong>选择一：使用股息作为现金流</strong></p>
<p>由于无法可靠地估计再投资，我们可以假设公司长期会将自由现金流以股息形式派发。股息是可观察的，避免了估计再投资的问题。</p>
<p><strong>选择二：重新定义 FCFE</strong></p>
<p>如果我们能重新定义”再投资”，就可以估计 FCFE。对于受监管资本约束的银行，再投资可以定义为<strong>投资于监管资本</strong>——即保留的净利润中用于增加监管资本的部分。</p>
<p><span class="math display">\[
\text{FCFE} = \text{净利润} - \text{监管资本投资}
\]</span></p>
<p>如果银行维持目标资本比率，为了支持贷款增长，它必须保留部分利润来增加资本金。这部分保留的利润就是”再投资”。</p>
</section>
</section>
<section id="股息折现模型ddm" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="股息折现模型ddm"><span class="header-section-number">5</span> 股息折现模型（DDM）</h2>
<section id="基本模型回顾" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="基本模型回顾"><span class="header-section-number">5.1</span> 基本模型回顾</h3>
<p>股息折现模型（DDM）是最古老也是最直接的股权估值方法：</p>
<p><span class="math display">\[
\text{股权价值} = \sum_{t=1}^{\infty} \frac{\text{Dividends}_t}{(1 + K_e)^t}
\]</span></p>
<p>对于稳定增长的公司，简化为 Gordon 增长模型：</p>
<p><span class="math display">\[
\text{股权价值} = \frac{\text{DPS}_1}{K_e - g}
\]</span></p>
<p>对于高增长公司，使用两阶段模型：</p>
<p><span class="math display">\[
\text{股权价值} = \sum_{t=1}^{n} \frac{\text{DPS}_t}{(1 + K_{e,hg})^t} + \frac{\text{DPS}_{n+1}}{(K_{e,st} - g_n)(1 + K_{e,hg})^n}
\]</span></p>
</section>
<section id="ddm-输入参数的特殊考虑" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="ddm-输入参数的特殊考虑"><span class="header-section-number">5.2</span> DDM 输入参数的特殊考虑</h3>
<section id="股权成本cost-of-equity" class="level4" data-number="5.2.1">
<h4 data-number="5.2.1" class="anchored" data-anchor-id="股权成本cost-of-equity"><span class="header-section-number">5.2.1</span> 股权成本（Cost of Equity）</h4>
<p>对于金融服务公司，股权成本的估计有两个特殊之处：</p>
<p><strong>第一，回归 Beta 可能更可靠</strong>。在前面的章节中，我们建议不要使用回归 Beta，因为公司可能在回归期间发生变化。但如果监管环境保持稳定，金融服务公司可能是少数可以使用回归 Beta 的行业之一。</p>
<p><strong>第二，不需要去杠杆和再杠杆</strong>。对于非金融公司，我们会将行业 Beta 去杠杆，然后根据目标公司的资本结构再杠杆。但对于金融服务公司： - 资本结构非常同质化——都是高杠杆 - 债务难以定义，杠杆比率难以计算</p>
<p>因此，直接使用可比公司的<strong>杠杆 Beta</strong>即可。</p>
</section>
<section id="派息率payout-ratio" class="level4" data-number="5.2.2">
<h4 data-number="5.2.2" class="anchored" data-anchor-id="派息率payout-ratio"><span class="header-section-number">5.2.2</span> 派息率（Payout Ratio）</h4>
<p>金融服务公司通常比其他公司派发更高的股息。原因有二：</p>
<ol type="1">
<li><strong>再投资需求较低</strong>：银行和保险公司的资本支出需求远低于制造业公司</li>
<li><strong>历史传统</strong>：金融机构有稳定派息的传统，吸引了偏好股息的投资者</li>
</ol>
<p>近年来，金融公司也开始大规模回购股票。如果只关注股息，可能低估实际的股东回报。更好的方法是计算<strong>综合派息率</strong>（股息 + 回购）/ 净利润。</p>
</section>
<section id="预期增长率" class="level4" data-number="5.2.3">
<h4 data-number="5.2.3" class="anchored" data-anchor-id="预期增长率"><span class="header-section-number">5.2.3</span> 预期增长率</h4>
<p>金融服务公司的增长率可以用三种方法估计：</p>
<ol type="1">
<li><strong>历史增长率</strong>：金融公司历史悠久，历史增长率与未来增长率的相关性可能较高</li>
<li><strong>分析师预期</strong>：大型银行和保险公司有广泛的分析师覆盖</li>
<li><strong>基本面增长率</strong>：</li>
</ol>
<p><span class="math display">\[
g = (1 - \text{派息率}) \times \text{ROE} = \text{留存率} \times \text{ROE}
\]</span></p>
<p>这个公式对金融服务公司特别有效，因为： - 留存率决定了银行能增加多少监管资本 - 监管资本的增加决定了银行能扩张多少贷款 - ROE 衡量了资本的使用效率</p>
</section>
<section id="稳定增长" class="level4" data-number="5.2.4">
<h4 data-number="5.2.4" class="anchored" data-anchor-id="稳定增长"><span class="header-section-number">5.2.4</span> 稳定增长</h4>
<p>在估算终值时，我们假设公司进入稳定增长阶段。对于金融服务公司，三个因素影响何时进入稳定增长：</p>
<ol type="1">
<li><strong>规模</strong>：大型金融机构更难维持高增长</li>
<li><strong>竞争</strong>：激烈竞争会加速向稳定增长的收敛</li>
<li><strong>监管</strong>：监管既可能通过限制竞争延长高增长期，也可能通过限制业务范围缩短高增长期</li>
</ol>
<p>在稳定增长阶段，派息率应该调整为：</p>
<p><span class="math display">\[
\text{稳定期派息率} = 1 - \frac{\text{稳定增长率}}{\text{稳定期 ROE}}
\]</span></p>
</section>
</section>
<section id="案例汇丰银行hsbc的稳定增长估值" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="案例汇丰银行hsbc的稳定增长估值"><span class="header-section-number">5.3</span> 案例：汇丰银行（HSBC）的稳定增长估值</h3>
<p>汇丰银行（HSBC）成立于香港，总部位于伦敦，是全球最大的商业银行之一。让我们用稳定增长 DDM 对其进行估值。</p>
<p><strong>2010 年财务数据</strong>： - 每股收益（EPS）：74.8 便士 - 每股股息（DPS）：36 便士 - 派息率：36/74.8 = 48.13%</p>
<p><strong>估值假设</strong>： - Beta = 1.0 - 无风险利率 = 4% - 股权风险溢价 = 5.5%（成熟市场 5% + 亚洲敞口溢价 0.5%） - 稳定增长率 = 3.5%</p>
<p><strong>计算股权成本</strong>：</p>
<p><span class="math display">\[
K_e = R_f + \beta \times \text{ERP} = 4\% + 1 \times 5.5\% = 9.5\%
\]</span></p>
<p><strong>计算每股价值</strong>：</p>
<p><span class="math display">\[
\text{每股价值} = \frac{\text{DPS}_1}{K_e - g} = \frac{36 \times 1.035}{0.095 - 0.035} = 621 \text{ 便士}
\]</span></p>
<p>当时股价为 635 便士，接近合理估值。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">注记</span>一个重要的检验
</div>
</div>
<div class="callout-body-container callout-body">
<p>这个估值隐含的 ROE 是多少？</p>
<p><span class="math display">\[
\text{隐含 ROE} = \frac{g}{1 - \text{派息率}} = \frac{3.5\%}{1 - 0.4813} = 6.75\%
\]</span></p>
<p>这低于股权成本 9.5%！这意味着如果 HSBC 能提高 ROE 到股权成本水平，它可以支付更高的股息，股票价值会更高。</p>
<p>如果 ROE = 9.5%，可持续派息率 = 1 - 3.5%/9.5% = 63.16%</p>
<p><span class="math display">\[
\text{每股价值} = \frac{74.8 \times 1.035 \times 0.6316}{0.095 - 0.035} = 815 \text{ 便士}
\]</span></p>
</div>
</div>
</section>
<section id="案例印度国家银行state-bank-of-india的高增长估值" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="案例印度国家银行state-bank-of-india的高增长估值"><span class="header-section-number">5.4</span> 案例：印度国家银行（State Bank of India）的高增长估值</h3>
<p>印度国家银行是印度最大的银行之一，1971 年国有化后，在 1990 年代部分私有化。这是一个典型的高增长银行案例。</p>
<p><strong>1999 年财务数据</strong>： - 净利润：2.05 亿印度卢比 - 股东权益账面价值：10.42 亿卢比（年初） - ROE = 2.05/10.42 = 19.72% - EPS：38.98 卢比 - DPS：2.50 卢比 - 派息率 = 2.50/38.98 = 6.41%</p>
<p><strong>第一阶段：高增长期（4 年）</strong></p>
<p>预期增长率： <span class="math display">\[
g = \text{ROE} \times (1 - \text{派息率}) = 19.72\% \times (1 - 0.0641) = 18.46\%
\]</span></p>
<p>股权成本计算：</p>
<p>印度国家风险溢价： <span class="math display">\[
\text{国家风险溢价} = \text{国家违约利差} \times \text{相对股市波动率} = 3.00\% \times 2.1433 = 6.43\%
\]</span></p>
<p><span class="math display">\[
K_e = 12\% + 0.80 \times (4\% + 6.43\%) = 20.34\%
\]</span></p>
<p>高增长期股息现值：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>年份</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>预期增长率</td>
<td>18.46%</td>
<td>18.46%</td>
<td>18.46%</td>
<td>18.46%</td>
</tr>
<tr class="even">
<td>EPS</td>
<td>₹46.17</td>
<td>₹54.70</td>
<td>₹64.79</td>
<td>₹76.75</td>
</tr>
<tr class="odd">
<td>派息率</td>
<td>6.41%</td>
<td>6.41%</td>
<td>6.41%</td>
<td>6.41%</td>
</tr>
<tr class="even">
<td>DPS</td>
<td>₹2.96</td>
<td>₹3.51</td>
<td>₹4.16</td>
<td>₹4.92</td>
</tr>
<tr class="odd">
<td>股权成本</td>
<td>20.34%</td>
<td>20.34%</td>
<td>20.34%</td>
<td>20.34%</td>
</tr>
<tr class="even">
<td>现值</td>
<td>₹2.46</td>
<td>₹2.42</td>
<td>₹2.38</td>
<td>₹2.35</td>
</tr>
</tbody>
</table>
<p><strong>第二阶段：过渡期（4 年）</strong></p>
<p>增长率从 18.46% 线性下降到 10%，ROE 从 19.72% 下降到 18%，国家风险溢价从 6.43% 下降到 3%。</p>
<p>第 8 年派息率： <span class="math display">\[
\text{派息率} = 1 - \frac{g}{\text{ROE}} = 1 - \frac{10\%}{18\%} = 44.44\%
\]</span></p>
<p>第 8 年股权成本： <span class="math display">\[
K_e = 12\% + 0.80 \times (4\% + 3\%) = 17.60\%
\]</span></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>年份</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>预期增长率</td>
<td>16.34%</td>
<td>14.23%</td>
<td>12.11%</td>
<td>10.00%</td>
</tr>
<tr class="even">
<td>EPS</td>
<td>₹89.29</td>
<td>₹102.00</td>
<td>₹114.35</td>
<td>₹125.79</td>
</tr>
<tr class="odd">
<td>派息率</td>
<td>15.92%</td>
<td>25.43%</td>
<td>34.94%</td>
<td>44.44%</td>
</tr>
<tr class="even">
<td>DPS</td>
<td>₹14.22</td>
<td>₹25.94</td>
<td>₹39.95</td>
<td>₹55.91</td>
</tr>
<tr class="odd">
<td>股权成本</td>
<td>19.66%</td>
<td>18.97%</td>
<td>18.29%</td>
<td>17.60%</td>
</tr>
<tr class="even">
<td>累积折现因子</td>
<td>2.5098</td>
<td>2.9860</td>
<td>3.5320</td>
<td>4.1536</td>
</tr>
<tr class="odd">
<td>现值</td>
<td>₹5.66</td>
<td>₹8.69</td>
<td>₹11.31</td>
<td>₹13.46</td>
</tr>
</tbody>
</table>
<p><strong>第三阶段：稳定增长</strong></p>
<p><span class="math display">\[
\text{终值} = \frac{\text{EPS}_9 \times \text{派息率}_9}{K_e - g} = \frac{125.79 \times 1.10 \times 0.4444}{0.176 - 0.10} = ₹809.18
\]</span></p>
<p><strong>最终估值</strong>：</p>
<p><span class="math display">\[
\text{每股价值} = 2.46 + 2.42 + 2.38 + 2.35 + 5.66 + 8.69 + 11.31 + 13.46 + \frac{809.18}{4.1536} = ₹243.55
\]</span></p>
<p>2001 年 1 月，印度国家银行股价为 ₹235，接近估算价值。</p>
</section>
<section id="不派息金融公司的估值" class="level3" data-number="5.5">
<h3 data-number="5.5" class="anchored" data-anchor-id="不派息金融公司的估值"><span class="header-section-number">5.5</span> 不派息金融公司的估值</h3>
<p>许多年轻的高增长金融公司不派发股息，而是将所有利润再投资。DDM 还能用吗？</p>
<p><strong>答案是肯定的</strong>。关键在于：虽然当前股息为零，但随着增长放缓，公司最终会开始派息。我们可以：</p>
<ol type="1">
<li>估计高增长期的长度</li>
<li>在高增长期假设股息为零（或很低）</li>
<li>使用基本面公式估计未来派息率：派息率 = 1 - g/ROE</li>
<li>当增长放缓时，派息率自然上升</li>
</ol>
<p>如果公司当前亏损，需要先预测何时盈利，然后从盈利时点开始进行分析。</p>
</section>
</section>
<section id="fcfe-模型" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="fcfe-模型"><span class="header-section-number">6</span> FCFE 模型</h2>
<section id="为金融公司重新定义-fcfe" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="为金融公司重新定义-fcfe"><span class="header-section-number">6.1</span> 为金融公司重新定义 FCFE</h3>
<p>传统的 FCFE 公式不适用于金融公司，因为我们无法可靠地估计资本支出和营运资本变化。但我们可以重新定义再投资。</p>
<p><strong>方法一：资本化人力资本投资</strong></p>
<p>对于依赖人力资本的金融公司（如投行），可以将员工培训和发展支出资本化：</p>
<ol type="1">
<li>确定摊销年限（基于员工平均任职时间）</li>
<li>收集过去几年的员工培训支出</li>
<li>计算当年摊销费用</li>
<li>调整净利润：</li>
</ol>
<p><span class="math display">\[
\text{调整后净利润} = \text{报告净利润} + \text{当年员工培训支出} - \text{摊销费用}
\]</span></p>
<ol start="5" type="1">
<li>计算人力资本价值 = 未摊销的员工培训支出总和</li>
</ol>
<p><strong>方法二：投资于监管资本</strong></p>
<p>对于受资本充足率监管的银行，更实用的方法是将”投资于监管资本”视为再投资。</p>
<p>逻辑如下： - 银行必须维持最低资本比率（如 Tier 1 资本 / 风险加权资产 ≥ 8%） - 如果银行想扩张贷款，必须增加监管资本 - 净利润中未派发的部分会增加股东权益，从而增加监管资本</p>
<p><span class="math display">\[
\text{FCFE} = \text{净利润} - \text{监管资本投资}
\]</span></p>
<p>其中： <span class="math display">\[
\text{监管资本投资} = \Delta \text{监管资本} = \text{净利润} - \text{股息} - \text{回购}
\]</span></p>
<p>这实际上就是<strong>潜在股息</strong>的概念——如果银行维持目标资本比率，它能派发多少股息？</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">警告</span>为什么净利润不等于现金流？
</div>
</div>
<div class="callout-body-container callout-body">
<p>有些分析师直接将银行的净利润折现，理由是银行没有资本支出和营运资本需求。但这是错误的。</p>
<p>如果银行将 100% 的净利润派发为股息，它的股东权益将保持不变。但如果贷款继续增长，资本比率将下降，最终违反监管要求。</p>
<p><strong>增长需要再投资</strong>——对于银行，这意味着投资于监管资本。即使是低增长的成熟银行，也不能将 100% 的净利润派发为股息。</p>
</div>
</div>
</section>
<section id="案例德意志银行deutsche-bank的-fcfe-估值" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="案例德意志银行deutsche-bank的-fcfe-估值"><span class="header-section-number">6.2</span> 案例：德意志银行（Deutsche Bank）的 FCFE 估值</h3>
<p>2008 年金融危机期间，德意志银行报告亏损 38.35 亿欧元，并大幅削减股息。让我们用 FCFE 模型在 2009 年初对其估值。</p>
<p><strong>关键假设</strong>：</p>
<ol type="1">
<li><strong>净利润恢复</strong>：假设 2009 年净利润恢复至 31.47 亿欧元（基于 2009 Q1 盈利和 2003-2007 年平均水平）</li>
<li><strong>资产基础和目标 ROE</strong>：资产基础（3,128.82 亿欧元）每年增长 4%，ROE 在 5 年内提高到 10%</li>
<li><strong>潜在股息</strong>：基于目标监管资本比率 10%（略低于当前 10.20%）估算</li>
<li><strong>股权成本</strong>：底部 Beta = 1.162，无风险利率 = 3.6%，股权风险溢价 = 6%</li>
</ol>
<p><span class="math display">\[
K_e = 3.6\% + 1.162 \times 6\% = 10.572\%
\]</span></p>
<p><strong>5 年预测</strong>：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>项目</th>
<th>当前</th>
<th>第1年</th>
<th>第2年</th>
<th>第3年</th>
<th>第4年</th>
<th>第5年</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>资产基础</td>
<td>312,882</td>
<td>325,398</td>
<td>338,414</td>
<td>351,950</td>
<td>366,028</td>
<td>380,669</td>
</tr>
<tr class="even">
<td>资本比率</td>
<td>10.20%</td>
<td>10.16%</td>
<td>10.12%</td>
<td>10.08%</td>
<td>10.04%</td>
<td>10.00%</td>
</tr>
<tr class="odd">
<td>监管资本</td>
<td>31,914</td>
<td>33,060</td>
<td>34,247</td>
<td>35,477</td>
<td>36,749</td>
<td>38,067</td>
</tr>
<tr class="even">
<td>监管资本投资</td>
<td>-</td>
<td>1,146</td>
<td>1,187</td>
<td>1,229</td>
<td>1,273</td>
<td>1,318</td>
</tr>
<tr class="odd">
<td>ROE</td>
<td>9.40%</td>
<td>9.52%</td>
<td>9.64%</td>
<td>9.76%</td>
<td>9.88%</td>
<td>10.00%</td>
</tr>
<tr class="even">
<td>净利润</td>
<td>3,000</td>
<td>3,147</td>
<td>3,302</td>
<td>3,463</td>
<td>3,631</td>
<td>3,807</td>
</tr>
<tr class="odd">
<td>FCFE（潜在股息）</td>
<td>-</td>
<td>2,001</td>
<td>2,114</td>
<td>2,233</td>
<td>2,358</td>
<td>2,489</td>
</tr>
<tr class="even">
<td>现值</td>
<td>-</td>
<td>1,810</td>
<td>1,729</td>
<td>1,652</td>
<td>1,578</td>
<td>1,506</td>
</tr>
</tbody>
</table>
<p>潜在股息现值合计：8,275 百万欧元</p>
<p><strong>稳定期假设</strong>： - 增长率 = 3% - Beta = 1.0 - 股权成本 = 3.6% + 1 × 6% = 9.60% - ROE = 9.60%（等于股权成本） - 派息率 = 1 - 3%/9.6% = 68.75%</p>
<p><strong>终值</strong>：</p>
<p><span class="math display">\[
\text{终值} = \frac{3,807 \times 1.03 \times 0.6875}{0.096 - 0.03} = 39,728 \text{ 百万欧元}
\]</span></p>
<p><span class="math display">\[
\text{终值现值} = \frac{39,728}{(1.10572)^5} = 24,036 \text{ 百万欧元}
\]</span></p>
<p><strong>股权价值</strong>：</p>
<p><span class="math display">\[
\text{股权价值} = 8,275 + 24,036 = 32,311 \text{ 百万欧元}
\]</span></p>
<p><span class="math display">\[
\text{每股价值} = \frac{32,311}{581.85} = 55.53 \text{ 欧元}
\]</span></p>
<p>2009 年 6 月，德意志银行股价为 48.06 欧元，看起来略被低估。</p>
</section>
</section>
<section id="超额回报模型" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="超额回报模型"><span class="header-section-number">7</span> 超额回报模型</h2>
<section id="基本原理" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="基本原理"><span class="header-section-number">7.1</span> 基本原理</h3>
<p>超额回报模型提供了另一种视角来思考金融公司的价值：</p>
<p><span class="math display">\[
\text{股权价值} = \text{当前账面股权} + \text{未来超额回报的现值}
\]</span></p>
<p><strong>核心洞察</strong>： - 如果 ROE = 股权成本，股权的市场价值 = 账面价值 - 如果 ROE &gt; 股权成本，公司创造超额回报，市值 &gt; 账面价值 - 如果 ROE &lt; 股权成本，公司毁灭价值，市值 &lt; 账面价值</p>
<p><strong>超额回报的计算</strong>：</p>
<p><span class="math display">\[
\text{超额股权回报} = (\text{ROE} - K_e) \times \text{股权资本}
\]</span></p>
<p>这个模型对金融公司特别有价值，因为： 1. 账面价值对金融公司更有意义（金融资产通常按市价计量） 2. ROE 是金融公司最重要的业绩指标 3. 可以直接看出公司在创造还是毁灭价值</p>
</section>
<section id="案例高盛goldman-sachs的超额回报估值" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="案例高盛goldman-sachs的超额回报估值"><span class="header-section-number">7.2</span> 案例：高盛（Goldman Sachs）的超额回报估值</h3>
<p>2011 年 5 月，高盛被认为是世界上最优秀的投资银行，但其市值（754 亿美元）略低于账面价值（782.28 亿美元）。让我们用超额回报模型来理解这个现象。</p>
<p><strong>基础数据</strong>（2010 年）： - 净利润：83.54 亿美元 - 期初账面股权：716.74 亿美元 - ROE = 83.54/716.74 = 11.66% - 派息率：10%（EPS $13.99, DPS $1.40） - Beta = 1.20 - 股权成本 = 3.5% + 1.2 × 5% = 9.5%</p>
<p><strong>5 年超额回报预测</strong>：</p>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th>项目</th>
<th>第1年</th>
<th>第2年</th>
<th>第3年</th>
<th>第4年</th>
<th>第5年</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>期初账面股权</td>
<td>$78,228</td>
<td>$86,434</td>
<td>$95,501</td>
<td>$105,519</td>
<td>$116,588</td>
</tr>
<tr class="even">
<td>ROE</td>
<td>11.66%</td>
<td>11.66%</td>
<td>11.66%</td>
<td>11.66%</td>
<td>11.66%</td>
</tr>
<tr class="odd">
<td>净利润</td>
<td>$9,118</td>
<td>$10,074</td>
<td>$11,131</td>
<td>$12,299</td>
<td>$13,589</td>
</tr>
<tr class="even">
<td>股权成本</td>
<td>9.50%</td>
<td>9.50%</td>
<td>9.50%</td>
<td>9.50%</td>
<td>9.50%</td>
</tr>
<tr class="odd">
<td>股权成本金额</td>
<td>$7,432</td>
<td>$8,211</td>
<td>$9,073</td>
<td>$10,024</td>
<td>$11,076</td>
</tr>
<tr class="even">
<td><strong>超额回报</strong></td>
<td><strong>$1,686</strong></td>
<td><strong>$1,863</strong></td>
<td><strong>$2,059</strong></td>
<td><strong>$2,275</strong></td>
<td><strong>$2,513</strong></td>
</tr>
<tr class="odd">
<td>现值</td>
<td>$1,540</td>
<td>$1,554</td>
<td>$1,568</td>
<td>$1,582</td>
<td>$1,596</td>
</tr>
<tr class="even">
<td>派息率</td>
<td>10%</td>
<td>10%</td>
<td>10%</td>
<td>10%</td>
<td>10%</td>
</tr>
<tr class="odd">
<td>股息</td>
<td>$912</td>
<td>$1,007</td>
<td>$1,113</td>
<td>$1,230</td>
<td>$1,359</td>
</tr>
<tr class="even">
<td>保留利润</td>
<td>$8,206</td>
<td>$9,067</td>
<td>$10,018</td>
<td>$11,069</td>
<td>$12,230</td>
</tr>
</tbody>
</table>
<p>超额回报现值合计：$7,880 百万</p>
<p><strong>5 年后假设</strong>：</p>
<p>假设高盛 5 年后 ROE 下降到股权成本 9.50%，即不再产生超额回报。</p>
<p><strong>股权价值</strong>：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>项目</th>
<th>金额（百万美元）</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>当前账面股权</td>
<td>$78,228</td>
</tr>
<tr class="even">
<td>超额回报现值（5年）</td>
<td>$7,880</td>
</tr>
<tr class="odd">
<td>终值超额回报现值</td>
<td>$0</td>
</tr>
<tr class="even">
<td><strong>股权价值</strong></td>
<td><strong>$86,068</strong></td>
</tr>
<tr class="odd">
<td>股数</td>
<td>517.735</td>
</tr>
<tr class="even">
<td><strong>每股价值</strong></td>
<td><strong>$166.24</strong></td>
</tr>
</tbody>
</table>
<p>2011 年 5 月，高盛股价为 $140.63，比估算价值低约 18%，看起来被低估。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">注记</span>超额回报模型的洞察
</div>
</div>
<div class="callout-body-container callout-body">
<p>为什么高盛的市值低于账面价值？</p>
<p>这个模型告诉我们：市场预期高盛未来的 ROE 会低于股权成本，或者超额回报期很短。</p>
<p>2008 年金融危机后，投资银行面临更严格的监管和更激烈的竞争，维持高 ROE 变得更加困难。如果高盛的 ROE 从 11.66% 下降到 9.5%（等于股权成本），其股权价值就会趋近于账面价值。</p>
</div>
</div>
</section>
</section>
<section id="资产基础估值" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="资产基础估值"><span class="header-section-number">8</span> 资产基础估值</h2>
<p>对于成熟且增长潜力有限的金融公司，可以使用资产基础估值：</p>
<p><span class="math display">\[
\text{股权价值} = \text{资产公允价值} - \text{负债}
\]</span></p>
<p><strong>银行贷款组合估值示例</strong>：</p>
<p>假设一家银行有 10 亿美元贷款组合，平均到期期限 8 年，预期年利息收入 7,000 万美元。如果贷款组合的公允市场利率（基于信用风险）是 6.5%：</p>
<p><span class="math display">\[
\text{贷款价值} = 7,000 \times \text{PVA}(8年, 6.5\%) + \frac{1,000}{1.065^8} = 10.3 \text{亿美元}
\]</span></p>
<p>贷款组合的公允价值（10.3 亿）高于账面价值（10 亿），因为银行收取的利率高于市场利率。</p>
<p><strong>局限性</strong>： 1. 不反映未来增长的价值 2. 难以应用于多元化金融集团</p>
</section>
<section id="相对估值" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="相对估值"><span class="header-section-number">9</span> 相对估值</h2>
<section id="倍数的选择" class="level3" data-number="9.1">
<h3 data-number="9.1" class="anchored" data-anchor-id="倍数的选择"><span class="header-section-number">9.1</span> 倍数的选择</h3>
<p>对于金融服务公司，企业价值倍数（如 EV/EBITDA）不适用，因为： - 企业价值难以定义（债务定义模糊） - 营业利润没有意义（利息是主要成本）</p>
<p>因此，我们使用<strong>股权倍数</strong>：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>倍数</th>
<th>适用性</th>
<th>注意事项</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>PE</strong></td>
<td>适用</td>
<td>注意拨备的影响</td>
</tr>
<tr class="even">
<td><strong>PBV</strong></td>
<td>非常适用</td>
<td>ROE 是核心驱动因素</td>
</tr>
<tr class="odd">
<td><strong>PS</strong></td>
<td>不适用</td>
<td>金融公司的”营收”难以定义</td>
</tr>
<tr class="even">
<td><strong>EV/EBITDA</strong></td>
<td>不适用</td>
<td>EV 和 EBITDA 都难以计算</td>
</tr>
</tbody>
</table>
</section>
<section id="pe-倍数的应用" class="level3" data-number="9.2">
<h3 data-number="9.2" class="anchored" data-anchor-id="pe-倍数的应用"><span class="header-section-number">9.2</span> PE 倍数的应用</h3>
<p>PE 倍数的决定因素与其他公司相同：预期增长率、派息率、股权成本。但有两个特殊考虑：</p>
<p><strong>第一，拨备的影响</strong>。银行会为坏账计提拨备，这会减少报告利润。保守的银行会计提更多拨备，报告更低的利润，从而显示更高的 PE。</p>
<p><strong>第二，业务多元化</strong>。对于像 JPMorgan 这样的多元化金融集团，不同业务的合理 PE 应该不同。商业贷款的 PE 应该低于资产管理的 PE。</p>
</section>
<section id="案例美国保险公司-pe-比较2011年" class="level3" data-number="9.3">
<h3 data-number="9.3" class="anchored" data-anchor-id="案例美国保险公司-pe-比较2011年"><span class="header-section-number">9.3</span> 案例：美国保险公司 PE 比较（2011年）</h3>
<p>下表列出了部分美国大型保险公司的 PE 倍数和基本面：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>公司</th>
<th>PE</th>
<th>派息率</th>
<th>ROE</th>
<th>预期增长</th>
<th>Beta</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CNO Financial</td>
<td>6.31</td>
<td>0%</td>
<td>7.04%</td>
<td>13.00%</td>
<td>2.91</td>
</tr>
<tr class="even">
<td>Hartford Financial</td>
<td>6.31</td>
<td>4.49%</td>
<td>9.48%</td>
<td>7.95%</td>
<td>2.78</td>
</tr>
<tr class="odd">
<td>Travelers</td>
<td>7.56</td>
<td>0%</td>
<td>13.41%</td>
<td>8.60%</td>
<td>0.65</td>
</tr>
<tr class="even">
<td>Chubb</td>
<td>8.56</td>
<td>21.00%</td>
<td>14.29%</td>
<td>9.33%</td>
<td>0.80</td>
</tr>
<tr class="odd">
<td>AIG</td>
<td>8.73</td>
<td>0%</td>
<td>17.26%</td>
<td>12.00%</td>
<td>2.48</td>
</tr>
<tr class="even">
<td>AFLAC</td>
<td>10.68</td>
<td>25.63%</td>
<td>19.02%</td>
<td>11.90%</td>
<td>1.87</td>
</tr>
<tr class="odd">
<td>MetLife</td>
<td>15.62</td>
<td>26.48%</td>
<td>6.09%</td>
<td>12.70%</td>
<td>1.80</td>
</tr>
<tr class="even">
<td>Aon</td>
<td>21.94</td>
<td>23.90%</td>
<td>9.38%</td>
<td>7.50%</td>
<td>0.61</td>
</tr>
</tbody>
</table>
<p>从表面看，CNO Financial 和 Hartford 看起来很便宜，但它们的 Beta 也非常高。</p>
<p><strong>回归分析</strong>：</p>
<p><span class="math display">\[
\text{PE} = 12.311 - 1.953 \times \text{Beta} + 9.70 \times \text{派息率} \quad (R^2 = 37.6\%)
\]</span></p>
<p>用这个回归预测 CNO Financial 的 PE：</p>
<p><span class="math display">\[
\text{预测 PE} = 12.311 - 1.953 \times 2.91 + 9.70 \times 0 = 6.63
\]</span></p>
<p>实际 PE = 6.31，接近预测值，说明 CNO Financial 并非被低估，只是风险很高。</p>
<p>对于 Aon：</p>
<p><span class="math display">\[
\text{预测 PE} = 12.311 - 1.953 \times 0.61 + 9.70 \times 0.239 = 13.44
\]</span></p>
<p>实际 PE = 21.94，明显高于预测值，Aon 看起来被高估。</p>
</section>
<section id="案例摩根大通jpmorgan-chase的分部估值" class="level3" data-number="9.4">
<h3 data-number="9.4" class="anchored" data-anchor-id="案例摩根大通jpmorgan-chase的分部估值"><span class="header-section-number">9.4</span> 案例：摩根大通（JPMorgan Chase）的分部估值</h3>
<p>对于多元化金融集团，可以按业务分部估值：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>业务</th>
<th>净利润（百万$）</th>
<th>行业 PE</th>
<th>估算股权价值</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>投资银行</td>
<td>$6,639</td>
<td>12.15</td>
<td>$80,664</td>
</tr>
<tr class="even">
<td>零售金融</td>
<td>$2,526</td>
<td>14.80</td>
<td>$37,385</td>
</tr>
<tr class="odd">
<td>信用卡</td>
<td>$2,074</td>
<td>14.80</td>
<td>$30,695</td>
</tr>
<tr class="even">
<td>商业银行</td>
<td>$2,084</td>
<td>10.80</td>
<td>$22,507</td>
</tr>
<tr class="odd">
<td>财务与证券</td>
<td>$1,079</td>
<td>10.80</td>
<td>$11,653</td>
</tr>
<tr class="even">
<td>资产管理</td>
<td>$1,710</td>
<td>15.67</td>
<td>$26,796</td>
</tr>
<tr class="odd">
<td>私募股权</td>
<td>$1,258</td>
<td>8.08</td>
<td>$10,165</td>
</tr>
<tr class="even">
<td><strong>合计</strong></td>
<td><strong>$17,370</strong></td>
<td>-</td>
<td><strong>$219,865</strong></td>
</tr>
</tbody>
</table>
<p>2011 年 5 月，JPMorgan 市值为 1,682.9 亿美元，比分部估值低约 30%，暗示被低估。</p>
</section>
<section id="pbv-倍数的应用" class="level3" data-number="9.5">
<h3 data-number="9.5" class="anchored" data-anchor-id="pbv-倍数的应用"><span class="header-section-number">9.5</span> PBV 倍数的应用</h3>
<p>PBV（市净率）对金融服务公司特别重要，因为：</p>
<ol type="1">
<li><strong>账面价值更可靠</strong>：金融资产通常按市价计量，账面价值更接近真实价值</li>
<li><strong>ROE 是核心驱动因素</strong>：PBV 与 ROE 的关系对金融公司特别强</li>
</ol>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">重要</span>PBV 与 ROE 的核心关系
</div>
</div>
<div class="callout-body-container callout-body">
<p>对于稳定增长的公司：</p>
<p><span class="math display">\[
\frac{P}{BV} = \frac{\text{ROE} - g}{K_e - g}
\]</span></p>
<p>如果 ROE = <span class="math inline">\(K_e\)</span>，则 PBV = 1 如果 ROE &gt; <span class="math inline">\(K_e\)</span>，则 PBV &gt; 1 如果 ROE &lt; <span class="math inline">\(K_e\)</span>，则 PBV &lt; 1</p>
<p>这解释了为什么许多银行以低于账面价值交易——市场预期它们的 ROE 低于股权成本。</p>
</div>
</div>
</section>
<section id="案例欧洲银行的-pbv-与-roe2024年" class="level3" data-number="9.6">
<h3 data-number="9.6" class="anchored" data-anchor-id="案例欧洲银行的-pbv-与-roe2024年"><span class="header-section-number">9.6</span> 案例：欧洲银行的 PBV 与 ROE（2024年）</h3>
<p>2024 年 5 月，70 家欧洲上市银行的统计数据：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>指标</th>
<th>平均值</th>
<th>25%分位</th>
<th>中位数</th>
<th>75%分位</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PBV</td>
<td>0.89</td>
<td>0.55</td>
<td>0.77</td>
<td>1.09</td>
</tr>
<tr class="even">
<td>ROE</td>
<td>15.22%</td>
<td>11.04%</td>
<td>13.99%</td>
<td>17.69%</td>
</tr>
<tr class="odd">
<td>Tier 1 资本比率</td>
<td>17.78%</td>
<td>15.38%</td>
<td>16.97%</td>
<td>19.51%</td>
</tr>
</tbody>
</table>
<p>50/70 家银行的 PBV &lt; 1，但这并不一定意味着它们被低估——许多银行的 ROE 较低。</p>
<p><strong>回归分析</strong>：</p>
<p><span class="math display">\[
\text{PBV} = -0.4063 + 3.4563 \times \text{ROE} + 4.3595 \times \text{Tier 1 资本比率} \quad (R^2 = 37.45\%)
\]</span></p>
<p>用这个回归评估西班牙桑坦德银行（Banco Santander）： - ROE = 12.86% - Tier 1 资本比率 = 13.75% - 实际 PBV = 0.63</p>
<p><span class="math display">\[
\text{预测 PBV} = -0.4063 + 3.4563 \times 0.1286 + 4.3595 \times 0.1375 = 0.64
\]</span></p>
<p>实际 PBV 与预测几乎完全一致，桑坦德银行定价合理。</p>
</section>
</section>
<section id="银行危机与估值" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="银行危机与估值"><span class="header-section-number">10</span> 银行危机与估值</h2>
<section id="银行的商业模式" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="银行的商业模式"><span class="header-section-number">10.1</span> 银行的商业模式</h3>
<p>要理解银行风险，首先要理解银行的商业模式：</p>
<pre><code>存款（原材料）→ 贷款 + 投资证券（产品）→ 利差收入（利润）</code></pre>
<p><strong>价值驱动因素</strong>： 1. <strong>利差</strong>：贷款和投资的利息收入 - 存款和债务的利息支出 2. <strong>损失</strong>：贷款违约和投资证券亏损 3. <strong>监管资本</strong>：将部分利润留存为监管资本，以支持未来增长</p>
</section>
<section id="好银行-vs-坏银行" class="level3" data-number="10.2">
<h3 data-number="10.2" class="anchored" data-anchor-id="好银行-vs-坏银行"><span class="header-section-number">10.2</span> 好银行 vs 坏银行</h3>
<p>什么区分好银行和坏银行？</p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 36%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>维度</th>
<th>坏银行</th>
<th>好银行</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>存款</strong></td>
<td>低比例无息存款<br>存款利率高<br>存款敏感（易流失）</td>
<td>高比例无息存款<br>存款利率低<br>存款粘性强</td>
</tr>
<tr class="even">
<td><strong>资本</strong></td>
<td>Tier 1 资本比率低<br>玩监管资本游戏<br>账面股权比例低</td>
<td>Tier 1 资本比率高<br>不玩资本游戏<br>账面股权比例高</td>
</tr>
<tr class="odd">
<td><strong>贷款</strong></td>
<td>借款人集中<br>利率低于风险<br>损失准备不足</td>
<td>借款人分散<br>利率反映风险<br>损失准备充足</td>
</tr>
<tr class="even">
<td><strong>投资证券</strong></td>
<td>久期错配<br>低比例按市价计量<br>流动性差</td>
<td>久期匹配存款<br>高比例按市价计量<br>流动性好</td>
</tr>
</tbody>
</table>
</section>
<section id="宏观压力测试" class="level3" data-number="10.3">
<h3 data-number="10.3" class="anchored" data-anchor-id="宏观压力测试"><span class="header-section-number">10.3</span> 宏观压力测试</h3>
<p>银行危机通常由宏观因素触发：</p>
<ol type="1">
<li><strong>经济衰退</strong>：增加全面违约风险</li>
<li><strong>资产泡沫破裂</strong>：如 2008 年房价暴跌</li>
<li><strong>通胀和利率上升</strong>：导致债券投资亏损</li>
</ol>
</section>
<section id="案例硅谷银行svb的崩塌2023年" class="level3" data-number="10.4">
<h3 data-number="10.4" class="anchored" data-anchor-id="案例硅谷银行svb的崩塌2023年"><span class="header-section-number">10.4</span> 案例：硅谷银行（SVB）的崩塌（2023年）</h3>
<p>2022 年，美国国债利率从 1.51% 升至 3.88%，导致 10 年期国债价格下跌超过 19%。所有持有长期国债的银行都受到影响，但为什么硅谷银行率先崩塌？</p>
<p><strong>SVB 的致命弱点</strong>：</p>
<ol type="1">
<li><strong>极度敏感的存款基础</strong>：
<ul>
<li>服务于硅谷（创始人、VC、员工）</li>
<li>存款人同质化程度高，容易集体行动</li>
<li>大额存款为主，超过 FDIC 保险限额</li>
<li>社交媒体加速谣言传播</li>
</ul></li>
<li><strong>被高估的资本</strong>：
<ul>
<li>Tier 1 资本看起来充足</li>
<li>但未反映投资证券的未实现亏损</li>
<li>亏损一旦实现，资本将大幅缩水</li>
</ul></li>
<li><strong>风险贷款组合</strong>：
<ul>
<li>大量”风险债务”（Venture Debt）</li>
<li>依赖未来 VC 轮次融资</li>
<li>2022 年 VC 投资萎缩，风险债务受损</li>
</ul></li>
<li><strong>久期严重错配</strong>：
<ul>
<li>55-60% 资产投资于国债和 MBS</li>
<li>这些是长期证券</li>
<li>但存款是短期的（活期存款）</li>
<li>利率上升时，资产大幅贬值，但负债不变</li>
</ul></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">警告</span>银行危机的教训
</div>
</div>
<div class="callout-body-container callout-body">
<p>SVB 的失败揭示了一个关键风险指标：<strong>存款粘性</strong>。</p>
<p>不是贷款质量，不是投资证券的信用风险，而是存款流失的速度决定了哪些银行会倒闭。当存款人开始撤离，银行被迫出售投资证券，实现亏损，进一步加剧恐慌。</p>
<p>SVB 之后，Signature Bank 和 First Republic Bank 相继倒闭，都有一个共同特征：<strong>存款敏感度高</strong>。</p>
</div>
</div>
</section>
<section id="银行估值的危机指标" class="level3" data-number="10.5">
<h3 data-number="10.5" class="anchored" data-anchor-id="银行估值的危机指标"><span class="header-section-number">10.5</span> 银行估值的危机指标</h3>
<p>在银行危机期间，评估银行是否被低估需要考虑：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>指标</th>
<th>衡量内容</th>
<th>低估信号</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PBV</td>
<td>股价相对账面价值</td>
<td>低</td>
</tr>
<tr class="even">
<td>ROE</td>
<td>盈利能力</td>
<td>高</td>
</tr>
<tr class="odd">
<td>利差</td>
<td>银行商业模式的盈利性</td>
<td>高</td>
</tr>
<tr class="even">
<td>存款增长</td>
<td>存款粘性（高增长 = 低粘性）</td>
<td>低</td>
</tr>
<tr class="odd">
<td>Tier 1 资本比率</td>
<td>资本缓冲</td>
<td>高</td>
</tr>
<tr class="even">
<td>持有至到期证券%</td>
<td>未披露亏损的风险</td>
<td>低</td>
</tr>
<tr class="odd">
<td>股息率</td>
<td>现金回报</td>
<td>高</td>
</tr>
</tbody>
</table>
<p>2023 年银行危机期间，花旗银行（Citi）是最接近”低估”标准的大银行： - PBV = 0.50（最低） - Tier 1 资本比率 = 14.80%（高） - 存款增长 = 3.74%（低） - 利差 = 9.39%（最高）</p>
<p>但 ROE 只有 8.11%，低于中位数 12%。这解释了为什么 PBV 低——市场反映了低盈利能力。</p>
</section>
</section>
<section id="存款保险与银行价值" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="存款保险与银行价值"><span class="header-section-number">11</span> 存款保险与银行价值</h2>
<p>大多数国家为银行存款提供保险（如美国 FDIC 的 $250,000 限额）。这对银行价值有什么影响？</p>
<p><strong>理论上</strong>，如果保险费率公平反映风险，对价值没有影响。</p>
<p><strong>实践中</strong>，存款保险可能扭曲价值：</p>
<ol type="1">
<li><p><strong>保险费率不随风险变化</strong>：稳健银行和激进银行支付相同费率。这意味着：</p>
<ul>
<li>稳健银行被多收费</li>
<li>激进银行被补贴</li>
<li>创造了银行承担更多风险的激励</li>
</ul></li>
<li><p><strong>存款保险是一个看跌期权</strong>：银行可以将存款负债”卖给”保险机构（如果贷款组合价值低于负债）。如果期权价格不随贷款组合波动率变化，高风险银行获得更多价值。</p></li>
<li><p><strong>纳税人补贴</strong>：如果保险由纳税人补贴，所有银行都从中受益。</p></li>
</ol>
</section>
<section id="非银行金融服务公司" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="非银行金融服务公司"><span class="header-section-number">12</span> 非银行金融服务公司</h2>
<section id="资产管理公司" class="level3" data-number="12.1">
<h3 data-number="12.1" class="anchored" data-anchor-id="资产管理公司"><span class="header-section-number">12.1</span> 资产管理公司</h3>
<p><strong>盈利驱动因素</strong>： - <strong>管理资产规模（AUM）</strong>：客户投资的总资产 - <strong>费率</strong>：通常是 AUM 的百分比（如对冲基金的 2% + 20%） - <strong>费用</strong>：分析师、投资组合经理的薪酬</p>
<p><strong>再投资</strong>： - 主要是人力资本投资（培训、招聘） - 资本密集度低，成功的资产管理公司应有高 ROE</p>
<p><strong>风险</strong>： - 资产类别表现不佳 → AUM 下降 → 费用收入下降 - 业绩落后同行 → 客户流失 → AUM 下降 - 客户粘性是关键风险因素</p>
<p>近年来，被动投资（ETF、指数基金）的崛起对主动管理公司构成压力，费率下降趋势明显。</p>
</section>
<section id="支付处理公司" class="level3" data-number="12.2">
<h3 data-number="12.2" class="anchored" data-anchor-id="支付处理公司"><span class="header-section-number">12.2</span> 支付处理公司</h3>
<p><strong>盈利驱动因素</strong>： - <strong>总交易额（GTV）</strong>：平台上发生的交易总额 - <strong>费率（Take Rate）</strong>：支付处理公司获取的交易比例 - <strong>费用</strong>：技术和客户服务成本</p>
<p><strong>再投资</strong>： - 获取新商户和客户 - 平台技术投资 - 并购其他支付公司</p>
<p><strong>风险</strong>： - 宏观经济风险：经济衰退 → 消费减少 → 交易额下降 - 欺诈风险：平台必须承担部分欺诈损失 - 坏账风险：客户未履行支付义务</p>
<p>数字支付的兴起（如 PayPal、Venmo）正在挑战传统信用卡公司（Visa、Mastercard）的主导地位。</p>
</section>
<section id="经纪公司" class="level3" data-number="12.3">
<h3 data-number="12.3" class="anchored" data-anchor-id="经纪公司"><span class="header-section-number">12.3</span> 经纪公司</h3>
<p><strong>盈利驱动因素</strong>： - <strong>交易额</strong>：经纪交易的总价值 - <strong>佣金率</strong>：经纪公司获取的比例 - <strong>费用</strong>：信息、法律、合规成本</p>
<p><strong>再投资</strong>： - 雇用更多经纪人 - 投资交易平台</p>
<p><strong>风险</strong>： - 市场风险：股市/房市下跌 → 交易量下降 - 监管风险：合规成本增加</p>
<p>技术已经大幅压缩了股票经纪佣金，但房地产经纪佣金几乎没有变化。</p>
</section>
</section>
<section id="总结" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="总结"><span class="header-section-number">13</span> 总结</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">重要</span>核心要点
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p><strong>直接估值股权</strong>：由于债务定义模糊，金融服务公司应直接估值股权，使用股权成本（而非 WACC）和股权倍数（PE、PBV 而非 EV/EBITDA）</p></li>
<li><p><strong>三种 DCF 方法</strong>：</p>
<ul>
<li><strong>DDM</strong>：最传统，使用股息作为现金流</li>
<li><strong>FCFE 模型</strong>：将监管资本投资视为再投资</li>
<li><strong>超额回报模型</strong>：价值 = 账面股权 + 超额回报现值</li>
</ul></li>
<li><p><strong>ROE 是核心指标</strong>：</p>
<ul>
<li>决定增长率：g = 留存率 × ROE</li>
<li>决定 PBV：如果 ROE &gt; 股权成本，PBV &gt; 1</li>
<li>决定超额回报：超额回报 = (ROE - 股权成本) × 股权</li>
</ul></li>
<li><p><strong>危机中的估值</strong>：</p>
<ul>
<li>存款粘性比贷款质量更重要</li>
<li>久期错配是隐藏风险</li>
<li>未按市价计量的证券可能隐藏亏损</li>
</ul></li>
<li><p><strong>监管资本的双重角色</strong>：</p>
<ul>
<li>是银行的”再投资”</li>
<li>也是风险缓冲</li>
<li>影响增长能力和安全性</li>
</ul></li>
</ol>
</div>
</div>
<p>回到开头的问题：为什么金融服务公司难以用传统 DCF 估值？</p>
<p>答案是：<strong>债务和再投资的定义在金融公司中完全不同</strong>。存款是原材料而非资本来源，监管资本投资是再投资而非资本支出。一旦理解这些差异，我们就可以用适当调整的 DCF 模型来估值金融公司。</p>
<p><code>✶ Insight ─────────────────────────────────────</code> <strong>Damodaran 的核心洞察</strong>：</p>
<p>金融服务公司估值的本质是<strong>股权估值</strong>。当你无法定义债务和营业利润时，WACC 和 FCFF 就没有意义。但股权成本、净利润、股息——这些概念在金融公司中同样有效。</p>
<p>超额回报模型揭示了一个深刻的真理：银行的价值取决于它能否持续赚取超过股权成本的回报。一家以低于账面价值交易的银行，市场正在告诉你：它的 ROE 不会持续高于股权成本。 <code>─────────────────────────────────────────────────</code></p>
</section>
<section id="思考题" class="level2" data-number="14">
<h2 data-number="14" class="anchored" data-anchor-id="思考题"><span class="header-section-number">14</span> 思考题</h2>
<ol type="1">
<li><p><strong>债务定义的影响</strong>：如果一家银行的存款全部是无息活期存款，它在估值中应该被视为”无债务”公司吗？这会如何影响其股权成本和估值？</p></li>
<li><p><strong>ROE 与增长的权衡</strong>：一家银行有两个选择：(a) 维持 15% 的 ROE 但将派息率提高到 60%；(b) 将 ROE 提高到 18% 但降低派息率到 30%。假设股权成本是 12%，哪个选择创造更多价值？</p></li>
<li><p><strong>监管资本与增长</strong>：如果监管机构将最低 Tier 1 资本比率从 8% 提高到 10%，这对银行估值有什么影响？银行可能如何应对？</p></li>
<li><p><strong>PBV &lt; 1 的含义</strong>：2024 年，大多数欧洲银行的 PBV 低于 1。这是否意味着它们都被低估？需要检查什么基本面因素才能做出判断？</p></li>
<li><p><strong>硅谷银行的教训</strong>：从 SVB 的失败中，你认为在估值银行时应该特别关注哪些风险指标？传统的风险指标（如贷款不良率）是否足够？</p></li>
<li><p><strong>资产管理公司估值</strong>：一家资产管理公司管理 1,000 亿美元 AUM，年费率 0.5%，运营利润率 40%。如果 AUM 预计每年增长 5%，股权成本 10%，稳定增长率 3%，你如何估值这家公司？</p></li>
</ol>


</section>

</main> <!-- /main -->
﻿<script>

// Simple EN / 中文 language toggle for posts; robust via meta[quarto:offset]

(function() {

  const KEY = 'siteLang'; // 'en' | 'zh'

  const defaultLang = 'en';

  const POSTS_EN = 'posts_en.html';

  const POSTS_ZH = 'posts_zh.html';

  const TAGS = 'tags.html';



  function currentLang() { try { return localStorage.getItem(KEY) || defaultLang; } catch(e) { return defaultLang; } }

  function setLang(v) { try { localStorage.setItem(KEY, v); } catch(e) {} }

  function offset() {

    const meta = document.querySelector('meta[name="quarto:offset"]');

    const off = meta && meta.getAttribute('content') ? meta.getAttribute('content') : './';

    return off;

  }

  function targetFor(lang) { return lang === 'zh' ? POSTS_ZH : POSTS_EN; }

  function goToLang(lang) {

    const off = offset();

    const path = window.location.pathname;

    setLang(lang);

    if (path.endsWith('/' + TAGS) || path.endsWith(TAGS)) {

      window.location.href = off + TAGS;

    } else {

      window.location.href = off + targetFor(lang);

    }

  }

  function updateNavbarPostsLink() {

    const off = offset();

    const href = off + targetFor(currentLang());

    const links = document.querySelectorAll('header .navbar a.nav-link');

    links.forEach((a) => {

      const h = a.getAttribute('href') || '';

      if (h.endsWith(POSTS_EN) || h.endsWith(POSTS_ZH)) a.setAttribute('href', href);

    });

  }

  function mountToggle() {

    const tools = document.querySelector('.quarto-navbar-tools');

    if (!tools) return;

    const wrapper = document.createElement('div');

    wrapper.style.display = 'inline-flex';

    wrapper.style.alignItems = 'center';

    wrapper.style.gap = '0.35rem';

    wrapper.style.marginLeft = '0.35rem';



    const en = document.createElement('a');

    en.href = '';

    en.textContent = 'EN';

    en.className = 'quarto-navigation-tool px-1';

    en.onclick = function(){ goToLang('en'); return false; };



    const sep = document.createElement('span');

    sep.textContent = '|';

    sep.style.opacity = '0.6';



    const zh = document.createElement('a');

    zh.href = '';

    zh.textContent = '中文';

    zh.className = 'quarto-navigation-tool px-1';

    zh.onclick = function(){ goToLang('zh'); return false; };



    const lang = currentLang();

    (lang === 'en' ? en : zh).style.fontWeight = '700';



    wrapper.appendChild(en);

    wrapper.appendChild(sep);

    wrapper.appendChild(zh);

    tools.appendChild(wrapper);

    updateNavbarPostsLink();

  }

  document.addEventListener('DOMContentLoaded', mountToggle);

})();

</script>

<script>

(function(){

  function offset(){

    var meta = document.querySelector('meta[name="quarto:offset"]');

    return meta && meta.getAttribute('content') ? meta.getAttribute('content') : './';

  }

  document.addEventListener('DOMContentLoaded', function(){

    var brand = document.querySelector('header .navbar a.navbar-brand');

    if (brand) {

      brand.setAttribute('href', offset() + 'home.html');

    }

  });

})();

</script>



<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "已复制");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "已复制");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>