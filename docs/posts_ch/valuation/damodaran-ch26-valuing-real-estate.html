<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans" xml:lang="zh-Hans"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ying">
<meta name="description" content="股票估值的DCF方法能直接用于房地产吗？房地产的独特风险如何量化？Cap Rate与WACC有什么关系？本章探讨如何将金融资产估值框架应用于最大的实物资产类别。">

<title>【第26章】房地产估值：当估值遇见实物资产 – Tech Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-597958c53c93a607afca12fd375c57ed.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-1b3db88def35042d172274863c1cdcf0.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-597958c53c93a607afca12fd375c57ed.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-ea2c01f27a86cd888be845a75ab84aaf.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-6ee47bd5d569ce80d002539aadcc850f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-ea2c01f27a86cd888be845a75ab84aaf.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script>
<!-- Force refresh if cache is stale -->

<script>

(function() {

  var SITE_VERSION = '2025-11-14-v2'; // Update this to force all users to refresh

  var stored = localStorage.getItem('site_version');

  if (stored !== SITE_VERSION) {

    localStorage.setItem('site_version', SITE_VERSION);

    if (stored !== null) {

      // Not first visit, force reload from server

      window.location.reload(true);

    }

  }

})();

</script>

<script>

// Default to dark scheme on first visit (no prior preference stored)

try {

  var key = 'quarto-color-scheme';

  if (window && window.localStorage && window.localStorage.getItem(key) === null) {

    window.localStorage.setItem(key, 'alternate');

  }

} catch (e) {

  // ignore storage errors (privacy mode, etc.)

}

</script>

<!-- Aggressive cache prevention for HTML pages -->

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">

<meta http-equiv="Pragma" content="no-cache">

<meta http-equiv="Expires" content="0">

<meta name="revisit-after" content="1 days">

<meta name="robots" content="noarchive">




  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Tech Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="搜索"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="展开或折叠导航栏" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../home.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts_en.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tags.html"> 
<span class="menu-text">Tags</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="切换深色模式"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">该页面内容</h2>
   
  <ul>
  <li><a href="#从一个问题开始" id="toc-从一个问题开始" class="nav-link active" data-scroll-target="#从一个问题开始"><span class="header-section-number">1</span> 从一个问题开始</a></li>
  <li><a href="#实物资产-vs-金融资产基本差异" id="toc-实物资产-vs-金融资产基本差异" class="nav-link" data-scroll-target="#实物资产-vs-金融资产基本差异"><span class="header-section-number">2</span> 实物资产 vs 金融资产：基本差异</a>
  <ul class="collapse">
  <li><a href="#共同的估值基础" id="toc-共同的估值基础" class="nav-link" data-scroll-target="#共同的估值基础"><span class="header-section-number">2.1</span> 共同的估值基础</a></li>
  <li><a href="#关键差异" id="toc-关键差异" class="nav-link" data-scroll-target="#关键差异"><span class="header-section-number">2.2</span> 关键差异</a></li>
  <li><a href="#通胀效应房地产的独特优势" id="toc-通胀效应房地产的独特优势" class="nav-link" data-scroll-target="#通胀效应房地产的独特优势"><span class="header-section-number">2.3</span> 通胀效应：房地产的独特优势</a></li>
  </ul></li>
  <li><a href="#房地产被低估的资产类别" id="toc-房地产被低估的资产类别" class="nav-link" data-scroll-target="#房地产被低估的资产类别"><span class="header-section-number">3</span> 房地产：被低估的资产类别</a>
  <ul class="collapse">
  <li><a href="#规模远比你想象的大" id="toc-规模远比你想象的大" class="nav-link" data-scroll-target="#规模远比你想象的大"><span class="header-section-number">3.1</span> 规模：远比你想象的大</a></li>
  <li><a href="#历史回报打破房地产神话" id="toc-历史回报打破房地产神话" class="nav-link" data-scroll-target="#历史回报打破房地产神话"><span class="header-section-number">3.2</span> 历史回报：打破房地产神话</a></li>
  <li><a href="#与其他资产类别的联动性" id="toc-与其他资产类别的联动性" class="nav-link" data-scroll-target="#与其他资产类别的联动性"><span class="header-section-number">3.3</span> 与其他资产类别的联动性</a></li>
  </ul></li>
  <li><a href="#内在价值估值折现率的挑战" id="toc-内在价值估值折现率的挑战" class="nav-link" data-scroll-target="#内在价值估值折现率的挑战"><span class="header-section-number">4</span> 内在价值估值：折现率的挑战</a>
  <ul class="collapse">
  <li><a href="#核心问题边际投资者是否分散化" id="toc-核心问题边际投资者是否分散化" class="nav-link" data-scroll-target="#核心问题边际投资者是否分散化"><span class="header-section-number">4.1</span> 核心问题：边际投资者是否分散化？</a></li>
  <li><a href="#方法一传统资产定价模型" id="toc-方法一传统资产定价模型" class="nav-link" data-scroll-target="#方法一传统资产定价模型"><span class="header-section-number">4.2</span> 方法一：传统资产定价模型</a></li>
  <li><a href="#方法二总beta调整非分散化投资者" id="toc-方法二总beta调整非分散化投资者" class="nav-link" data-scroll-target="#方法二总beta调整非分散化投资者"><span class="header-section-number">4.3</span> 方法二：总Beta调整（非分散化投资者）</a></li>
  <li><a href="#方法三流动性折价" id="toc-方法三流动性折价" class="nav-link" data-scroll-target="#方法三流动性折价"><span class="header-section-number">4.4</span> 方法三：流动性折价</a></li>
  <li><a href="#方法四其他风险溢价" id="toc-方法四其他风险溢价" class="nav-link" data-scroll-target="#方法四其他风险溢价"><span class="header-section-number">4.5</span> 方法四：其他风险溢价</a></li>
  <li><a href="#方法五调查法" id="toc-方法五调查法" class="nav-link" data-scroll-target="#方法五调查法"><span class="header-section-number">4.6</span> 方法五：调查法</a></li>
  <li><a href="#从股权成本到资本成本" id="toc-从股权成本到资本成本" class="nav-link" data-scroll-target="#从股权成本到资本成本"><span class="header-section-number">4.7</span> 从股权成本到资本成本</a></li>
  </ul></li>
  <li><a href="#现金流与终值" id="toc-现金流与终值" class="nav-link" data-scroll-target="#现金流与终值"><span class="header-section-number">5</span> 现金流与终值</a>
  <ul class="collapse">
  <li><a href="#现金流入" id="toc-现金流入" class="nav-link" data-scroll-target="#现金流入"><span class="header-section-number">5.1</span> 现金流入</a></li>
  <li><a href="#现金流出" id="toc-现金流出" class="nav-link" data-scroll-target="#现金流出"><span class="header-section-number">5.2</span> 现金流出</a></li>
  <li><a href="#预期增长" id="toc-预期增长" class="nav-link" data-scroll-target="#预期增长"><span class="header-section-number">5.3</span> 预期增长</a></li>
  <li><a href="#终值" id="toc-终值" class="nav-link" data-scroll-target="#终值"><span class="header-section-number">5.4</span> 终值</a></li>
  <li><a href="#未开发土地一种特殊情况" id="toc-未开发土地一种特殊情况" class="nav-link" data-scroll-target="#未开发土地一种特殊情况"><span class="header-section-number">5.5</span> 未开发土地：一种特殊情况</a></li>
  </ul></li>
  <li><a href="#dcf估值案例711-third-avenue" id="toc-dcf估值案例711-third-avenue" class="nav-link" data-scroll-target="#dcf估值案例711-third-avenue"><span class="header-section-number">6</span> DCF估值案例：711 Third Avenue</a>
  <ul class="collapse">
  <li><a href="#物业基本信息" id="toc-物业基本信息" class="nav-link" data-scroll-target="#物业基本信息"><span class="header-section-number">6.1</span> 物业基本信息</a></li>
  <li><a href="#第一步估计资本成本" id="toc-第一步估计资本成本" class="nav-link" data-scroll-target="#第一步估计资本成本"><span class="header-section-number">6.2</span> 第一步：估计资本成本</a></li>
  <li><a href="#第二步估计现金流" id="toc-第二步估计现金流" class="nav-link" data-scroll-target="#第二步估计现金流"><span class="header-section-number">6.3</span> 第二步：估计现金流</a></li>
  <li><a href="#第三步计算终值和物业价值" id="toc-第三步计算终值和物业价值" class="nav-link" data-scroll-target="#第三步计算终值和物业价值"><span class="header-section-number">6.4</span> 第三步：计算终值和物业价值</a></li>
  <li><a href="#股权价值估值" id="toc-股权价值估值" class="nav-link" data-scroll-target="#股权价值估值"><span class="header-section-number">6.5</span> 股权价值估值</a></li>
  </ul></li>
  <li><a href="#相对估值" id="toc-相对估值" class="nav-link" data-scroll-target="#相对估值"><span class="header-section-number">7</span> 相对估值</a>
  <ul class="collapse">
  <li><a href="#为什么使用相对估值" id="toc-为什么使用相对估值" class="nav-link" data-scroll-target="#为什么使用相对估值"><span class="header-section-number">7.1</span> 为什么使用相对估值？</a></li>
  <li><a href="#标准化指标" id="toc-标准化指标" class="nav-link" data-scroll-target="#标准化指标"><span class="header-section-number">7.2</span> 标准化指标</a></li>
  <li><a href="#可比物业定价案例" id="toc-可比物业定价案例" class="nav-link" data-scroll-target="#可比物业定价案例"><span class="header-section-number">7.3</span> 可比物业定价案例</a></li>
  <li><a href="#回归方法" id="toc-回归方法" class="nav-link" data-scroll-target="#回归方法"><span class="header-section-number">7.4</span> 回归方法</a></li>
  <li><a href="#相对估值在房地产中的优势" id="toc-相对估值在房地产中的优势" class="nav-link" data-scroll-target="#相对估值在房地产中的优势"><span class="header-section-number">7.5</span> 相对估值在房地产中的优势</a></li>
  </ul></li>
  <li><a href="#房地产企业估值" id="toc-房地产企业估值" class="nav-link" data-scroll-target="#房地产企业估值"><span class="header-section-number">8</span> 房地产企业估值</a>
  <ul class="collapse">
  <li><a href="#收入来源" id="toc-收入来源" class="nav-link" data-scroll-target="#收入来源"><span class="header-section-number">8.1</span> 收入来源</a></li>
  <li><a href="#组织形式" id="toc-组织形式" class="nav-link" data-scroll-target="#组织形式"><span class="header-section-number">8.2</span> 组织形式</a></li>
  </ul></li>
  <li><a href="#批判性讨论dcf在房地产中的局限" id="toc-批判性讨论dcf在房地产中的局限" class="nav-link" data-scroll-target="#批判性讨论dcf在房地产中的局限"><span class="header-section-number">9</span> 批判性讨论：DCF在房地产中的局限</a></li>
  <li><a href="#总结" id="toc-总结" class="nav-link" data-scroll-target="#总结"><span class="header-section-number">10</span> 总结</a></li>
  <li><a href="#中国视角房地产估值的本土化思考" id="toc-中国视角房地产估值的本土化思考" class="nav-link" data-scroll-target="#中国视角房地产估值的本土化思考"><span class="header-section-number">11</span> 中国视角：房地产估值的本土化思考</a></li>
  <li><a href="#思考题" id="toc-思考题" class="nav-link" data-scroll-target="#思考题"><span class="header-section-number">12</span> 思考题</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">【第26章】房地产估值：当估值遇见实物资产</h1>
  <div class="quarto-categories">
    <div class="quarto-category">金融</div>
    <div class="quarto-category">投资</div>
    <div class="quarto-category">估值</div>
  </div>
  </div>

<div>
  <div class="description">
    股票估值的DCF方法能直接用于房地产吗？房地产的独特风险如何量化？Cap Rate与WACC有什么关系？本章探讨如何将金融资产估值框架应用于最大的实物资产类别。
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">作者</div>
    <div class="quarto-title-meta-contents">
             <p>Ying </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">发布于</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2025年12月26日</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="从一个问题开始" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="从一个问题开始"><span class="header-section-number">1</span> 从一个问题开始</h2>
<p>假设你有两个投资机会：一是购买一只股票，二是购买一栋写字楼。两者都会产生现金流，都有风险，都需要估值。</p>
<p><strong>问题来了</strong>：你能用同样的DCF方法来估值这两种资产吗？</p>
<p>房地产从业者可能会说”不行”——房地产太特殊了，需要专门的估值方法。但 Damodaran 的观点恰恰相反：<strong>估值的基本原理不应该因资产类别而改变</strong>。任何能产生现金流的资产，其价值都等于预期现金流的现值。</p>
<p>但这并不意味着房地产估值没有挑战。恰恰相反，房地产估值面临一系列独特的估计难题：</p>
<ul>
<li><strong>折现率</strong>：房地产不像股票那样频繁交易，如何估计Beta？</li>
<li><strong>现金流</strong>：租金、空置率、维护成本如何预测？</li>
<li><strong>终值</strong>：建筑会折旧，但土地不会——终值该怎么算？</li>
<li><strong>流动性</strong>：房地产不像股票那样可以随时卖出，这个风险如何定价？</li>
</ul>
<p>本章将逐一回答这些问题。你会发现，房地产估值不是”另一套体系”，而是<strong>DCF框架在实物资产上的应用</strong>——只是需要针对实物资产的特点做出调整。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">注记</span>章节定位
</div>
</div>
<div class="callout-body-container callout-body">
<p>本章属于”特殊情境估值”模块（第21-27章），专门讨论需要调整标准估值框架的特殊资产类型。在第21章（金融服务公司）中，我们讨论了”当债务是原材料时，FCFF没有意义”的问题。本章则讨论”当资产不频繁交易时，如何估计风险和折现率”的问题。</p>
</div>
</div>
</section>
<section id="实物资产-vs-金融资产基本差异" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="实物资产-vs-金融资产基本差异"><span class="header-section-number">2</span> 实物资产 vs 金融资产：基本差异</h2>
<section id="共同的估值基础" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="共同的估值基础"><span class="header-section-number">2.1</span> 共同的估值基础</h3>
<p>让我们先确认房地产和股票的<strong>共同点</strong>——这是我们能使用统一估值框架的基础：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>维度</th>
<th>房地产</th>
<th>股票</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>价值来源</td>
<td>预期现金流的现值</td>
<td>预期现金流的现值</td>
</tr>
<tr class="even">
<td>价值驱动因素</td>
<td>现金流水平、增长率、风险</td>
<td>现金流水平、增长率、风险</td>
</tr>
<tr class="odd">
<td>基本规律</td>
<td>现金流↑ 或 风险↓ → 价值↑</td>
<td>现金流↑ 或 风险↓ → 价值↑</td>
</tr>
</tbody>
</table>
<p>这意味着，从原理上讲，DCF模型完全可以用于房地产估值。</p>
</section>
<section id="关键差异" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="关键差异"><span class="header-section-number">2.2</span> 关键差异</h3>
<p>然而，实物资产和金融资产也有重要差异：</p>
<p><strong>差异一：有限寿命 vs 无限寿命</strong></p>
<p>股票代表公司所有权，理论上可以永续经营。但建筑会老化、折旧，最终需要重建或拆除。</p>
<p>这意味着什么？</p>
<ul>
<li>股票的终值通常<strong>高于</strong>当前价值（因为增长）</li>
<li>建筑的终值可能<strong>低于</strong>当前价值（因为折旧）</li>
<li>但土地是永久的，可能成为终值的主要组成部分</li>
</ul>
<p><strong>差异二：交易频率</strong></p>
<p>股票每天都有价格，Beta可以直接从历史价格回归得到。但一栋写字楼可能几年才交易一次。</p>
<p>这带来的问题： - 没有频繁的价格数据 → 无法直接计算Beta - 价格指数基于评估值 → 可能低估真实波动性 - “平滑”的价格序列 → 产生虚假的低风险假象</p>
<p><strong>差异三：投资者特征</strong></p>
<p>股票的边际投资者通常是分散化的机构投资者。但房地产投资者可能： - 集中持有房地产（“专注于自己懂的领域”） - 依赖本地知识（“熟悉这个市场”） - 无法充分分散化（“投资门槛太高”）</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">重要</span>核心洞察：估值原理相同，但参数估计需要调整
</div>
</div>
<div class="callout-body-container callout-body">
<p>房地产估值的挑战不在于”需要不同的模型”，而在于”相同模型的输入参数更难估计”。本章的重点就是解决这些估计难题。</p>
</div>
</div>
</section>
<section id="通胀效应房地产的独特优势" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="通胀效应房地产的独特优势"><span class="header-section-number">2.3</span> 通胀效应：房地产的独特优势</h3>
<p>有一个有趣的现象：当通胀意外上升时，<strong>金融资产下跌，但房地产上涨</strong>。</p>
<p>Fama 和 Schwert 的研究发现：通胀率每上升1%： - 债券价格下跌 <strong>1.54%</strong> - 股票价格下跌 <strong>4.23%</strong> - 住宅房地产价格<strong>上涨</strong></p>
<p>为什么房地产能对冲通胀？</p>
<ol type="1">
<li><strong>租金调整</strong>：房东可以在通胀时期提高租金</li>
<li><strong>折旧税盾</strong>：通胀时期，名义折旧带来的税盾价值相对提高</li>
<li><strong>实物资产偏好</strong>：通胀失控时，投资者”逃离”金融资产，涌入实物资产</li>
</ol>
<p><strong>投资组合含义</strong>：如果房地产与金融资产负相关，那么将房地产加入股债组合可以改善风险收益比——这是”分散化投资应包含房地产”这一建议的理论基础。</p>
<p>但这个结论需要更新。稍后我们会看到，随着房地产证券化程度提高，房地产与金融资产的相关性也在上升。</p>
</section>
</section>
<section id="房地产被低估的资产类别" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="房地产被低估的资产类别"><span class="header-section-number">3</span> 房地产：被低估的资产类别</h2>
<section id="规模远比你想象的大" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="规模远比你想象的大"><span class="header-section-number">3.1</span> 规模：远比你想象的大</h3>
<p>如果只看上市房地产公司和REITs，房地产似乎只是资本市场的一小部分：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>类别</th>
<th>美国市值（2023）</th>
<th>全球市值（2023）</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>REITs</td>
<td>$1.12万亿</td>
<td>$1.52万亿</td>
</tr>
<tr class="even">
<td>房地产开发</td>
<td>$67亿</td>
<td>$5,130亿</td>
</tr>
<tr class="odd">
<td>房地产综合/多元化</td>
<td>$50亿</td>
<td>$3,499亿</td>
</tr>
<tr class="even">
<td>房地产运营与服务</td>
<td>$1,080亿</td>
<td>$6,057亿</td>
</tr>
<tr class="odd">
<td>占市场总值比例</td>
<td><strong>4.15%</strong></td>
<td><strong>2.69%</strong></td>
</tr>
</tbody>
</table>
<p>但这些数字严重低估了房地产的真实规模。<strong>大部分房地产是不交易的</strong>。</p>
<p>2023年全球资产规模： - <strong>房地产总值</strong>：$614万亿（住宅$115万亿 + 商业$499万亿） - <strong>股票总市值</strong>：$109万亿</p>
<p>换句话说，<strong>房地产的价值是全球股票市值的5-6倍</strong>。这可能是投资者最熟悉却又最不被当作”投资”来分析的资产类别——很多人拥有自住房产，但从不把它纳入投资组合分析。</p>
</section>
<section id="历史回报打破房地产神话" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="历史回报打破房地产神话"><span class="header-section-number">3.2</span> 历史回报：打破房地产神话</h3>
<p>让我们看看房地产的真实历史表现：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>资产类别</th>
<th>数据来源</th>
<th>时期</th>
<th>算术平均</th>
<th>标准差</th>
<th>几何平均</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>股票</td>
<td>S&amp;P 500</td>
<td>1928-2023</td>
<td>11.66%</td>
<td>19.55%</td>
<td>9.80%</td>
</tr>
<tr class="even">
<td>10年国债</td>
<td>FRED</td>
<td>1928-2023</td>
<td>4.86%</td>
<td>7.95%</td>
<td>4.57%</td>
</tr>
<tr class="odd">
<td>权益REITs</td>
<td>FTSE</td>
<td>1972-2023</td>
<td>12.74%</td>
<td>18.41%</td>
<td>10.89%</td>
</tr>
<tr class="even">
<td>抵押REITs</td>
<td>FTSE</td>
<td>1972-2023</td>
<td>8.40%</td>
<td>27.64%</td>
<td>4.68%</td>
</tr>
<tr class="odd">
<td>商业地产</td>
<td>NCREIF</td>
<td>1978-2023</td>
<td>9.20%</td>
<td>7.40%</td>
<td>NA</td>
</tr>
<tr class="even">
<td>住宅地产</td>
<td>Case-Shiller</td>
<td>1928-2023</td>
<td>4.42%</td>
<td>6.24%</td>
<td>4.23%</td>
</tr>
</tbody>
</table>
<p>几个重要发现：</p>
<p><strong>发现一：房地产的价格升值并不惊人</strong></p>
<p>住宅房地产1928-2023年的复合回报率是<strong>4.23%/年</strong>，甚至低于10年期国债的4.57%。房地产的总回报主要来自<strong>租金收入</strong>，而非价格升值。</p>
<p><strong>发现二：低波动率可能是假象</strong></p>
<p>NCREIF指数的标准差只有7.40%，远低于REITs的18-28%。但NCREIF是基于<strong>评估值</strong>而非交易价格，评估值被人为”平滑”了。如果投资者据此认为房地产风险很低，<strong>这是一个严重的错误</strong>。</p>
<p><strong>发现三：REITs更像股票而非房地产</strong></p>
<p>权益REITs的回报和波动率特征与股票非常相似，而与基于评估值的房地产指数差异很大。这说明证券化改变了房地产的风险收益特征。</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">警告</span>警告：不要被”低波动率”欺骗
</div>
</div>
<div class="callout-body-container callout-body">
<p>基于评估值的房地产指数（如NCREIF、Case-Shiller）显示的低波动率是<strong>测量问题</strong>造成的假象，而非房地产真实风险较低的证据。直接持有房地产的真实波动率可能与REITs类似。</p>
</div>
</div>
</section>
<section id="与其他资产类别的联动性" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="与其他资产类别的联动性"><span class="header-section-number">3.3</span> 与其他资产类别的联动性</h3>
<p>房地产分散化的价值取决于它与其他资产的相关性。历史数据显示（1947-1982年）：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>住宅房价</th>
<th>农地</th>
<th>S&amp;P 500</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>住宅房价</td>
<td>1.00</td>
<td>0.51</td>
<td><strong>-0.13</strong></td>
</tr>
<tr class="even">
<td>农地</td>
<td>0.51</td>
<td>1.00</td>
<td><strong>-0.10</strong></td>
</tr>
<tr class="odd">
<td>S&amp;P 500</td>
<td>-0.13</td>
<td>-0.10</td>
<td>1.00</td>
</tr>
</tbody>
</table>
<p>房地产与股票<strong>负相关</strong>！这正是分散化的价值所在。</p>
<p><strong>但这个结论可能已经过时了</strong>。</p>
<p>随着房地产证券化程度提高，房地产风险溢价（Cap Rate - 无风险利率）与股票风险溢价的走势越来越一致。1980年代，两者几乎完全独立；到2020年代，两者高度相关。</p>
<p><strong>实践含义</strong>： - “将房地产加入投资组合以分散风险”的传统建议可能需要重新审视 - 证券化使房地产更容易投资，但也使其失去了部分独特性 - 对于追求分散化的投资者，<strong>直接持有的房地产</strong>可能比REITs提供更好的分散化效果</p>
</section>
</section>
<section id="内在价值估值折现率的挑战" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="内在价值估值折现率的挑战"><span class="header-section-number">4</span> 内在价值估值：折现率的挑战</h2>
<p>现在进入估值的核心。DCF估值需要两个关键输入：折现率和现金流。让我们先解决折现率的问题。</p>
<section id="核心问题边际投资者是否分散化" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="核心问题边际投资者是否分散化"><span class="header-section-number">4.1</span> 核心问题：边际投资者是否分散化？</h3>
<p>在第7章和第8章，我们学习了CAPM和资本成本的估计方法。这些方法有一个关键假设：<strong>边际投资者是充分分散化的</strong>，因此只有系统性风险（Beta）才需要被定价。</p>
<p>这个假设对房地产适用吗？</p>
<p><strong>反对意见</strong>： - 房地产投资门槛高，投资者难以分散化 - 房地产需要本地知识，投资者倾向于集中在熟悉的市场 - 很多房地产投资者主要或只投资房地产</p>
<p><strong>支持意见</strong>： - 很多投资者<strong>选择</strong>集中持有，就像科技股投资者选择只持有科技股 - 大型房地产投资可以被分割，允许投资者同时持有房地产和金融资产 - 边际投资者往往是有足够资源分散化的机构投资者</p>
<p><strong>市场演进的逻辑</strong>：</p>
<p>如果未分散化的房地产开发商要求更高的回报率，而分散化的REITs和机构投资者接受更低的回报率，那么：</p>
<p><span class="math display">\[
\text{未分散化投资者的要求回报率} &gt; \text{分散化投资者的要求回报率}
\]</span></p>
<p>这意味着分散化投资者愿意支付更高的价格。随着时间推移，房地产将越来越多地被REITs、私募股权和公司持有——<strong>这正是我们观察到的趋势</strong>。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">注记</span>跨章节联系：与第24章（私有公司估值）的对比
</div>
</div>
<div class="callout-body-container callout-body">
<p>第24章讨论了私有公司估值中的类似问题：当所有者不分散化时，如何调整股权成本？我们引入了”总Beta”的概念。这个概念同样适用于房地产。</p>
</div>
</div>
</section>
<section id="方法一传统资产定价模型" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="方法一传统资产定价模型"><span class="header-section-number">4.2</span> 方法一：传统资产定价模型</h3>
<p>如果我们接受边际投资者是分散化的假设，就可以使用CAPM或多因子模型来估计股权成本。但实际操作面临挑战。</p>
<p><strong>挑战1：个别资产没有价格数据</strong></p>
<p>股票Beta可以从历史价格回归得到。但一栋特定的写字楼可能几年才交易一次。</p>
<p><strong>解决方案</strong>： - 使用<strong>资产类别</strong>的Beta（如”曼哈顿办公楼”的Beta） - 从相应的REIT子类回归估计Beta - 将房地产视为<strong>派生需求</strong>：购物中心的风险应与零售业的风险相关</p>
<p><strong>挑战2：市场组合的定义</strong></p>
<p>理论上，市场组合应包含所有资产。但实践中，我们通常用股票指数代替市场组合。如果房地产占全球财富的大部分，用股票指数估计的Beta可能低估房地产的真实风险。</p>
<p><strong>实用解决方案</strong>：</p>
<ol type="1">
<li><strong>使用房地产指数</strong>：将房地产类别回报（如NCREIF）对综合市场组合回归
<ul>
<li>问题：基于评估值的回报可能低估真实波动性</li>
</ul></li>
<li><strong>使用REITs Beta</strong>：将交易的REITs Beta作为直接房地产投资风险的代理
<ul>
<li>问题：证券化房地产可能与直接投资表现不同</li>
</ul></li>
<li><strong>派生需求法</strong>：购物中心的风险 ≈ 零售业的风险
<ul>
<li>需要调整经营杠杆和财务杠杆的差异</li>
</ul></li>
</ol>
</section>
<section id="方法二总beta调整非分散化投资者" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="方法二总beta调整非分散化投资者"><span class="header-section-number">4.3</span> 方法二：总Beta调整（非分散化投资者）</h3>
<p>如果边际投资者未充分分散化，传统Beta会<strong>低估</strong>其感知的风险。我们需要使用”总Beta”：</p>
<p><span class="math display">\[
\text{总Beta} = \frac{\text{市场Beta}}{\text{投资者组合与市场的相关系数}}
\]</span></p>
<p><strong>例子</strong>：</p>
<p>假设商业房地产的市场Beta是0.40，而边际投资者的组合与市场的相关系数是0.50：</p>
<p><span class="math display">\[
\text{总Beta} = \frac{0.40}{0.50} = 0.80
\]</span></p>
<p>使用这个更高的Beta会导致更高的股权成本和更低的估值。</p>
<p><strong>这解释了一个重要现象</strong>：为什么 Blackrock 这样的分散化投资者能够在收购房地产时击败本地开发商？</p>
<p>答案：分散化投资者接受更低的要求回报率 → 愿意支付更高的价格。</p>
</section>
<section id="方法三流动性折价" class="level3" data-number="4.4">
<h3 data-number="4.4" class="anchored" data-anchor-id="方法三流动性折价"><span class="header-section-number">4.4</span> 方法三：流动性折价</h3>
<p>房地产比股票更难买卖：交易频率低、交易成本高、买卖双方少。这种<strong>流动性不足</strong>是一种风险。</p>
<p>如何处理？两种方法：</p>
<p><strong>方法A：将流动性风险纳入折现率</strong> - 在股权成本上加一个流动性溢价 - 问题：难以量化具体应加多少</p>
<p><strong>方法B：先估值再打折</strong> - 先假设资产是流动的，用标准方法估值 - 然后应用<strong>流动性折价</strong> - 折价幅度取决于投资者和市场条件</p>
<p>流动性折价的决定因素： - <strong>投资期限</strong>：长期投资者对流动性的要求较低 - <strong>市场条件</strong>：繁荣期流动性好，衰退期流动性差 - 参考第24章关于流动性折价估计的讨论</p>
</section>
<section id="方法四其他风险溢价" class="level3" data-number="4.5">
<h3 data-number="4.5" class="anchored" data-anchor-id="方法四其他风险溢价"><span class="header-section-number">4.5</span> 方法四：其他风险溢价</h3>
<p>房地产还面临一些金融资产较少面临的风险：</p>
<p><strong>法律和税务变化风险</strong></p>
<ul>
<li>折旧方法变化、税率变化</li>
<li>分区规定、房产税、租金管制</li>
<li>房地产是<strong>不可移动的</strong>——无法像企业那样迁移到税收优惠地区</li>
</ul>
<p><strong>信息成本风险</strong></p>
<ul>
<li>房地产估值需要本地知识</li>
<li>信息获取成本高、信息噪音大</li>
<li>这与小盘股溢价的解释类似：小公司信息少、噪音大 → 投资者要求更高回报</li>
</ul>
</section>
<section id="方法五调查法" class="level3" data-number="4.6">
<h3 data-number="4.6" class="anchored" data-anchor-id="方法五调查法"><span class="header-section-number">4.6</span> 方法五：调查法</h3>
<p>传统风险模型的困难催生了一种替代方法：<strong>直接调查投资者的要求回报率</strong>。</p>
<p>在房地产行业，这通常以<strong>资本化率（Cap Rate）</strong>的形式进行：</p>
<p><span class="math display">\[
\text{Cap Rate} = \frac{\text{税后经营收入}}{\text{物业价值}}
\]</span></p>
<p>Cap Rate实际上是”要求回报率的另一种表达”。下图显示了不同类型房地产的Cap Rate（2019 vs 2024）：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>物业类型</th>
<th>2019年 Cap Rate</th>
<th>2024年 Cap Rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>办公楼</td>
<td>~6.0%</td>
<td>~8.0%</td>
</tr>
<tr class="even">
<td>多户住宅</td>
<td>~5.5%</td>
<td>~5.5%</td>
</tr>
<tr class="odd">
<td>零售</td>
<td>~5.5%</td>
<td>~6.5%</td>
</tr>
<tr class="even">
<td>工业</td>
<td>~4.5%</td>
<td>~5.0%</td>
</tr>
</tbody>
</table>
<p><strong>调查法的优点</strong>： - 基于实际投资者的要求，而非抽象模型 - 可以获得细分类别（不同地区、不同物业类型）的折现率 - 在投资者相对同质的市场中效果好</p>
<p><strong>调查法的缺点</strong>： - 不同投资者要求的回报不同——谁是边际投资者？ - 绕过了风险分析，但并没有消除风险问题 - 当投资者是”中间人”（买入后证券化转卖）时，应该用最终投资者的要求回报</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">提示</span>实践建议：模型法 vs 调查法
</div>
</div>
<div class="callout-body-container callout-body">
<p>两种方法各有优劣。建议的做法是<strong>两者并用、相互验证</strong>：</p>
<ol type="1">
<li>用CAPM/Beta方法估计一个”理论”折现率</li>
<li>与行业调查的Cap Rate对比</li>
<li>如果差异很大，分析原因：是模型假设问题，还是市场错误定价？</li>
</ol>
</div>
</div>
</section>
<section id="从股权成本到资本成本" class="level3" data-number="4.7">
<h3 data-number="4.7" class="anchored" data-anchor-id="从股权成本到资本成本"><span class="header-section-number">4.7</span> 从股权成本到资本成本</h3>
<p>一旦有了股权成本，计算资本成本就相对简单了。</p>
<p><strong>债务成本的估计</strong>： 1. <strong>新融资</strong>：使用银行贷款的利率（注意隐藏成本，如补偿性余额要求） 2. <strong>已有融资</strong>：根据覆盖率估计合成评级，再估计债务成本 - 对于有限寿命资产，可以在分子中加回折旧</p>
<p><strong>债务比例</strong>： - 实践中常用”融资比例”：如果物业成本$400万，借款$300万，则债务比例=75% - 更准确的方法是用”价值比例”：如果物业价值$500万，债务比例应为60%（$300万/$500万） - 但这产生循环问题——需要资本成本来估计价值，但资本成本又依赖于价值比例</p>
<p><strong>关键区分</strong>： - 如果折现<strong>税前债务现金流（FCFF）</strong> → 使用<strong>资本成本（WACC）</strong> - 如果折现<strong>税后股权现金流（FCFE）</strong> → 使用<strong>股权成本</strong></p>
</section>
</section>
<section id="现金流与终值" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="现金流与终值"><span class="header-section-number">5</span> 现金流与终值</h2>
<section id="现金流入" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="现金流入"><span class="header-section-number">5.1</span> 现金流入</h3>
<p>商业房地产的主要现金流入是<strong>租金和租赁收入</strong>。估计未来租金需要考虑：</p>
<ul>
<li><strong>历史趋势</strong>：过去租金如何变化？</li>
<li><strong>供需条件</strong>：该物业类型的供需如何？</li>
<li><strong>经济环境</strong>：经济周期对租金的影响</li>
<li><strong>空置率</strong>：即使最抢手的物业也不可能100%出租</li>
</ul>
<p><strong>对于已签租约的物业</strong>，需要考虑： - 租约期限和约定租金 - 未来的租金调整条款 - 可报销费用 - 续约条款 - 净租约（租户负责税费、保险、维护）vs 毛租约</p>
</section>
<section id="现金流出" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="现金流出"><span class="header-section-number">5.2</span> 现金流出</h3>
<p>房地产支出包括：</p>
<p><strong>固定成本</strong>（与出租率无关）： - 房产税 - 保险 - 维修保养 - 广告</p>
<p><strong>可变成本</strong>（与出租率相关）： - 水电费</p>
<p><strong>特殊条款</strong>： - <strong>可报销费用</strong>：某些费用可由租户报销 - <strong>费用止损条款</strong>：约定费用上限，超出部分由租户承担</p>
</section>
<section id="预期增长" class="level3" data-number="5.3">
<h3 data-number="5.3" class="anchored" data-anchor-id="预期增长"><span class="header-section-number">5.3</span> 预期增长</h3>
<p>现金流增长的关键驱动因素是<strong>预期通胀率</strong>：</p>
<ul>
<li><strong>稳定市场</strong>：增长率 ≈ 通胀率</li>
<li><strong>紧俏市场</strong>（低空置率）：增长率 &gt; 通胀率</li>
<li><strong>疲软市场</strong>（高空置率）：增长率 &lt; 通胀率</li>
</ul>
<p>行业调查显示，虽然投资者对折现率看法不一，但对增长率的预期相当一致（通常在4-6%范围内）。</p>
<p><strong>租金管制的影响</strong>： - 限制租金上涨空间 → 降低预期现金流和增长率 → 降低物业价值 - 租金管制法律的不确定性 → 增加估值的误差</p>
</section>
<section id="终值" class="level3" data-number="5.4">
<h3 data-number="5.4" class="anchored" data-anchor-id="终值"><span class="header-section-number">5.4</span> 终值</h3>
<p>终值是DCF估值中的关键输入。有两种方法：</p>
<p><strong>方法一：永续增长模型</strong></p>
<p><span class="math display">\[
\text{终值}_n = \frac{\text{预期现金流}_{n+1}}{r - g}
\]</span></p>
<p>其中： - <span class="math inline">\(r\)</span> = 折现率（股权成本或资本成本） - <span class="math inline">\(g\)</span> = 永续增长率 - 现金流 = FCFE（股权终值）或 FCFF（资产终值）</p>
<p><strong>例子</strong>：如果第10年的税前现金流是$120万，预期增长3%/年，资本成本13%：</p>
<p><span class="math display">\[
\text{资产终值}_{10} = \frac{120 \times 1.03}{0.13 - 0.03} = \$1,236万
\]</span></p>
<p><strong>关于”永续”的疑虑</strong>：</p>
<p>建筑有有限寿命，假设永续现金流是否合理？</p>
<p>回答：可以假设每年将折旧（或更多）再投资于维护资本支出，以延长物业寿命。如果<strong>折旧 = 维护资本支出</strong>，则物业可以”永续”产生现金流。</p>
<p><strong>方法二：资本化率（Cap Rate）</strong></p>
<p>这是房地产评估师常用的方法：</p>
<p><span class="math display">\[
\text{物业价值} = \frac{\text{税后经营收入}}{\text{Cap Rate}}
\]</span></p>
<p>Cap Rate实际上是EV/EBIT倍数的倒数（参见第18章）。</p>
<p><strong>Cap Rate的三种估计方法</strong>：</p>
<ol type="1">
<li><p><strong>可比交易法</strong>：使用类似物业近期交易的平均Cap Rate</p>
<ul>
<li>实质上是将内在价值转换为相对估值</li>
</ul></li>
<li><p><strong>调查法</strong>：使用行业调查中投资者报告的Cap Rate</p></li>
<li><p><strong>DCF推导</strong>：如果假设NOI = FCFF，则：</p></li>
</ol>
<p><span class="math display">\[
\text{Cap Rate} = \frac{r - g}{1 + g}
\]</span></p>
<p>例如，资本成本13%，永续增长3%：</p>
<p><span class="math display">\[
\text{Cap Rate} = \frac{0.13 - 0.03}{1.03} = 9.70\%
\]</span></p>
<p>如果Cap Rate应用于<strong>下一年</strong>的经营收入（而非本年），则可以简化为 <span class="math inline">\(r - g = 10\%\)</span>。</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">重要</span>Cap Rate与WACC的关系
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math display">\[
\text{Cap Rate} \approx \text{WACC} - g
\]</span></p>
<p>这意味着： - Cap Rate不是”回报率”，而是”回报率减去增长率” - 高增长物业的Cap Rate较低（因为更多价值来自未来增长） - 低增长物业的Cap Rate较高</p>
<p>这与我们在第18章学习的PE与增长率关系完全一致。</p>
</div>
</div>
</section>
<section id="未开发土地一种特殊情况" class="level3" data-number="5.5">
<h3 data-number="5.5" class="anchored" data-anchor-id="未开发土地一种特殊情况"><span class="header-section-number">5.5</span> 未开发土地：一种特殊情况</h3>
<p>有时开发商购买土地不是为了开发，而是<strong>持有等待升值</strong>。这种投资：</p>
<ul>
<li>持有期间<strong>没有正现金流</strong></li>
<li>只有负现金流（房产税等费用）</li>
<li>唯一的正现金流是期末的出售价格</li>
</ul>
<p><strong>DCF分析</strong>：</p>
<p>要使投资有正NPV，土地预期升值率必须满足：</p>
<p><span class="math display">\[
\text{土地升值率} &gt; \text{资本成本} + \text{年房产税率}
\]</span></p>
<p>例如，资本成本10%，房产税率2%，则需要12%以上的年升值率。</p>
<p><strong>实物期权视角</strong>：</p>
<p>另一种分析方法是将土地视为<strong>开发期权</strong>，购买土地的成本就是期权费。即使预期升值率低于资本成本，如果土地价格波动性大，期权价值也可能为正。这将在第28章详细讨论。</p>
</section>
</section>
<section id="dcf估值案例711-third-avenue" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="dcf估值案例711-third-avenue"><span class="header-section-number">6</span> DCF估值案例：711 Third Avenue</h2>
<p>让我们用一个完整案例演示房地产DCF估值。以下是纽约曼哈顿711 Third Avenue办公楼的估值（2000年案例）。</p>
<section id="物业基本信息" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="物业基本信息"><span class="header-section-number">6.1</span> 物业基本信息</h3>
<ul>
<li><strong>可租面积</strong>：528,357平方英尺</li>
<li><strong>当前出租率</strong>：95%，预计逐年提高至97%</li>
<li><strong>平均租金</strong>：$28.07/平方英尺，预计年增3%</li>
<li><strong>信用损失</strong>：租金收入的2.5%</li>
<li><strong>车库收入</strong>：$80万/年，年增3%</li>
<li><strong>房产税</strong>：$5.24/平方英尺，前5年年增4%，之后3%</li>
<li><strong>地租</strong>：$150万/年，前5年不变，之后年增3%</li>
<li><strong>其他费用</strong>：$6.50/平方英尺，年增3%，10%可向租户报销</li>
<li><strong>管理费</strong>：$30万/年，年增3%</li>
<li><strong>折旧</strong>：$200万/年</li>
<li><strong>维护资本支出</strong>：$150万/年，年增3%</li>
</ul>
<p><strong>买家信息</strong>： - 公司买家，税率38% - 融资结构：60%债务 + 40%股权 - 债务利率：6.5%（长期气球贷款）</p>
</section>
<section id="第一步估计资本成本" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="第一步估计资本成本"><span class="header-section-number">6.2</span> 第一步：估计资本成本</h3>
<p><strong>股权成本</strong>（使用CAPM）：</p>
<p>首先，从办公物业REITs获取无杠杆Beta = 0.62。</p>
<p>加入杠杆效应：</p>
<p><span class="math display">\[
\text{有杠杆Beta} = 0.62 \times \left[1 + (1-0.38) \times \frac{0.6}{0.4}\right] = 1.20
\]</span></p>
<p>使用无风险利率5.4%，股权风险溢价4%：</p>
<p><span class="math display">\[
\text{股权成本} = 5.4\% + 1.20 \times 4\% = 10.20\%
\]</span></p>
<p><strong>资本成本</strong>：</p>
<p><span class="math display">\[
\text{WACC} = 10.20\% \times 0.4 + 6.5\% \times (1-0.38) \times 0.6 = 6.49\%
\]</span></p>
</section>
<section id="第二步估计现金流" class="level3" data-number="6.3">
<h3 data-number="6.3" class="anchored" data-anchor-id="第二步估计现金流"><span class="header-section-number">6.3</span> 第二步：估计现金流</h3>
<p>以下是未来5年及终值年的现金流预测（单位：美元）：</p>
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>项目</th>
<th>第1年</th>
<th>第2年</th>
<th>第3年</th>
<th>第4年</th>
<th>第5年</th>
<th>终值年</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>出租率</td>
<td>95.0%</td>
<td>95.5%</td>
<td>96.0%</td>
<td>96.5%</td>
<td>97.0%</td>
<td>97.0%</td>
</tr>
<tr class="even">
<td>租金/平方英尺</td>
<td>$28.91</td>
<td>$29.78</td>
<td>$30.67</td>
<td>$31.59</td>
<td>$32.54</td>
<td>$33.52</td>
</tr>
<tr class="odd">
<td>租金收入</td>
<td>14,512K</td>
<td>15,026K</td>
<td>15,558K</td>
<td>16,108K</td>
<td>16,677K</td>
<td>17,178K</td>
</tr>
<tr class="even">
<td>+ 车库收入</td>
<td>824K</td>
<td>849K</td>
<td>874K</td>
<td>900K</td>
<td>927K</td>
<td>955K</td>
</tr>
<tr class="odd">
<td>+ 报销收入</td>
<td>354K</td>
<td>364K</td>
<td>375K</td>
<td>387K</td>
<td>398K</td>
<td>410K</td>
</tr>
<tr class="even">
<td>- 信用损失</td>
<td>363K</td>
<td>376K</td>
<td>389K</td>
<td>403K</td>
<td>417K</td>
<td>429K</td>
</tr>
<tr class="odd">
<td><strong>总收入</strong></td>
<td>15,327K</td>
<td>15,864K</td>
<td>16,418K</td>
<td>16,992K</td>
<td>17,586K</td>
<td>18,114K</td>
</tr>
<tr class="even">
<td>- 房产税</td>
<td>2,879K</td>
<td>2,995K</td>
<td>3,114K</td>
<td>3,239K</td>
<td>3,368K</td>
<td>3,469K</td>
</tr>
<tr class="odd">
<td>- 地租</td>
<td>1,500K</td>
<td>1,500K</td>
<td>1,500K</td>
<td>1,500K</td>
<td>1,500K</td>
<td>1,545K</td>
</tr>
<tr class="even">
<td>- 其他费用</td>
<td>3,537K</td>
<td>3,643K</td>
<td>3,753K</td>
<td>3,865K</td>
<td>3,981K</td>
<td>4,101K</td>
</tr>
<tr class="odd">
<td>- 管理费</td>
<td>309K</td>
<td>318K</td>
<td>328K</td>
<td>338K</td>
<td>348K</td>
<td>358K</td>
</tr>
<tr class="even">
<td><strong>EBITDA</strong></td>
<td>7,101K</td>
<td>7,407K</td>
<td>7,724K</td>
<td>8,051K</td>
<td>8,388K</td>
<td>8,640K</td>
</tr>
<tr class="odd">
<td>- 折旧</td>
<td>2,000K</td>
<td>2,000K</td>
<td>2,000K</td>
<td>2,000K</td>
<td>2,000K</td>
<td>2,060K</td>
</tr>
<tr class="even">
<td><strong>EBIT</strong></td>
<td>5,101K</td>
<td>5,407K</td>
<td>5,724K</td>
<td>6,051K</td>
<td>6,388K</td>
<td>6,580K</td>
</tr>
<tr class="odd">
<td>- 税（38%）</td>
<td>1,939K</td>
<td>2,055K</td>
<td>2,175K</td>
<td>2,299K</td>
<td>2,428K</td>
<td>2,500K</td>
</tr>
<tr class="even">
<td><strong>EBIT(1-t)</strong></td>
<td>3,163K</td>
<td>3,353K</td>
<td>3,549K</td>
<td>3,751K</td>
<td>3,961K</td>
<td>4,080K</td>
</tr>
<tr class="odd">
<td>+ 折旧</td>
<td>2,000K</td>
<td>2,000K</td>
<td>2,000K</td>
<td>2,000K</td>
<td>2,000K</td>
<td>2,060K</td>
</tr>
<tr class="even">
<td>- 维护资本支出</td>
<td>1,545K</td>
<td>1,591K</td>
<td>1,639K</td>
<td>1,688K</td>
<td>1,739K</td>
<td>2,060K</td>
</tr>
<tr class="odd">
<td><strong>FCFF</strong></td>
<td>3,618K</td>
<td>3,761K</td>
<td>3,910K</td>
<td>4,063K</td>
<td>4,222K</td>
<td>4,080K</td>
</tr>
</tbody>
</table>
<p>注意：终值年假设折旧=维护资本支出=206万，确保物业可以永续产生现金流。</p>
</section>
<section id="第三步计算终值和物业价值" class="level3" data-number="6.4">
<h3 data-number="6.4" class="anchored" data-anchor-id="第三步计算终值和物业价值"><span class="header-section-number">6.4</span> 第三步：计算终值和物业价值</h3>
<p><strong>终值</strong>（使用永续增长模型，增长率3%）：</p>
<p><span class="math display">\[
\text{终值}_5 = \frac{4,080K}{0.0649 - 0.03} = \$116,811K
\]</span></p>
<p><strong>物业价值</strong>（现值计算）：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>年份</th>
<th>FCFF</th>
<th>终值</th>
<th>折现因子@6.49%</th>
<th>现值</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>$3,618K</td>
<td></td>
<td>0.9390</td>
<td>$3,397K</td>
</tr>
<tr class="even">
<td>2</td>
<td>$3,761K</td>
<td></td>
<td>0.8818</td>
<td>$3,317K</td>
</tr>
<tr class="odd">
<td>3</td>
<td>$3,910K</td>
<td></td>
<td>0.8280</td>
<td>$3,237K</td>
</tr>
<tr class="even">
<td>4</td>
<td>$4,063K</td>
<td></td>
<td>0.7775</td>
<td>$3,159K</td>
</tr>
<tr class="odd">
<td>5</td>
<td>$4,222K</td>
<td>$116,811K</td>
<td>0.7302</td>
<td>$88,371K</td>
</tr>
<tr class="even">
<td><strong>合计</strong></td>
<td></td>
<td></td>
<td></td>
<td><strong>$101,481K</strong></td>
</tr>
</tbody>
</table>
<p><strong>结论</strong>：711 Third Avenue的估值为<strong>$1.0148亿</strong>。</p>
</section>
<section id="股权价值估值" class="level3" data-number="6.5">
<h3 data-number="6.5" class="anchored" data-anchor-id="股权价值估值"><span class="header-section-number">6.5</span> 股权价值估值</h3>
<p>我们也可以直接估计股权价值。</p>
<p><strong>债务金额</strong>：$101.48M × 60% = $60.89M</p>
<p><strong>年利息支出</strong>：$60.89M × 6.5% = $3.96M</p>
<p><strong>终值年股权价值</strong>：$116.81M - $60.89M = $55.92M</p>
<p>按股权成本10.20%折现FCFE，得到股权价值 = <strong>$39.83M</strong></p>
<p>验证：$39.83M（股权）+ $60.89M（债务）= $100.72M</p>
<p>与资产估值的$101.48M略有差异，原因是：在资产估值中，我们隐含假设债务比例保持60%不变，这意味着物业增值时会借入更多债务，其税盾效应已被计入。股权估值中没有考虑这部分增量税盾。</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">注记</span>与实际评估的对比
</div>
</div>
<div class="callout-body-container callout-body">
<p>实际评估师对711 Third Avenue的估值是$7,000万，比我们的估值低约30%。主要差异：</p>
<ol type="1">
<li><strong>税前vs税后</strong>：评估使用税前现金流，忽略了折旧税盾</li>
<li><strong>折现率来源</strong>：评估使用11.5%的调查折现率，高于我们的6.49%</li>
<li><strong>终值方法</strong>：评估使用9%的Cap Rate</li>
</ol>
<p>我们认为，使用税前现金流和税前折现率会低估物业价值——忽略了折旧和利息的税盾效应。</p>
</div>
</div>
</section>
</section>
<section id="相对估值" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="相对估值"><span class="header-section-number">7</span> 相对估值</h2>
<p>DCF并非唯一的估值方法。就像股票可以用PE倍数估值，房地产也可以用可比物业来定价。</p>
<section id="为什么使用相对估值" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="为什么使用相对估值"><span class="header-section-number">7.1</span> 为什么使用相对估值？</h3>
<ol type="1">
<li><strong>处理无现金流资产</strong>：自住房产不产生租金，但可以用可比房产定价</li>
<li><strong>反映市场状态</strong>：现有租约可能落后于市场，可比交易反映最新市场条件</li>
<li><strong>简单直接</strong>：不需要显式估计折现率和现金流</li>
</ol>
</section>
<section id="标准化指标" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="标准化指标"><span class="header-section-number">7.2</span> 标准化指标</h3>
<p>房地产的标准化指标包括：</p>
<p><strong>每平方英尺价格</strong> <span class="math display">\[
\text{每平方英尺价格} = \frac{\text{物业价格}}{\text{建筑面积}}
\]</span> - 简单直观 - 但不反映位置、质量、出租率的差异</p>
<p><strong>毛收入乘数（GIM）</strong> <span class="math display">\[
\text{GIM} = \frac{\text{物业价格}}{\text{年毛收入}}
\]</span> - 收入隐含了位置、质量的影响 - 应使用税前债务收入，避免杠杆差异的影响</p>
</section>
<section id="可比物业定价案例" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="可比物业定价案例"><span class="header-section-number">7.3</span> 可比物业定价案例</h3>
<p>继续711 Third Avenue案例，评估师收集了8个曼哈顿类似物业的近期交易：</p>
<table class="caption-top table">
<colgroup>
<col style="width: 7%">
<col style="width: 20%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 19%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th>物业</th>
<th>面积(平方英尺)</th>
<th>出租率</th>
<th>成交价</th>
<th>$/平方英尺</th>
<th>NOI/平方英尺</th>
<th>价格/NOI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>900 Third Ave</td>
<td>560,000</td>
<td>99%</td>
<td>$182.0M</td>
<td>$325</td>
<td>$26.98</td>
<td>12.05</td>
</tr>
<tr class="even">
<td>767 Third Ave</td>
<td>456,007</td>
<td>95%</td>
<td>$95.0M</td>
<td>$208</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>350 Madison Ave</td>
<td>310,000</td>
<td>97%</td>
<td>$70.1M</td>
<td>$226</td>
<td>$17.60</td>
<td>12.84</td>
</tr>
<tr class="even">
<td>888 Seventh Ave</td>
<td>838,680</td>
<td>96%</td>
<td>$154.5M</td>
<td>$184</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>622 Third Ave</td>
<td>874,434</td>
<td>97%</td>
<td>$172.0M</td>
<td>$197</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr class="even">
<td>150 East 58th</td>
<td>507,178</td>
<td>95%</td>
<td>$118.0M</td>
<td>$233</td>
<td>$16.52</td>
<td>14.08</td>
</tr>
<tr class="odd">
<td>1065 Ave Americas</td>
<td>580,000</td>
<td>95%</td>
<td>$59.0M</td>
<td>$102</td>
<td>NA</td>
<td>NA</td>
</tr>
<tr class="even">
<td>810 Seventh Ave</td>
<td>646,000</td>
<td>95%</td>
<td>$141.0M</td>
<td>$218</td>
<td>$15.17</td>
<td>14.39</td>
</tr>
<tr class="odd">
<td><strong>平均</strong></td>
<td></td>
<td>96.13%</td>
<td></td>
<td><strong>$211.61</strong></td>
<td></td>
<td><strong>13.34</strong></td>
</tr>
</tbody>
</table>
<p>711 Third Avenue：528,357平方英尺，出租率95%，NOI=$610.7万</p>
<p><strong>方法一：每平方英尺价格</strong> <span class="math display">\[
\text{价值} = 528,357 \times \$211.61 = \$1.118亿
\]</span></p>
<p><strong>方法二：调整出租率后的每平方英尺价格</strong> <span class="math display">\[
\text{价值} = 528,357 \times \frac{95\%}{96.13\%} \times \$211.61 = \$1.105亿
\]</span></p>
<p><strong>方法三：价格/NOI倍数</strong> <span class="math display">\[
\text{价值} = \$6.107M \times 13.34 = \$8,147万
\]</span></p>
<p><strong>如何选择</strong>？</p>
<p>如果711 Third Avenue的较低每平方英尺收入是<strong>管理问题</strong>（新买家可以改善），应使用较高估值（$1.1亿）。</p>
<p>如果是<strong>物业本身特征</strong>（位置或状况较差），应使用NOI倍数估值（$8,147万）。</p>
</section>
<section id="回归方法" class="level3" data-number="7.4">
<h3 data-number="7.4" class="anchored" data-anchor-id="回归方法"><span class="header-section-number">7.4</span> 回归方法</h3>
<p>可以用回归分析控制多个因素的差异：</p>
<p><span class="math display">\[
\text{每平方英尺价格} = -2,535.50 + 2,857.86 \times \text{出租率} \quad (R^2 = 46\%)
\]</span></p>
<p>应用于711 Third Avenue（出租率95%）： <span class="math display">\[
\text{每平方英尺价格} = -2,535.50 + 2,857.86 \times 0.95 = \$179.46
\]</span></p>
<p><span class="math display">\[
\text{价值} = 528,357 \times \$179.46 = \$9,482万
\]</span></p>
<p>这个回归的局限是样本量小、出租率差异小。如果有更多观测值和更多解释变量（如建筑年龄、位置评分），预测会更可靠。</p>
<p><strong>这正是Zillow的z-estimate的原理</strong>——用大量历史交易数据回归住宅价格对各种特征。</p>
</section>
<section id="相对估值在房地产中的优势" class="level3" data-number="7.5">
<h3 data-number="7.5" class="anchored" data-anchor-id="相对估值在房地产中的优势"><span class="header-section-number">7.5</span> 相对估值在房地产中的优势</h3>
<p>有趣的是，相对估值在房地产中可能比在股票中<strong>更可靠</strong>：</p>
<ul>
<li>股票即使在同一行业，风险和增长特征也可能差异很大</li>
<li>但同一地区的房地产，风险和增长特征非常相似</li>
<li>这使得”可比”真正可比</li>
</ul>
</section>
</section>
<section id="房地产企业估值" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="房地产企业估值"><span class="header-section-number">8</span> 房地产企业估值</h2>
<p>到目前为止，我们讨论的是单个物业的估值。房地产企业呢？</p>
<section id="收入来源" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="收入来源"><span class="header-section-number">8.1</span> 收入来源</h3>
<p>房地产企业的收入来源多样化：</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>业务类型</th>
<th>收入来源</th>
<th>价值驱动因素</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>服务收入</strong></td>
<td>管理费、销售佣金、维护服务</td>
<td>效率、品牌声誉</td>
</tr>
<tr class="even">
<td><strong>房地产建设</strong></td>
<td>固定价格合同利润</td>
<td>成本控制能力、质量声誉</td>
</tr>
<tr class="odd">
<td><strong>房地产开发</strong></td>
<td>买地→建设→出售的利润</td>
<td>市场判断、执行速度、成本控制</td>
</tr>
<tr class="even">
<td><strong>房地产投资</strong></td>
<td>持有物业的租金收入</td>
<td>选择物业的能力</td>
</tr>
</tbody>
</table>
<p>对于纯投资型企业，估值可以是<strong>底层物业价值的加总</strong>。但如果企业有持续发现低估物业的能力，可能值得给予溢价。</p>
</section>
<section id="组织形式" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="组织形式"><span class="header-section-number">8.2</span> 组织形式</h3>
<p>房地产企业有四种主要组织形式，在税务和投资政策上有重要差异：</p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 16%">
<col style="width: 30%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>特征</th>
<th>REIT</th>
<th>MLP</th>
<th>商业信托</th>
<th>公司</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>税务</strong></td>
<td>单层税（投资者层面）</td>
<td>单层税</td>
<td>双重税</td>
<td>双重税</td>
</tr>
<tr class="even">
<td><strong>股利要求</strong></td>
<td>必须分配95%+</td>
<td>无强制，但实际高</td>
<td>无</td>
<td>无</td>
</tr>
<tr class="odd">
<td><strong>业务限制</strong></td>
<td>75%+收入来自房地产；被动投资；不能开发/交易</td>
<td>必须是房地产或油气</td>
<td>无</td>
<td>无</td>
</tr>
</tbody>
</table>
<p><strong>估值含义</strong>：</p>
<p><strong>REITs和MLPs</strong>： - 税率为零（在实体层面） - 但折旧和利息的税盾仍流向投资者 - 高派息 → 如无外部融资，增长率受限 - 如有外部融资 → 净收入增长快，但股数也增加 → 每股增长有限</p>
<p><strong>房地产公司</strong>： - 使用公司税率计算现金流和折现率 - 更灵活的投资和股利政策</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">提示</span>REITs的股利折现模型
</div>
</div>
<div class="callout-body-container callout-body">
<p>由于REITs必须分配大部分收入，股利折现模型（DDM，第14章）特别适合REITs估值——这与我们在第21章讨论银行估值时的逻辑一致。</p>
</div>
</div>
</section>
</section>
<section id="批判性讨论dcf在房地产中的局限" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="批判性讨论dcf在房地产中的局限"><span class="header-section-number">9</span> 批判性讨论：DCF在房地产中的局限</h2>
<p>有人认为DCF不适用于房地产，理由包括：</p>
<p><strong>反对意见一：折现率难以估计</strong></p>
<p>回应：确实有挑战，但并非不可能。而且调查法虽然简单，但也有自身问题（谁是边际投资者？）。</p>
<p><strong>反对意见二：现金流预测繁琐</strong></p>
<p>回应：房地产现金流其实比高增长股票更容易预测——租约提供了可预测性。</p>
<p><strong>反对意见三：DCF不反映市场状态</strong></p>
<p>回应： - 现金流应该反映市场状态（紧俏市场=高租金、低空置率） - 如果市场定价与现金流不一致，那正是错误定价——而发现错误定价正是内在价值估值的目的</p>
<p><strong>我的观点</strong>：</p>
<p>DCF的优势在于它提供了一个<strong>纪律框架</strong>——强迫你明确假设、量化预期、分析风险来源。即使最终选择相对估值，DCF也应该作为<strong>健全性检查</strong>。</p>
</section>
<section id="总结" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="总结"><span class="header-section-number">10</span> 总结</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">重要</span>核心要点
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p><strong>估值原理统一</strong>：房地产和股票都可以用DCF估值，差异在于输入参数的估计方法</p></li>
<li><p><strong>折现率的挑战</strong>：</p>
<ul>
<li>如果边际投资者分散化 → 使用CAPM/Beta</li>
<li>如果未分散化 → 使用总Beta调整</li>
<li>流动性风险可以通过折价处理</li>
<li>调查法是有用的补充</li>
</ul></li>
<li><p><strong>Cap Rate是简化的DCF</strong>： <span class="math display">\[\text{Cap Rate} \approx r - g\]</span> 这是”回报率减去增长率”，不是回报率本身</p></li>
<li><p><strong>相对估值在房地产中更可靠</strong>：同一地区物业的同质性高于同行业股票</p></li>
<li><p><strong>REITs改变了房地产</strong>：</p>
<ul>
<li>提高流动性</li>
<li>但也使房地产与金融资产相关性上升</li>
<li>分散化优势可能正在减弱</li>
</ul></li>
</ol>
</div>
</div>
<p><code>★ Insight ─────────────────────────────────────</code> <strong>Damodaran的核心洞察</strong>：</p>
<p>房地产估值不需要”另一套理论”。金融学的基本原理——现金流决定价值、风险决定折现率——在所有资产上都成立。房地产估值的独特挑战不是原理问题，而是<strong>测量问题</strong>：如何估计不频繁交易资产的风险？如何处理流动性不足？如何看待未分散化投资者？</p>
<p>这些问题在私有公司估值（第24章）中同样存在，解决方案也类似：总Beta、流动性折价、关键人物依赖。这说明估值框架的力量：一旦理解了基本原理，就可以应用于任何资产。 <code>─────────────────────────────────────────────────</code></p>
</section>
<section id="中国视角房地产估值的本土化思考" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="中国视角房地产估值的本土化思考"><span class="header-section-number">11</span> 中国视角：房地产估值的本土化思考</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">注记</span>中国房地产市场的特殊性
</div>
</div>
<div class="callout-body-container callout-body">
<p>中国房地产市场有几个独特特征值得关注：</p>
<ol type="1">
<li><p><strong>土地使用权 vs 土地所有权</strong>：中国是土地使用权（70年住宅/40-50年商业），而非永久产权。这影响终值计算——到期后会发生什么？</p></li>
<li><p><strong>预售制度</strong>：期房销售在中国普遍，开发商在建设前即获得现金流，改变了现金流时间分布</p></li>
<li><p><strong>限购限贷政策</strong>：政策限制改变了边际投资者特征——可能是刚需而非分散化投资者</p></li>
<li><p><strong>公募REITs刚起步</strong>：中国公募REITs于2021年才推出，主要是基础设施REITs而非传统房地产REITs</p></li>
</ol>
<p>这些特征不改变DCF的基本框架，但会影响具体参数的估计。</p>
</div>
</div>
</section>
<section id="思考题" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="思考题"><span class="header-section-number">12</span> 思考题</h2>
<ol type="1">
<li><p><strong>风险测量</strong>：如果用房地产指数（基于评估值）回归得到Beta=0.20，你会接受这个估计吗？为什么？</p></li>
<li><p><strong>折现率方法</strong>：使用REITs的Beta作为直接房地产投资风险的代理，有什么优缺点？</p></li>
<li><p><strong>派生需求</strong>：如果你要估计下列物业的风险，你会使用什么作为参照？</p>
<ul>
<li>纽约商业地产</li>
<li>休斯顿商业地产</li>
<li>硅谷商业地产</li>
<li>奥兰多酒店</li>
</ul></li>
<li><p><strong>投资者类型</strong>：如果主要买家是专注房地产的个人投资者 vs 机构投资者，你的估值会有什么不同？</p></li>
<li><p><strong>Cap Rate分解</strong>：某地区办公楼的Cap Rate是8%，无风险利率4%。如果你认为合理的风险溢价是5%，那么市场隐含的增长率预期是多少？这合理吗？</p></li>
<li><p><strong>中国问题</strong>：考虑到中国住宅的70年土地使用权，你会如何调整终值计算？假设70年后续期成本是当时土地价值的X%，这如何影响估值？</p></li>
</ol>


</section>

</main> <!-- /main -->
﻿<script>

// Simple EN / 中文 language toggle for posts; robust via meta[quarto:offset]

(function() {

  const KEY = 'siteLang'; // 'en' | 'zh'

  const defaultLang = 'en';

  const POSTS_EN = 'posts_en.html';

  const POSTS_ZH = 'posts_zh.html';

  const TAGS = 'tags.html';



  function currentLang() { try { return localStorage.getItem(KEY) || defaultLang; } catch(e) { return defaultLang; } }

  function setLang(v) { try { localStorage.setItem(KEY, v); } catch(e) {} }

  function offset() {

    const meta = document.querySelector('meta[name="quarto:offset"]');

    const off = meta && meta.getAttribute('content') ? meta.getAttribute('content') : './';

    return off;

  }

  function targetFor(lang) { return lang === 'zh' ? POSTS_ZH : POSTS_EN; }

  function goToLang(lang) {

    const off = offset();

    const path = window.location.pathname;

    setLang(lang);

    if (path.endsWith('/' + TAGS) || path.endsWith(TAGS)) {

      window.location.href = off + TAGS;

    } else {

      window.location.href = off + targetFor(lang);

    }

  }

  function updateNavbarPostsLink() {

    const off = offset();

    const href = off + targetFor(currentLang());

    const links = document.querySelectorAll('header .navbar a.nav-link');

    links.forEach((a) => {

      const h = a.getAttribute('href') || '';

      if (h.endsWith(POSTS_EN) || h.endsWith(POSTS_ZH)) a.setAttribute('href', href);

    });

  }

  function mountToggle() {

    const tools = document.querySelector('.quarto-navbar-tools');

    if (!tools) return;

    const wrapper = document.createElement('div');

    wrapper.style.display = 'inline-flex';

    wrapper.style.alignItems = 'center';

    wrapper.style.gap = '0.35rem';

    wrapper.style.marginLeft = '0.35rem';



    const en = document.createElement('a');

    en.href = '';

    en.textContent = 'EN';

    en.className = 'quarto-navigation-tool px-1';

    en.onclick = function(){ goToLang('en'); return false; };



    const sep = document.createElement('span');

    sep.textContent = '|';

    sep.style.opacity = '0.6';



    const zh = document.createElement('a');

    zh.href = '';

    zh.textContent = '中文';

    zh.className = 'quarto-navigation-tool px-1';

    zh.onclick = function(){ goToLang('zh'); return false; };



    const lang = currentLang();

    (lang === 'en' ? en : zh).style.fontWeight = '700';



    wrapper.appendChild(en);

    wrapper.appendChild(sep);

    wrapper.appendChild(zh);

    tools.appendChild(wrapper);

    updateNavbarPostsLink();

  }

  document.addEventListener('DOMContentLoaded', mountToggle);

})();

</script>

<script>

(function(){

  function offset(){

    var meta = document.querySelector('meta[name="quarto:offset"]');

    return meta && meta.getAttribute('content') ? meta.getAttribute('content') : './';

  }

  document.addEventListener('DOMContentLoaded', function(){

    var brand = document.querySelector('header .navbar a.navbar-brand');

    if (brand) {

      brand.setAttribute('href', offset() + 'home.html');

    }

  });

})();

</script>



<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "已复制");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "已复制");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>